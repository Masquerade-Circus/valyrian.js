# 9.1. Vite Integration (Client App)

Use this recipe when you want fast local feedback (`vite dev`) and a straightforward production bundle (`vite build`).

Prerequisite:

- [./3.1-runtime-core.md](./3.1-runtime-core.md)

## Goal

1. Run Valyrian with TSX in Vite.
2. Keep JSX transform aligned with Valyrian (`v` / `v.fragment`).
3. Verify dev + build + preview flow.

## Install

```bash
npm create vite@latest my-valyrian-vite -- --template vanilla-ts
cd my-valyrian-vite
npm i valyrian.js
```

## Configure JSX Transform (Required)

Set TypeScript JSX settings in your app tsconfig:

```json
{
  "compilerOptions": {
    "jsx": "react",
    "jsxFactory": "v",
    "jsxFragmentFactory": "v.fragment"
  }
}
```

Set matching Vite esbuild JSX settings:

```ts
// vite.config.ts
import { defineConfig } from "vite";

export default defineConfig({
  esbuild: {
    jsxFactory: "v",
    jsxFragment: "v.fragment"
  }
});
```

## App Entry

Create `src/main.tsx`:

```tsx
import { mount, v } from "valyrian.js";

function App() {
  return (
    <main style="font-family: sans-serif; padding: 2rem;">
      <h1>Valyrian + Vite</h1>
      <p>HMR and production bundling are now configured.</p>
    </main>
  );
}

mount("#app", App);
```

## Verify

```bash
npm run dev
npm run build
npm run preview
```

Expected outcomes:

1. `dev`: page renders and updates on file save.
2. `build`: production bundle completes without JSX transform errors.
3. `preview`: built app renders the same output as dev.

## Integration Notes

Required for correctness:

1. Keep `jsxFactory`/`jsxFragmentFactory` aligned with `v`/`v.fragment`.
2. Keep `v` in scope in TSX files (for classic JSX factory mode).

Recommended practice:

1. Keep one stable mount root (`#app` or `body`) across your app.
2. Use the same JSX transform settings in local and CI builds.
