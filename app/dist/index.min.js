!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.App=n()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){function n(e,t){if(3===e.nodeType||1===e.nodeType)return(t={name:"div",props:{},children:[],dom:null,isVnode:!0,isText:!1,nodeValue:null}).name=e.nodeName.toLowerCase(),t.dom=e,3===e.nodeType?(t.nodeValue=e.nodeValue,t.isText=!0,t):(t.dom.events={},Array.prototype.map.call(e.attributes,function(e){t.props[e.nodeName]=e.nodeValue}),Array.prototype.forEach.call(e.childNodes,function(e){var o=n(e);void 0!==o&&t.children.push(o)}),t)}function t(e,n,o,i){if("string"==typeof e){for(i in(o={name:"div",props:{},children:[],dom:null,isVnode:!0,isText:!1,nodeValue:null}).name=e,n)o.props[i]=n[i];return function e(n,t,o,i,r){for(o=0,i=n.length;o<i;o++)if(n[o]){if(Array.isArray(n[o])){e(n[o],t);continue}if("object"==typeof n[o]&&n[o].isVnode){t.push(n[o]);continue}(r={name:"div",props:{},children:[],dom:null,isVnode:!0,isText:!1,nodeValue:null}).name="#text",r.isText=!0,r.nodeValue=n[o],t.push(r)}}(t.utils.arguments2Array(arguments,2),o.children),o}if("function"==typeof e)return Object.assign({view:e,isComponent:!0},n);if("object"==typeof e){if(e.isComponent)return r=e,a=t.utils.arguments2Array(arguments,1),u=r.view.apply(r,a),Array.isArray(u)?u:[u];if("function"==typeof e.view)return Object.assign(e,{isComponent:!0})}var r,a,u}var o,i,r,a;function u(e,n){if(!e.isText&&void 0!==e.props&&void 0!==e.props[n])return e.props[n](e)}function s(e){e.currentTarget.events["on"+event.type](e),t.update()}(t.utils={}).arguments2Array=function(e,n,t,o){for(t=[],o=e.length,void 0===n&&(n=0);n<o;n++)t.push(e[n]);return t},(t.is={}).node="undefined"==typeof window,t.is.browser=!t.is.node,t.is.mounted=!1,t.trust=function(e){var t=document.createElement("div");return t.innerHTML=e.trim(),Array.prototype.map.call(t.childNodes,function(e){return n(e)})};var c=!1;t.update=function(e){return"object"==typeof(e=t.utils.arguments2Array(arguments))[0]&&e[0].isComponent&&(o=e.shift()),new Promise(function(n){c||(c=!0,e.unshift(o),r=t.apply(t,e),function e(n,o,i,r,a,c,p,l,d,f){if(0!==o.length)for(a=o.length>i.length?o.length:i.length,l=0;l<a;l++)if(p=i[l],d=!t.is.mounted,void 0!==(c=o[l])){if(r=r||"svg"===c.name,void 0===p){if(u(c,"oninit"),c.dom=c.isText?document.createTextNode(c.nodeValue):r?document.createElementNS("http://www.w3.org/2000/svg",c.name):document.createElement(c.name),n.appendChild(c.dom),c.isText)continue;p={children:[]},d=!0}else if(c.name!==p.name){if(u(c,"oninit"),c.dom=c.isText?document.createTextNode(c.nodeValue):r?document.createElementNS("http://www.w3.org/2000/svg",c.name):document.createElement(c.name),u(p,"onremove"),n.replaceChild(c.dom,p.dom),c.isText)continue;d=!0}else if(c.dom=p.dom,c.isText){c.dom.nodeValue=c.nodeValue;continue}if(e(c.dom,c.children,p.children,r),!d)for(f in p.props)if(void 0===c.props[f]){if("function"==typeof p.props[f]){c.dom.removeEventListener(f.slice(2),s);continue}c.dom[f]=null,t.is.node&&c.dom.removeAttribute(f)}for(f in c.props)if(d||c.props[f]!==p.props[f]){if("function"==typeof c.props[f]){switch(f){case"oninit":case"oncreate":case"onupdate":case"onremove":break;default:void 0===c.dom.events&&(c.dom.events={}),void 0===c.dom.events[f]&&(c.dom.events[f]=c.props[f],c.dom.addEventListener(f.slice(2),s))}continue}if(t.is.node){c.dom.setAttribute(f,c.props[f]);continue}c.dom[f]=c.props[f]}t.is.mounted||(u(c,"oninit"),u(c,"oncreate")),u(c,d?"oncreate":"onupdate")}else u(p,"onremove"),n.removeChild(p.dom);else n.textContent=""}(a,r,i),i=r,c=!1,t.is.mounted=!0,n(a.innerHTML))})},t.mount=function(e,r){return o=r,a=t.is.node?document.createElement("div"):"string"==typeof e?document.querySelectorAll(e)[0]:e,i=n(a).children,t.update.apply(this,t.utils.arguments2Array(arguments,2))};var p=[];t.use=function(e,n){return-1===p.indexOf(e)&&(e(t,n),p.push(e)),t},(t.is.node?e:window).v=t}();var n=function(e,t){if(void 0===t&&(t=[]),"function"==typeof e)return t.push(e),t;for(var o=0,i=e.length;o<i;o++)Array.isArray(e[o])?n(e[o],t):t.push(e[o]);return t},t=function(e,o,i){var r,a;if("string"==typeof i[0]&&(r=i.shift()),"function"==typeof i[0]&&i[0].paths&&i[0].regexpList)for(var u=i.shift(),s=0,c=u.paths.length;s<c;s++){var p=u.paths[s].middlewares,l=u.paths[s].method,d=u.paths[s].path;r&&(d=r+(d||"*")),d&&p.unshift(d),e=t(e,l,p)}if((a=n(i)).length>0){if(r&&void 0===e.regexpList[r]){var f=(r=r.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var v in f)f[v]=f[v].slice(1);var h=r.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");e.regexpList[r]={regexp:RegExp("^"+h+"/?(\\?.*)?$","gi"),params:f}}e.paths.push({method:o,path:r,middlewares:a})}return e},o=function(){var e=async function(t){void 0===t&&(t="/");var o,i={},r=[],a=0,u=e.paths.length;for(e.url=t;a<u;a++){var s=e.paths[a];if("get"===s.method||"use"===s.method)if("use"!==s.method&&"get"!==s.method||void 0!==s.path){var c=e.regexpList[s.path],p=c.regexp.exec(t);if(c.regexp.lastIndex=-1,Array.isArray(p)){p.shift();for(var l=c.params,d=l.length;d--;)void 0===i[l[d]]&&(i[l[d]]=p[d]);n(s.middlewares,r)}}else n(s.middlewares,r)}if(e.params=i,r.length>0)for(var f=0,v=r.length;f<v;f++)if(o=await r[f](i))return o;if(e.throwNotFound)throw Error("The url "+t+" requested wasn't found")};return e.url="/",e.params={},e.throwNotFound=!0,e.paths=[],e.regexpList={},e.get=function(){return t(e,"get",v.utils.arguments2Array(arguments))},e.use=function(){return t(e,"use",v.utils.arguments2Array(arguments))},e};v.use(function(e){var n,t;e.routes=function(o,i){if(o&&i&&(n=i,t=o,e.is.browser)){function r(){e.routes.go(document.location.pathname)}window.addEventListener("popstate",r,!1),r()}},e.routes.get=function(){var e=[];return n.paths.forEach(function(n){"get"===n.method&&e.push(""===n.path?"/":n.path)}),e},e.routes.current="/",e.routes.params={},e.routes.go=function(){var o,i,r=e.utils.arguments2Array(arguments);if("object"==typeof r[0]&&(r[0].isComponent||"function"!=typeof r[0].view||(r[0]=e(r[0])),r[0].isComponent&&(o=r.shift())),"string"==typeof r[0]&&(i=r.shift()),!i)throw Error("v.router.url.required");return e.is.browser&&window.history.pushState({},"",i),function(o,i,r){return n(i).then(function(n){if("object"!=typeof n)throw Error("v.router.component.required");if(n.isComponent||"function"!=typeof n.view||(n=e(n)),!n.isComponent)throw Error("v.router.component.required");return o&&(r.unshift(e(n,r)),n=o),r.unshift(n),e.is.node||!e.is.mounted?(r.unshift(t),e.mount.apply(e,r)):e.update.apply(e,r)})}(o,i,r)},e.Router=o}).use(function(e){var n=function(t,o){void 0===t&&(t=""),void 0===o&&(o={});var i,r=t.replace(/\/$/gi,"").trim(),a=Object.assign({methods:["get","post","put","patch","delete"]},o);function u(e,n,t,o){void 0===o&&(o={});var r=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},u.options,o),a=r.headers.Accept;return void 0!==t&&("get"===r.method&&"object"==typeof t&&(n+=t=function e(n,t){var o=encodeURIComponent;return Object.keys(n).map(function(i){var r=t?t+"["+i+"]":i;return"object"==typeof n[i]?e(n[i],r):o(r)+"="+o(n[i])}).join("&")}(t)),"get"!==r.method&&(r.body=JSON.stringify(t))),fetch(i(n),r).then(function(e){if(e.status<200||e.status>300){var n=Error(e.statusText);throw n.response=e,n}return/text/gi.test(a)?e.text():/json/gi.test(a)?e.json():e})}return i=function(n){var t=/^https?/gi.test(n)?n:(u.baseUrl+"/"+n).trim().replace(/^\/\//gi,"/").trim();return e.is.node&&"string"==typeof u.nodeUrl&&(u.nodeUrl=u.nodeUrl.replace(/\/$/gi,"").trim(),/^https?/gi.test(t)&&"string"==typeof u.apiUrl&&(u.apiUrl=u.apiUrl.replace(/\/$/gi,"").trim(),t=t.replace(u.apiUrl,u.nodeUrl)),/^https?/gi.test(t)||(t=u.nodeUrl+t)),t},u.new=function(e,t){return n(e,t)},u.apiUrl=void 0,u.nodeUrl=void 0,u.options=a,u.baseUrl=r,a.methods.forEach(function(e){return u[e]=function(n,t,o){return u(e,n,t,o)}}),u};e.request=n()}).use(function(e){e.is.browser&&(e.sw=function(n,t){return void 0===n&&(n=e.sw.file),void 0===t&&(t=e.sw.options),navigator.serviceWorker.register(n,t).then(function(){return navigator.serviceWorker.ready}).then(function(o){return e.sw.ready=!0,e.sw.file=n,e.sw.options=t,new Promise(function(e,n){setTimeout(function(){e(navigator.serviceWorker)},10)})})},e.sw.ready=!1,e.sw.file="/sw.js",e.sw.options={scope:"/"})});var i={view:function(){return[v("link",{rel:"apple-touch-icon",sizes:"114x114",href:"/icons/apple-touch-icon-114x114.png"}),v("link",{rel:"apple-touch-icon",sizes:"120x120",href:"/icons/apple-touch-icon-120x120.png"}),v("link",{rel:"apple-touch-icon",sizes:"144x144",href:"/icons/apple-touch-icon-144x144.png"}),v("link",{rel:"apple-touch-icon",sizes:"152x152",href:"/icons/apple-touch-icon-152x152.png"}),v("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/icons/apple-touch-icon-180x180.png"}),v("link",{rel:"apple-touch-icon",sizes:"57x57",href:"/icons/apple-touch-icon-57x57.png"}),v("link",{rel:"apple-touch-icon",sizes:"60x60",href:"/icons/apple-touch-icon-60x60.png"}),v("link",{rel:"apple-touch-icon",sizes:"72x72",href:"/icons/apple-touch-icon-72x72.png"}),v("link",{rel:"apple-touch-icon",sizes:"76x76",href:"/icons/apple-touch-icon-76x76.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-320x460.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x920.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x1096.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-750x1294.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1182x2208.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1242x2148.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-748x1024.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1496x2048.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-768x1004.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1536x2008.png"}),v("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/icons/favicon-16x16.png"}),v("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/icons/favicon-32x32.png"}),v("link",{rel:"manifest",href:"/icons/manifest.json"}),v("link",{rel:"shortcut icon",href:"/icons/favicon.ico"}),v("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),v("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),v("meta",{name:"apple-mobile-web-app-title",content:"Valyrian.js"}),v("meta",{name:"application-name",content:"Valyrian.js"}),v("meta",{name:"mobile-web-app-capable",content:"yes"}),v("meta",{name:"msapplication-TileColor",content:"#fff"}),v("meta",{name:"msapplication-TileImage",content:"/icons/mstile-144x144.png"}),v("meta",{name:"msapplication-config",content:"/icons/browserconfig.xml"}),v("meta",{name:"theme-color",content:"#fff"})]}},r={title:"Valyrian.js",version:"2.0.0",view:function(e){return v("html",{lang:"en"},[v("head",null,[v("title",null,r.title),v("style",null,v.inline.uncss()),v(i)]),v("body",null,[e,v("script",{src:"/index.min.js",async:!0})])])}};var a=v(function(){return v("div",{id:"mundo",class:"hola"},this.data.hello+" "+this.data.name)},{data:{hello:"Hello",name:"world"},oninit:function(){return this.getServer()},getServer:function(){var e=this;return v.request.get("/api/hola").then(function(n){e.data=n})}}),u={count:0,down:function(e){u.count-=e},up:function(e){u.count+=e},view:function(){return v("div",null,[v("h1",null,u.count),v("button",{onclick:function(){return u.down(1)}},"-"),v("button",{onclick:function(){return u.up(1)}},"+"),v("a",{href:"/hello",onclick:function(e){v.routes.go("/hello"),e.preventDefault()}},"Go to hello"),v("div",null,[2===u.count?v(2):"",v("br"),v("div",null,"boolean true"),v("div",null,!0),v("br"),v("div",null,"boolean false"),v("div",null,!1),v("br"),v("div",null,"empty object"),v("div",null,{}),v("br"),v("div",null,"null"),v("div",null,null),v("br"),v("div",null,"undefined"),v("div",null,void 0),v("br"),v("ul",null,function(){var e=[];if(u.count>=0)for(var n=u.count;n--;)e.push(v("li",null,n));return e}()),v("img",{className:"div",id:"ok",src:"http://placeimg.com/640/480/any"})])])}},s={s:1,up:function(){return s.s+=1},down:function(){return s.s-=1},view:function(){return v("div",null,[s.s>0?v("h1",null,s.s):v("small"),v("button",{onclick:s.up},"+"),v("button",{onclick:s.down},"-")])}},c={s:1,up:function(){return c.s+=1},down:function(){return c.s+=-1},view:function(){return v("div",{oninit:function(e){console.log("component oninit",e)},oncreate:function(e){console.log("component oncreate",e)},onupdate:function(e){console.log("component onupdate",e)},onremove:function(e){console.log("component onremove",e)}},[c.s>0?v("h1",{oninit:function(e){console.log("oninit",e)},oncreate:function(e){console.log("oncreate",e)},onupdate:function(e){console.log("onupdate",e)},onremove:function(e){console.log("onremove",e)}},c.s):v("small"),v("button",{onclick:c.up},"+"),v("button",{onclick:c.down},"-"),v("ul",null,function(){var e=[];if(c.s>=0)for(var n=c.s;n--;)4!==n&&e.push(v("li",null,v("span",{onremove:function(e){console.log("onspanremove",e)}},n+1)));return e}())])}},p=function(){return{hidden:!0,view:function(e){var n=this;return[v("button",{onclick:function(){n.hidden=!n.hidden,v.update()}},this.hidden?"Unhide":"Hide"),v("div",null,this.hidden?"Hidden":"Unhidden")]}}},l={oninit:function(e){l.sub1=p(),l.sub2=p(),l.sub3=p()},view:function(){return[v(l.sub1,{hidden:!1}),v(l.sub2,{hidden:!0}),v(l.sub3)]}},d={Main:r,Hello:a,Counter:u,Diff:s,Lifecycle:c,Subcomponent:l},f=v.Router();return f.use(function(){return console.log("ok")}).get("/",[function(){return console.log("Init")},function(){return d.Hello}]).get("/hello",[function(){return d.Hello.getServer()},function(){return d.Hello}]).get("/counter",function(){return d.Counter}).get("/diff",function(){return d.Diff}).get("/lifecycle",function(){return d.Lifecycle}).get("/subcomponent",function(){return d.Subcomponent}).get("/hello/:ok",function(e){return d.Hello}),v.routes("body",f),{Pages:d}});
