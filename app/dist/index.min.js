!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?module.exports=b():typeof define==='function'&&define.amd?define(b):(a=a||self, a.App=b())}(this,function(){'use strict';var a=typeof window!=='undefined'?window:typeof global!=='undefined'?global:typeof self!=='undefined'?self:{};!function(){let b=function(a){let b,c,d,f,g,h='oninit',j='oncreate',k='onupdate',m='onremove',n='http://www.w3.org/2000/svg';function o(a,b,c,d,e){if(a.nt===1){a.props[b]!==g&&a.props[b](a,c);if(b===m){d=0;e=a.children.length;for(;d<e;d++)o(a.children[d],m);a.children=[]}}}function p(b){b.currentTarget.events['on'+b.type]!==g&&b.currentTarget.events['on'+b.type](b);a.update()}function q(a,b){o(a,h);a.dom=b?document.createElementNS(n,a.name):document.createElement(a.name);a.dom.events={}}function r(b,c,d,e,f,i,l,n,s,t){if(c.length===0){b.textContent='';return}f=c.length>d.length?c.length:d.length;for(n=0;n<f;n++){i=c[n];l=d[n];if(i===g){l!==g&&(l.nt===3&&o(l,m),b.removeChild(l.dom));continue}if(i.nt===g||i.nt===3){i.nt===g&&(c[n]=i={name:'#text',isVnode:!0,nodeValue:i,children:[],nt:3});l===g?(i.dom=document.createTextNode(i.nodeValue),b.appendChild(i.dom)):l.nt===1?(i.dom=document.createTextNode(i.nodeValue),o(l,m),b.replaceChild(i.dom,l.dom)):(i.dom=l.dom,i.nodeValue!==l.nodeValue&&(i.dom.nodeValue=i.nodeValue));continue}s=!a.is.mounted;e=e||i.isSVG;if(l===g)q(i,e),b.appendChild(i.dom),l={children:[]},s=!0;else{if(i.name!==l.name)q(i,e),o(l,m),b.replaceChild(i.dom,l.dom),s=!0;else{i.dom=l.dom;for(t in l.props){if(i.props[t]===g){if(typeof l.props[t]==='function'){i.dom.removeEventListener(t.slice(2),p);continue}if(a.is.node||e||i.dom[t]===g){i.dom.removeAttribute(t);continue}i.dom[t]=null}}}}r(i.dom,i.children,l.children,e);for(t in i.props){if((s||i.props[t]!==l.props[t])&&i.props[t]!==g){if(typeof i.props[t]==='function'){switch(t){case h:case j:case k:case m:break;default:i.dom.events[t]===g&&(i.dom.events[t]=i.props[t],i.dom.addEventListener(t.slice(2),p));break};continue}if(a.is.node||e||i.dom[t]===g){i.dom.setAttribute(t,i.props[t]);continue}i.dom[t]=i.props[t]}}!a.is.mounted&&!s&&(o(i,h),o(i,j));o(i,s?j:k,l)}}function s(a,b = !0){if(a.nodeType===3){return a.textContent}let c=a.nodeName.toLowerCase(),d='',e,f=a.attributes,g=a.childNodes;if(b){d+=`<${c}`;for(e=0;e<f.length;e++)d+=` ${f[e].name}="${f[e].value}"`;d+='>'}for(e=0;e<g.length;e++)d+=s(g[e]);d+=b?`</${c}>`:'';return d}a.update=function(e){e=a.utils.flat(arguments,0,[]);e[0]!==g&&e[0].isComponent!==g&&(b=e.shift());return new Promise(g=>{if(!a.is.updating){a.is.updating=!0;e.unshift(b);d=a.apply(a,e);r(f,d,c);c=d;a.is.updating=!1;a.is.mounted=!0;if(a.is.node){return g(s(f,!1))}g()}})};a.mount=function(b){f=a.is.node?document.createElement('div'):typeof b==='string'?document.querySelectorAll(b)[0]:b;c=a.utils.dom2vnode(f).children;return a.update.apply(this,a.utils.flat(arguments,1,[]))}};function c(a,b,d,e,f){if(typeof a==='string'){d={name:a,props:{},children:[],dom:null,isVnode:!0,nt:1,isSVG:a==='svg'};for(e in b)d.props[e]=b[e];c.utils.flat(arguments,2,d.children,!0);return d}if(typeof a!=='undefined'&&a.isComponent!==!0){if(typeof a==='function'){Object.assign(a,{view:a,isComponent:!0},b);return a}if(typeof a==='object'&&typeof a.view==='function'){a.isComponent=!0;return a}}if(a.isComponent){f=a.view.apply(a,c.utils.flat(arguments,1,[]));return Array.isArray(f)?f:[f]}}c.utils={flat:function(a,b,d,e,f){f=a.length;e===undefined&&(e=!1);for(;b<f;b++){if(Array.isArray(a[b])){d=c.utils.flat(a[b],0,d);continue}(e===!1||a[b]!==undefined&&a[b]!==null)&&d.push(a[b])}return d},dom2vnode(a,b){if(a.nodeType===3){return{name:'#text',isVnode:!0,nodeValue:a.nodeValue,children:[],dom:a,nt:3}}if(a.nodeType===1){b={name:a.nodeName.toLowerCase(),props:{},children:[],dom:a,isVnode:!0,nodeValue:null,nt:1};b.name==='svg'&&(b.isSVG=!0);b.dom.events={};Array.prototype.map.call(a.attributes,function(a){b.props[a.nodeName]=a.nodeValue});Array.prototype.forEach.call(a.childNodes,function(a){let d=c.utils.dom2vnode(a);d!==undefined&&b.children.push(d)});return b}}};c.is={node:typeof window==='undefined',mounted:!1,updating:!1};c.is.browser=!c.is.node;c.trust=function(a){let b=document.createElement('div');b.innerHTML=a.trim();return Array.prototype.map.call(b.childNodes,a=>c.utils.dom2vnode(a))};let g=[];c.use=function(a,b){g.indexOf(a)===-1&&(a(c,b),g.push(a));return c};c.use(b);(c.is.node?a:window).v=c}();let b=(a,c = [])=>{if(typeof a==='function'){c.push(a);return c}let d=0,e=a.length;for(;d<e;d++){if(Array.isArray(a[d])){b(a[d],c);continue}c.push(a[d])}return c},c=(a,d,e)=>{let f,g;typeof e[0]==='string'&&(f=e.shift());if(typeof e[0]==='function'&&e[0].paths&&e[0].regexpList){let b=e.shift(),d=0,g=b.paths.length;for(;d<g;d++){let e=b.paths[d].middlewares,g=b.paths[d].method,h=b.paths[d].path;f&&(h=f+(h||'*'));h&&e.unshift(h);a=c(a,g,e)}}g=b(e);if(g.length>0){if(f&&a.regexpList[f]===undefined){f=f.replace(/\/(\?.*)?$/gi,'$1');let b=f.match(/:(\w+)?/gi)||[];for(let a in b)b[a]=b[a].slice(1);let c=f.replace(/:(\w+)/gi,'([^\\s\\/|\\?]+)').replace(/\*/g,'.*').replace(/\/(\?.*)?$/gi,'$1');a.regexpList[f]={regexp:new RegExp('^'+c+'/?(\\?.*)?$','gi'),params:b}}a.paths.push({method:d,path:f,middlewares:g})}return a},g=()=>{let a=async function(c = '/'){let d='get',e={},f=[],g,h=0,i=a.paths.length;a.url=c;for(;h<i;h++){let g=a.paths[h];if(d!==g.method&&g.method!=='use'){continue}if((g.method==='use'||d===g.method)&&g.path===undefined){b(g.middlewares,f);continue}let i=a.regexpList[g.path],j=i.regexp.exec(c);i.regexp.lastIndex=-1;if(Array.isArray(j)){j.shift();let a=i.params,c=a.length;while(c--)e[a[c]]===undefined&&(e[a[c]]=j[c]);b(g.middlewares,f)}}a.params=e;if(f.length>0){let a=0,b=f.length;for(;a<b;a++){g=await f[a](e);if(g){return g}}}if(a.throwNotFound){throw new Error(`The url ${c} requested wasn't found`)}};a.url='/';a.params={};a.throwNotFound=!0;a.paths=[];a.regexpList={};a.get=function(){return c(a,'get',v.utils.flat(arguments,0,[]))};a.use=function(){return c(a,'use',v.utils.flat(arguments,0,[]))};return a},h=function(a){let b,c;function d(d,e,f){return b(e).then(b=>{if(typeof b!=='object'){throw new Error('v.router.component.required')}!b.isComponent&&typeof b.view==='function'&&Object.assign(b,{isComponent:!0});if(!b.isComponent){throw new Error('v.router.component.required')}d&&(f.unshift(a(b,f)),b=d);f.unshift(b);if(a.is.node||!a.is.mounted){f.unshift(c);return a.mount.apply(a,f)}return a.update.apply(a,f)})}a.routes=function(d,e){if(d&&e){b=e;c=d;if(a.is.browser){function b(){a.routes.go(document.location.pathname)}window.addEventListener('popstate',b,!1);b()}}};a.routes.get=function(){let a=[];b.paths.forEach(b=>{b.method==='get'&&a.push(b.path===''?'/':b.path)});return a};a.routes.current='/';a.routes.params={};a.routes.go=function(){let b=a.utils.flat(arguments,0,[]),c,e;typeof b[0]==='object'&&(!b[0].isComponent&&typeof b[0].view==='function'&&(b[0]=Object.assign(b[0],{isComponent:!0})),b[0].isComponent&&(c=b.shift()));typeof b[0]==='string'&&(e=b.shift());if(!e){throw new Error('v.router.url.required')}a.is.browser&&window.history.pushState({},'',e);return d(c,e,b)};a.Router=g},j=function(a){let b=function(c = '',d = {}){let e=c.replace(/\/$/gi,'').trim(),f=Object.assign({methods:['get','post','put','patch','delete']},d),g;function h(a,b){let c=encodeURIComponent;return Object.keys(a).map(d=>{let e=b?b+'['+d+']':d;return typeof a[d]==='object'?h(a[d],e):c(e)+'='+c(a[d])}).join('&')}function i(a,b,c,d = {}){let e=Object.assign({method:a.toLowerCase(),headers:{Accept:'application/json','Content-Type':'application/json'}},i.options,d),f=e.headers.Accept;if(e.methods.indexOf(a)===-1){throw new Error('Method not allowed')}c!==undefined&&(e.method==='get'&&typeof c==='object'&&(b+=c=h(c)),e.method!=='get'&&(e.body=JSON.stringify(c)));return fetch(g(b),e).then(a=>{if(!a.ok){let b=new Error(a.statusText);b.response=a;throw b}if(/text/gi.test(f)){return a.text()}if(/json/gi.test(f)){return a.json()}return a})}g=function(b){let c=/^https?/gi.test(b)?b:(i.urls.base+b).trim().replace(/^\/\//gi,'/').trim();a.is.node&&typeof i.urls.node==='string'&&(i.urls.node=i.urls.node.replace(/\/$/gi,'').trim(),typeof i.urls.api==='string'&&(i.urls.api=i.urls.api.replace(/\/$/gi,'').trim(),c=c.replace(i.urls.api,i.urls.node)),/^https?/gi.test(c)||(c=i.urls.node+c));return c};i.new=function(a,c){return b(a,c)};i.urls={};i.urls.api=undefined;i.urls.node=undefined;i.urls.base=e;i.options=f;f.methods.forEach(a=>i[a]=(b,c,d)=>i(a,b,c,d));return i};a.request=b()},k=function(a){a.is.browser&&(a.sw=function(b = a.sw.file,c = a.sw.options){return navigator.serviceWorker.register(b,c).then(()=>navigator.serviceWorker.ready).then(()=>{a.sw.ready=!0;a.sw.file=b;a.sw.options=c;return new Promise(a=>{setTimeout(()=>{a(navigator.serviceWorker)},10)})})},a.sw.ready=!1,a.sw.file='/sw.js',a.sw.options={scope:'/'})};v.use(h).use(j).use(k);var m={view(){return[v("link",{"rel":"shortcut icon","href":"/icons/favicon.ico"}),v("link",{"rel":"icon","type":"image/png","sizes":"16x16","href":"/icons/favicon-16x16.png"}),v("link",{"rel":"icon","type":"image/png","sizes":"32x32","href":"/icons/favicon-32x32.png"}),v("link",{"rel":"manifest","href":"/icons/manifest.json"}),v("meta",{"name":"mobile-web-app-capable","content":"yes"}),v("meta",{"name":"theme-color","content":"#fff"}),v("meta",{"name":"application-name","content":"Valyrian.js"}),v("link",{"rel":"apple-touch-icon","sizes":"57x57","href":"/icons/apple-touch-icon-57x57.png"}),v("link",{"rel":"apple-touch-icon","sizes":"60x60","href":"/icons/apple-touch-icon-60x60.png"}),v("link",{"rel":"apple-touch-icon","sizes":"72x72","href":"/icons/apple-touch-icon-72x72.png"}),v("link",{"rel":"apple-touch-icon","sizes":"76x76","href":"/icons/apple-touch-icon-76x76.png"}),v("link",{"rel":"apple-touch-icon","sizes":"114x114","href":"/icons/apple-touch-icon-114x114.png"}),v("link",{"rel":"apple-touch-icon","sizes":"120x120","href":"/icons/apple-touch-icon-120x120.png"}),v("link",{"rel":"apple-touch-icon","sizes":"144x144","href":"/icons/apple-touch-icon-144x144.png"}),v("link",{"rel":"apple-touch-icon","sizes":"152x152","href":"/icons/apple-touch-icon-152x152.png"}),v("link",{"rel":"apple-touch-icon","sizes":"167x167","href":"/icons/apple-touch-icon-167x167.png"}),v("link",{"rel":"apple-touch-icon","sizes":"180x180","href":"/icons/apple-touch-icon-180x180.png"}),v("link",{"rel":"apple-touch-icon","sizes":"1024x1024","href":"/icons/apple-touch-icon-1024x1024.png"}),v("meta",{"name":"apple-mobile-web-app-capable","content":"yes"}),v("meta",{"name":"apple-mobile-web-app-status-bar-style","content":"black-translucent"}),v("meta",{"name":"apple-mobile-web-app-title","content":"Valyrian.js"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)","href":"/icons/apple-touch-startup-image-320x460.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)","href":"/icons/apple-touch-startup-image-640x920.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)","href":"/icons/apple-touch-startup-image-640x1096.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)","href":"/icons/apple-touch-startup-image-750x1294.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)","href":"/icons/apple-touch-startup-image-1182x2208.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)","href":"/icons/apple-touch-startup-image-1242x2148.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)","href":"/icons/apple-touch-startup-image-748x1024.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)","href":"/icons/apple-touch-startup-image-768x1004.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)","href":"/icons/apple-touch-startup-image-1496x2048.png"}),v("link",{"rel":"apple-touch-startup-image","media":"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)","href":"/icons/apple-touch-startup-image-1536x2008.png"}),v("meta",{"name":"msapplication-TileColor","content":"#fff"}),v("meta",{"name":"msapplication-TileImage","content":"/icons/mstile-144x144.png"}),v("meta",{"name":"msapplication-config","content":"/icons/browserconfig.xml"})]}},n="2.0.8";let o={title:'Valyrian.js',version:n,view(a){return v('html',{lang:'en'},[v('head',null,[v('title',null,o.title),v('style',null,v.inline.uncss()),v(m)]),v('body',null,[a,v('script',{src:'/index.min.js',async:!0})])])}},p={data:{hello:'Hello',name:'world'},getServer(){return v.request.get('/api/hola').then(a=>{this.data=a})}};function q(){return v('div',{id:'mundo',class:'hola'},`${this.data.hello} ${this.data.name}`)}var r=v(q,p);let s={count:0,down:a=>{s.count-=a},up:a=>{s.count+=a},view:()=>{return v('div',null,[v('h1',null,s.count),v('button',{onclick:()=>s.down(1)},'-'),v('button',{onclick:()=>s.up(1)},'+'),v('a',{href:'/hello',onclick(a){v.routes.go('/hello');a.preventDefault()}},'Go to hello'),v('div',null,[s.count===2?v('span',null,2):'',v('br'),v('div',null,'boolean true'),v('div',null,!0),v('br'),v('div',null,'boolean false'),v('div',null,!1),v('br'),v('div',null,'empty object'),v('div',null,{}),v('br'),v('div',null,'null'),v('div',null,null),v('br'),v('div',null,'undefined'),v('div',null,undefined),v('br'),v('ul',null,function(){let a=[];if(s.count>=0){for(let b=s.count;b--;)a.push(v('li',null,b))}return a}()),v('img',{className:'div',id:'ok',src:'http://placeimg.com/640/480/any'})])])}},u={s:1,up:()=>u.s+=1,down:()=>u.s-=1,view(){return v('div',null,[u.s>0?v('h1',null,u.s):v('small'),v('button',{onclick:u.up},'+'),v('button',{onclick:u.down},'-')])}},w={s:1,up:()=>w.s+=1,down:()=>w.s+=-1,view(){return v('div',{oninit(a){console.log('component oninit',a)},oncreate(a){console.log('component oncreate',a)},onupdate(a){console.log('component onupdate',a)},onremove(a){console.log('component onremove',a)}},[w.s>0?v('h1',{oninit(a){console.log('oninit',a)},oncreate(a){console.log('oncreate',a)},onupdate(a){console.log('onupdate',a)},onremove(a){console.log('onremove',a)}},w.s):v('small'),v('button',{onclick:w.up},'+'),v('button',{onclick:w.down},'-'),v('ul',null,function(){let a=[];if(w.s>=0){for(let b=w.s;b--;)b!==4&&a.push(v('li',null,v('span',{onremove(a){console.log('onspanremove',a)}},b+1)))}return a}())])}},x=function(){return{hidden:!0,view(a){return[v('button',{onclick:()=>{this.hidden=!this.hidden;v.update()}},this.hidden?'Unhide':'Hide'),v('div',null,this.hidden?'Hidden':'Unhidden')]}}},y={oninit(a){y.sub1=x();y.sub2=x();y.sub3=x()},view(){return[v(y.sub1,{hidden:!1}),v(y.sub2,{hidden:!0}),v(y.sub3)]}},z={Main:o,Hello:r,Counter:s,Diff:u,Lifecycle:w,Subcomponent:y},A=v.Router();A.use(()=>console.log('ok')).get('/',[()=>console.log('Init'),()=>z.Hello]).get('/hello',[()=>z.Hello.getServer(),()=>z.Hello]).get('/counter',()=>z.Counter).get('/diff',()=>z.Diff).get('/lifecycle',()=>z.Lifecycle).get('/subcomponent',()=>z.Subcomponent).get('/hello/:ok',a=>{return z.Hello});v.routes('body',A);var B={Pages:z};return B})
