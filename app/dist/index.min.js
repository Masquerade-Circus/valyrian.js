!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.App=n()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(){var n,t,o,i,r=[];function a(e,n,t,o,i){if("string"==typeof e){for(o in t={name:e,props:{},children:[],dom:null,isVnode:!0,nt:1,isSVG:"svg"===e},n)t.props[o]=n[o];return a.utils.flat(arguments,2,t.children,!0),t}return"function"==typeof e?Object.assign({view:e,isComponent:!0},n):"object"==typeof e&&("function"==typeof e.view&&Object.assign(e,{isComponent:!0}),e.isComponent)?(i=e.view.apply(e,a.utils.flat(arguments,1,[])),Array.isArray(i)?i:[i]):void 0}function u(e,n){if(3===e.nodeType||1===e.nodeType)return 3===(n={name:e.nodeName.toLowerCase(),props:{},children:[],dom:e,isVnode:!0,nodeValue:null,nt:e.nodeType}).nt?(n.nodeValue=e.nodeValue,n):("svg"===n.name&&(n.isSVG=!0),n.dom.events={},Array.prototype.map.call(e.attributes,function(e){n.props[e.nodeName]=e.nodeValue}),Array.prototype.forEach.call(e.childNodes,function(e){var t=u(e);void 0!==t&&n.children.push(t)}),n)}function p(e,n){if(void 0!==e.props[n])return e.props[n](e)}function l(e){void 0!==e.currentTarget.events["on"+event.type]&&e.currentTarget.events["on"+event.type](e),a.update()}a.utils={flat:function(e,n,t,o,i){for(i=e.length,void 0===o&&(o=!1);n<i;n++)Array.isArray(e[n])?t=a.utils.flat(e[n],0,t):(!1===o||void 0!==e[n]&&null!==e[n])&&t.push(e[n]);return t}},(a.is={node:"undefined"==typeof window,mounted:!1,updating:!1}).browser=!a.is.node,a.trust=function(e){var n=document.createElement("div");return n.innerHTML=e.trim(),Array.prototype.map.call(n.childNodes,function(e){return u(e)})},a.update=function(e){return"object"==typeof(e=a.utils.flat(arguments,0,[]))[0]&&e[0].isComponent&&(n=e.shift()),new Promise(function(r){if(!a.is.updating){if(a.is.updating=!0,e.unshift(n),o=a.apply(a,e),function e(n,t,o,i,r,u,c,s,d,v){if(0!==t.length)for(r=t.length>o.length?t.length:o.length,s=0;s<r;s++)if(c=o[s],void 0!==(u=t[s]))if(void 0!==u.nt){if(d=!a.is.mounted,i=i||u.isSVG,void 0===c)p(u,"oninit"),u.dom=i?document.createElementNS("http://www.w3.org/2000/svg",u.name):document.createElement(u.name),u.dom.events={},n.appendChild(u.dom),c={children:[]},d=!0;else if(u.name!==c.name)p(u,"oninit"),u.dom=i?document.createElementNS("http://www.w3.org/2000/svg",u.name):document.createElement(u.name),u.dom.events={},p(c,"onremove"),n.replaceChild(u.dom,c.dom),d=!0;else for(v in u.dom=c.dom,c.props)if(void 0===u.props[v]){if("function"==typeof c.props[v]){u.dom.removeEventListener(v.slice(2),l);continue}if(a.is.node||i||void 0===u.dom[v]){u.dom.removeAttribute(v);continue}u.dom[v]=null}for(v in e(u.dom,u.children,c.children,i),u.props)if((d||u.props[v]!==c.props[v])&&void 0!==u.props[v]){if("function"==typeof u.props[v]){switch(v){case"oninit":case"oncreate":case"onupdate":case"onremove":break;default:void 0===u.dom.events[v]&&(u.dom.events[v]=u.props[v],u.dom.addEventListener(v.slice(2),l))}continue}if(a.is.node||i||void 0===u.dom[v]){u.dom.setAttribute(v,u.props[v]);continue}u.dom[v]=u.props[v]}a.is.mounted||d||(p(u,"oninit"),p(u,"oncreate")),p(u,d?"oncreate":"onupdate")}else t[s]=u={name:"#text",isVnode:!0,nodeValue:u,nt:3},void 0===c?(u.dom=document.createTextNode(u.nodeValue),n.appendChild(u.dom)):1===c.nt?(u.dom=document.createTextNode(u.nodeValue),p(c,"onremove"),n.replaceChild(u.dom,c.dom)):(u.dom=c.dom,u.nodeValue!=c.nodeValue&&(u.dom.nodeValue=u.nodeValue));else void 0!==c&&(3===c.nt&&p(c,"onremove"),n.removeChild(c.dom));else n.textContent=""}(i,o,t),t=o,a.is.updating=!1,a.is.mounted=!0,a.is.node)return r(i.innerHTML);r()}})},a.mount=function(e,n){return i=a.is.node?document.createElement("div"):"string"==typeof e?document.querySelectorAll(e)[0]:e,t=u(i).children,a.update.apply(this,a.utils.flat(arguments,1,[]))},a.use=function(e,n){return-1===r.indexOf(e)&&(e(a,n),r.push(e)),a},(a.is.node?e:window).v=a}();var n=function(e,t){if(void 0===t&&(t=[]),"function"==typeof e)return t.push(e),t;for(var o=0,i=e.length;o<i;o++)Array.isArray(e[o])?n(e[o],t):t.push(e[o]);return t},t=function(e,o,i){var r,a;if("string"==typeof i[0]&&(r=i.shift()),"function"==typeof i[0]&&i[0].paths&&i[0].regexpList)for(var u=i.shift(),p=0,l=u.paths.length;p<l;p++){var c=u.paths[p].middlewares,s=u.paths[p].method,d=u.paths[p].path;r&&(d=r+(d||"*")),d&&c.unshift(d),e=t(e,s,c)}if((a=n(i)).length>0){if(r&&void 0===e.regexpList[r]){var v=(r=r.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var f in v)v[f]=v[f].slice(1);var h=r.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");e.regexpList[r]={regexp:RegExp("^"+h+"/?(\\?.*)?$","gi"),params:v}}e.paths.push({method:o,path:r,middlewares:a})}return e},o=function(){var e=async function(t){void 0===t&&(t="/");var o,i={},r=[],a=0,u=e.paths.length;for(e.url=t;a<u;a++){var p=e.paths[a];if("get"===p.method||"use"===p.method)if("use"!==p.method&&"get"!==p.method||void 0!==p.path){var l=e.regexpList[p.path],c=l.regexp.exec(t);if(l.regexp.lastIndex=-1,Array.isArray(c)){c.shift();for(var s=l.params,d=s.length;d--;)void 0===i[s[d]]&&(i[s[d]]=c[d]);n(p.middlewares,r)}}else n(p.middlewares,r)}if(e.params=i,r.length>0)for(var v=0,f=r.length;v<f;v++)if(o=await r[v](i))return o;if(e.throwNotFound)throw Error("The url "+t+" requested wasn't found")};return e.url="/",e.params={},e.throwNotFound=!0,e.paths=[],e.regexpList={},e.get=function(){return t(e,"get",v.utils.flat(arguments,0,[]))},e.use=function(){return t(e,"use",v.utils.flat(arguments,0,[]))},e};v.use(function(e){var n,t;e.routes=function(o,i){if(o&&i&&(n=i,t=o,e.is.browser)){function r(){e.routes.go(document.location.pathname)}window.addEventListener("popstate",r,!1),r()}},e.routes.get=function(){var e=[];return n.paths.forEach(function(n){"get"===n.method&&e.push(""===n.path?"/":n.path)}),e},e.routes.current="/",e.routes.params={},e.routes.go=function(){var o,i,r=e.utils.flat(arguments,0,[]);if("object"==typeof r[0]&&(r[0].isComponent||"function"!=typeof r[0].view||(r[0]=Object.assign(r[0],{isComponent:!0})),r[0].isComponent&&(o=r.shift())),"string"==typeof r[0]&&(i=r.shift()),!i)throw Error("v.router.url.required");return e.is.browser&&window.history.pushState({},"",i),function(o,i,r){return n(i).then(function(n){if("object"!=typeof n)throw Error("v.router.component.required");if(n.isComponent||"function"!=typeof n.view||Object.assign(n,{isComponent:!0}),!n.isComponent)throw Error("v.router.component.required");return o&&(r.unshift(e(n,r)),n=o),r.unshift(n),e.is.node||!e.is.mounted?(r.unshift(t),e.mount.apply(e,r)):e.update.apply(e,r)})}(o,i,r)},e.Router=o}).use(function(e){var n=function(t,o){void 0===t&&(t=""),void 0===o&&(o={});var i,r=t.replace(/\/$/gi,"").trim(),a=Object.assign({methods:["get","post","put","patch","delete"]},o);function u(e,n,t,o){void 0===o&&(o={});var r=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},u.options,o),a=r.headers.Accept;return void 0!==t&&("get"===r.method&&"object"==typeof t&&(n+=t=function e(n,t){var o=encodeURIComponent;return Object.keys(n).map(function(i){var r=t?t+"["+i+"]":i;return"object"==typeof n[i]?e(n[i],r):o(r)+"="+o(n[i])}).join("&")}(t)),"get"!==r.method&&(r.body=JSON.stringify(t))),fetch(i(n),r).then(function(e){if(e.status<200||e.status>300){var n=Error(e.statusText);throw n.response=e,n}return/text/gi.test(a)?e.text():/json/gi.test(a)?e.json():e})}return i=function(n){var t=/^https?/gi.test(n)?n:(u.baseUrl+"/"+n).trim().replace(/^\/\//gi,"/").trim();return e.is.node&&"string"==typeof u.nodeUrl&&(u.nodeUrl=u.nodeUrl.replace(/\/$/gi,"").trim(),/^https?/gi.test(t)&&"string"==typeof u.apiUrl&&(u.apiUrl=u.apiUrl.replace(/\/$/gi,"").trim(),t=t.replace(u.apiUrl,u.nodeUrl)),/^https?/gi.test(t)||(t=u.nodeUrl+t)),t},u.new=function(e,t){return n(e,t)},u.apiUrl=void 0,u.nodeUrl=void 0,u.options=a,u.baseUrl=r,a.methods.forEach(function(e){return u[e]=function(n,t,o){return u(e,n,t,o)}}),u};e.request=n()}).use(function(e){e.is.browser&&(e.sw=function(n,t){return void 0===n&&(n=e.sw.file),void 0===t&&(t=e.sw.options),navigator.serviceWorker.register(n,t).then(function(){return navigator.serviceWorker.ready}).then(function(o){return e.sw.ready=!0,e.sw.file=n,e.sw.options=t,new Promise(function(e,n){setTimeout(function(){e(navigator.serviceWorker)},10)})})},e.sw.ready=!1,e.sw.file="/sw.js",e.sw.options={scope:"/"})});var i={view:function(){return[v("link",{rel:"apple-touch-icon",sizes:"114x114",href:"/icons/apple-touch-icon-114x114.png"}),v("link",{rel:"apple-touch-icon",sizes:"120x120",href:"/icons/apple-touch-icon-120x120.png"}),v("link",{rel:"apple-touch-icon",sizes:"144x144",href:"/icons/apple-touch-icon-144x144.png"}),v("link",{rel:"apple-touch-icon",sizes:"152x152",href:"/icons/apple-touch-icon-152x152.png"}),v("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/icons/apple-touch-icon-180x180.png"}),v("link",{rel:"apple-touch-icon",sizes:"57x57",href:"/icons/apple-touch-icon-57x57.png"}),v("link",{rel:"apple-touch-icon",sizes:"60x60",href:"/icons/apple-touch-icon-60x60.png"}),v("link",{rel:"apple-touch-icon",sizes:"72x72",href:"/icons/apple-touch-icon-72x72.png"}),v("link",{rel:"apple-touch-icon",sizes:"76x76",href:"/icons/apple-touch-icon-76x76.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-320x460.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x920.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x1096.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-750x1294.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1182x2208.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1242x2148.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-748x1024.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1496x2048.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-768x1004.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1536x2008.png"}),v("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/icons/favicon-16x16.png"}),v("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/icons/favicon-32x32.png"}),v("link",{rel:"manifest",href:"/icons/manifest.json"}),v("link",{rel:"shortcut icon",href:"/icons/favicon.ico"}),v("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),v("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),v("meta",{name:"apple-mobile-web-app-title",content:"Valyrian.js"}),v("meta",{name:"application-name",content:"Valyrian.js"}),v("meta",{name:"mobile-web-app-capable",content:"yes"}),v("meta",{name:"msapplication-TileColor",content:"#fff"}),v("meta",{name:"msapplication-TileImage",content:"/icons/mstile-144x144.png"}),v("meta",{name:"msapplication-config",content:"/icons/browserconfig.xml"}),v("meta",{name:"theme-color",content:"#fff"})]}},r={title:"Valyrian.js",version:"2.0.2",view:function(e){return v("html",{lang:"en"},[v("head",null,[v("title",null,r.title),v("style",null,v.inline.uncss()),v(i)]),v("body",null,[e,v("script",{src:"/index.min.js",async:!0})])])}};var a=v(function(){return v("div",{id:"mundo",class:"hola"},this.data.hello+" "+this.data.name)},{data:{hello:"Hello",name:"world"},getServer:function(){var e=this;return v.request.get("/api/hola").then(function(n){e.data=n})}}),u={count:0,down:function(e){u.count-=e},up:function(e){u.count+=e},view:function(){return v("div",null,[v("h1",null,u.count),v("button",{onclick:function(){return u.down(1)}},"-"),v("button",{onclick:function(){return u.up(1)}},"+"),v("a",{href:"/hello",onclick:function(e){v.routes.go("/hello"),e.preventDefault()}},"Go to hello"),v("div",null,[2===u.count?v("span",null,2):"",v("br"),v("div",null,"boolean true"),v("div",null,!0),v("br"),v("div",null,"boolean false"),v("div",null,!1),v("br"),v("div",null,"empty object"),v("div",null,{}),v("br"),v("div",null,"null"),v("div",null,null),v("br"),v("div",null,"undefined"),v("div",null,void 0),v("br"),v("ul",null,function(){var e=[];if(u.count>=0)for(var n=u.count;n--;)e.push(v("li",null,n));return e}()),v("img",{className:"div",id:"ok",src:"http://placeimg.com/640/480/any"})])])}},p={s:1,up:function(){return p.s+=1},down:function(){return p.s-=1},view:function(){return v("div",null,[p.s>0?v("h1",null,p.s):v("small"),v("button",{onclick:p.up},"+"),v("button",{onclick:p.down},"-")])}},l={s:1,up:function(){return l.s+=1},down:function(){return l.s+=-1},view:function(){return v("div",{oninit:function(e){console.log("component oninit",e)},oncreate:function(e){console.log("component oncreate",e)},onupdate:function(e){console.log("component onupdate",e)},onremove:function(e){console.log("component onremove",e)}},[l.s>0?v("h1",{oninit:function(e){console.log("oninit",e)},oncreate:function(e){console.log("oncreate",e)},onupdate:function(e){console.log("onupdate",e)},onremove:function(e){console.log("onremove",e)}},l.s):v("small"),v("button",{onclick:l.up},"+"),v("button",{onclick:l.down},"-"),v("ul",null,function(){var e=[];if(l.s>=0)for(var n=l.s;n--;)4!==n&&e.push(v("li",null,v("span",{onremove:function(e){console.log("onspanremove",e)}},n+1)));return e}())])}},c=function(){return{hidden:!0,view:function(e){var n=this;return[v("button",{onclick:function(){n.hidden=!n.hidden,v.update()}},this.hidden?"Unhide":"Hide"),v("div",null,this.hidden?"Hidden":"Unhidden")]}}},s={oninit:function(e){s.sub1=c(),s.sub2=c(),s.sub3=c()},view:function(){return[v(s.sub1,{hidden:!1}),v(s.sub2,{hidden:!0}),v(s.sub3)]}},d={Main:r,Hello:a,Counter:u,Diff:p,Lifecycle:l,Subcomponent:s},f=v.Router();return f.use(function(){return console.log("ok")}).get("/",[function(){return console.log("Init")},function(){return d.Hello}]).get("/hello",[function(){return d.Hello.getServer()},function(){return d.Hello}]).get("/counter",function(){return d.Counter}).get("/diff",function(){return d.Diff}).get("/lifecycle",function(){return d.Lifecycle}).get("/subcomponent",function(){return d.Subcomponent}).get("/hello/:ok",function(e){return d.Hello}),v.routes("body",f),{Pages:d}});
