!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.App=n()}(this,function(){"use strict";!function(){var e=function(n,t){if(void 0===t&&(t=[]),"function"==typeof n)return t.push(n),t;for(var o=0,i=n.length;o<i;o++)Array.isArray(n[o])&&e(n[o],t),Array.isArray(n[o])||t.push(n[o]);return t},n=function(t,o,i){var r,a;if("string"==typeof i[0]&&(r=i.shift()),"function"==typeof i[0]&&void 0!==i[0].paths&&void 0!==i[0].regexpList)for(var c=i.shift(),s=0,u=c.paths.length;s<u;s++){var p=c.paths[s].middlewares,l=c.paths[s].method,d=c.paths[s].path;void 0!==r&&(d=r+(d||"*")),void 0!==d&&p.unshift(d),t=n(t,l,p)}if((a=e(i)).length>0){if(void 0!==r&&void 0===t.regexpList[r]){var v=(r=r.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var f in v)v[f]=v[f].replace(":","");var h=r.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");t.regexpList[r]={regexp:RegExp("^"+h+"/?(\\?.*)?$","gi"),params:v}}t.paths.push({method:o,path:r,middlewares:a})}return t},t=function(){for(var e=arguments,n=[],o=arguments.length;o--;)n[o]=e[o];var i,r,a,c={name:"div",props:{},children:[]};if("string"==typeof n[0]&&n[0].trim().length>0&&(c.name=n.shift()),"textNode"===c.name)return c.value=n.join(" ").trim(),c;if(t.isVnode(n[0])||"object"!=typeof n[0]||Array.isArray(n[0])||null===n[0]||(c.props=n.shift()),/(\.|\[|#)/gi.test(c.name)&&(a=c.name.match(/([\.|\#]\w+|\[[^\]]+\])/gi),c.name=c.name.replace(/([\.|\#]\w+|\[[^\]]+\])/gi,""),a))for(i=a.length;i--;)"#"!==a[i].charAt(0)?"."!==a[i].charAt(0)?"["===a[i].charAt(0)&&(a[i]=a[i].trim().slice(1,-1).split("="),c.props[a[i][0]]=a[i][1]):c.props.class=((c.props.class||"")+" "+a[i].slice(1)).trim():c.props.id=a[i].slice(1);var s=t.flatenArray(n);for(r=0,i=s.length;r<i;r++)c.children.push(t.isVnode(s[r])?s[r]:t("textNode",s[r]));return c};t.flatenArray=function(e,n){if(void 0===n&&(n=[]),!Array.isArray(e))return n.push(e),n;for(var o=0,i=e.length;o<i;o++)Array.isArray(e[o])&&t.flatenArray(e[o],n),Array.isArray(e[o])||n.push(e[o]);return n},t.isVnode=function(e){return e&&e.name&&e.props&&e.children},t.vnode=function(e){if(e)return 3===e.nodeType?{value:e.nodeValue,name:"textNode",props:{},children:[],dom:e}:{name:e.nodeName.toLowerCase(),props:{},children:Array.prototype.map.call(e.childNodes,function(e){return t.vnode(e)}),dom:e}};var o=function(e,n){void 0===e&&(e=""),void 0===n&&(n={});var t,i=e.replace(/\/$/gi,"").trim(),r=Object.assign({},n),a="undefined"==typeof window,c=a?require("node-fetch"):fetch.bind(window);function s(e,n,o,i){void 0===i&&(i={});var r=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},s.options,i),a=r.headers.Accept;return void 0!==o&&("get"===r.method&&"object"==typeof o&&(n+=o=function e(n,t){var o=encodeURIComponent;return"?"+Object.keys(n).map(function(i){return void 0!==t&&(i=t+"["+i+"]"),"object"==typeof n[i]?e(n[i],i):o(i)+"="+o(n[i])}).join("&")}(o)),"get"!==r.method&&(r.body=JSON.stringify(o))),c(t(n),r).then(function(e){if(e.status<200||e.status>300){var n=Error(e.statusText);throw n.response=e,n}return/text/gi.test(a)?e.text():/json/gi.test(a)?e.json():e})}return t=function(e){var n=/^https?/gi.test(e)?e:(s.baseUrl+"/"+e).trim().replace(/^\/\//gi,"/").trim();return a&&"string"==typeof s.nodeUrl&&(s.nodeUrl=s.nodeUrl.replace(/\/$/gi,"").trim(),/^https?/gi.test(n)&&"string"==typeof s.apiUrl&&(s.apiUrl=s.apiUrl.replace(/\/$/gi,"").trim(),n=n.replace(s.apiUrl,s.nodeUrl)),/^https?/gi.test(n)||(n=s.nodeUrl+n)),n},s.new=function(e,n){var t=s.baseUrl+"/"+e,i=Object.assign({},s.options,n);return o(t,i)},s.apiUrl=void 0,s.nodeUrl=void 0,s.options=r,s.baseUrl=i,["get","post","put","patch","delete"].forEach(function(e){return s[e]=function(n,t,o){return s(e,n,t,o)}}),s},i=o();function r(e){return"object"==typeof e&&null!==e&&"function"==typeof e.view}function a(e,n){void 0===n&&(n={}),e.attributes=n.name&&n.props&&Array.isArray(n.children)?{children:n}:Array.isArray(n)?{children:1===n.length?n[0]:n}:Object.assign({},e.attributes,n)}function c(e,n){void 0===n&&(n={}),a(e,n);var t=e.view();return Array.isArray(t)?t:[t]}function s(){for(var e=arguments,n=[],o=arguments.length;o--;)n[o]=e[o];return r(n[0])?c.apply(s,n):t.apply(t,n)}function u(e,n,t,o){s.is.browser&&n.split(" ").forEach(function(n){e.addEventListener(n,t,o)})}s.ready=function(e){u(document,/https?:\/\//.test(window.document.URL)?"DOMContentLoaded":"deviceready",e,!1)},s.request=i,s.router=function(){var t=async function(n){void 0===n&&(n="/");var o,i={},r=[],a=0,c=t.paths.length;for(t.url=n;a<c;a++){var s=t.paths[a];if("get"===s.method||"use"===s.method)if("use"!==s.method&&"get"!==s.method||void 0!==s.path){var u=t.regexpList[s.path].regexp.exec(n);if(t.regexpList[s.path].regexp.lastIndex=-1,Array.isArray(u)){u.shift();for(var p=t.regexpList[s.path].params.length;p--;)void 0===i[t.regexpList[s.path].params[p]]&&(i[t.regexpList[s.path].params[p]]=u[p]);r=e(s.middlewares,r)}}else r=e(s.middlewares,r)}if(t.params=i,r.length>0)for(var l=0,d=r.length;l<d;l++)if(void 0!==(o=await r[l](i)))return o;if(t.throwNotFound)throw Error("The url "+n+" requested wasn't found")};return t.url="/",t.params={},t.throwNotFound=!0,t.paths=[],t.regexpList={},["get","use"].map(function(e){t[e]=function(){for(var o=arguments,i=[],r=arguments.length;r--;)i[r]=o[r];return n(t,e,i)}}),t},(s.is={}).node="undefined"==typeof window,s.is.browser=!s.is.node,s.is.mounted=!1,s.window=s.is.node?require("html-element"):window;var p,l,d,v,f,h,m=function(e){var n=s.window.document;function o(e,n,t){"className"!==n?"function"!=typeof t?("boolean"==typeof t&&(e[n]=t),void 0!==t&&!1!==t?e.setAttribute(n,t):e.removeAttribute(n)):e[n]=t.bind(e):e.setAttribute("class",t)}function i(e,n){void 0===n&&(n={});var t=e.props,i=n.props||{},r=Object.assign({},t,i);for(var a in r)t[a]!==i[a]&&o(e.dom,a,t[a])}function r(e,n){return e.props&&e.props[n]&&e.props[n](e)}function a(e){var t;delete e.dom,r(e,"oninit"),t="textNode"===e.name?n.createTextNode(e.value):"svg"===e.name?n.createElementNS("http://www.w3.org/2000/svg",e.name):n.createElement(e.name),e.dom=t,i(e);for(var o=0;o<e.children.length;o++)t.appendChild(a(e.children[o]));return r(e,"oncreate"),t}function c(e,n){return void 0===n&&(n=!1),Promise.resolve(r(e,"onbeforeremove")).then(function(){!n&&e.dom&&e.dom.parentElement&&e.dom.parentElement.removeChild(e.dom);for(var t=0,o=e.children.length;t<o;t++)c(e.children[t],n);r(e,"onremove")})}return function e(n,o,s){if(void 0===s&&void 0!==o&&n.appendChild(a(o)),void 0===o&&c(s),t.isVnode(s)&&t.isVnode(o)){if(o.dom=s.dom,"textNode"===o.name&&s.value==o.value)return n;if("textNode"===o.name&&o.value!=s.value||o.name!==s.name)return a(o),Promise.resolve(c(s,!0)).then(function(){n.replaceChild(o.dom,s.dom)}),n;i(o,s);for(var u=Math.max(o.children.length,s.children.length),p=0;p<u;p++)e(o.dom,o.children[p],s.children[p]);r(o,"onupdate")}return n}}();function g(){s.is.mounted=!1,p=s.window.document.createElement("html"),s.window.document.createElement("div").appendChild(p),l=t.vnode(p),d=Object.assign({},l)}function w(e,n){return void 0===n&&(n={}),r(e)&&(a(e,n),v=e,l.props={},Object.keys(v).forEach(function(e){"function"==typeof v[e]&&(l.props[e]=function(){for(var n=arguments,t=[],o=arguments.length;o--;)t[o]=n[o];return v[e].apply(v,t)})})),v&&(s.is.node&&g(),l.children=c(v),m(l.dom.parentElement,l,d),d=Object.assign({},l),s.is.mounted||(s.is.mounted=!0)),s.is.node?require("he").decode(l.dom.parentElement.innerHTML):l.dom.parentElement}g(),s.mount=function(e,n,o){if(void 0===o&&(o={}),void 0===e)throw Error("A container element is required as first element");if(!r(n))throw Error("A component is required as a second argument");return s.is.browser&&p&&function(e,n,t){s.is.browser&&"mouseup keyup".split(" ").forEach(function(n){e.removeEventListener(n,t)})}(p,0,s.update),p=s.is.node?s.window.document.createElement("div"):"string"==typeof e?s.window.document.querySelectorAll(e)[0]:e,l=t.vnode(p),d=Object.assign({},l),s.is.browser&&u(p,"mouseup keyup",s.update,!1),s.update(n,o)},s.update=function(e,n){if(void 0===n&&(n={}),!s.is.browser)return w(e,n);requestAnimationFrame(function(){return w(e,n)})},(s.routes=function(e,n){if(!e||!n){var t=[];return f.paths.forEach(function(e){"get"===e.method&&t.push(""===e.path?"/":e.path)}),t}if(f=n,h=e,s.is.browser){var o=document.location.pathname;u(window,"popstate",function(){return s.routes.go(o)},!1),s.ready(function(){return s.routes.go(o)})}}).current="/",s.routes.params={},s.routes.go=async function(e,n){return s.is.browser&&window.history.pushState({},"",e),await async function(e,n){void 0===e&&(e="/"),void 0===n&&(n=void 0);var t=await f(e);if(!r(t)){var o=t;t={view:function(){return o}}}if(n){var i=t;t={view:function(){return s(n,s(i))}}}return s.is.node||!s.is.mounted?s.mount(h,t,{params:f.params}):s.update(t,{params:f.params})}(e,n)},s.is.browser&&((s.sw=function(e,n){return void 0===e&&(e=s.sw.file),void 0===n&&(n=s.sw.options),navigator.serviceWorker.register(e,n).then(function(){return navigator.serviceWorker.ready}).then(function(t){return s.sw.ready=!0,s.sw.file=e,s.sw.options=n,new Promise(function(e,n){setTimeout(function(){e(navigator.serviceWorker)},10)})}).catch(function(e){return console.error("ServiceWorker registration failed: ",e)})}).ready=!1,s.sw.file="/sw.js",s.sw.options={scope:"/"}),s.is.node&&"undefined"!=typeof VNodeFactory&&VNodeFactory(s),(s.is.node?global:window).v=s}();var e={view:function(){return[v("link",{rel:"apple-touch-icon",sizes:"114x114",href:"/icons/apple-touch-icon-114x114.png"}),v("link",{rel:"apple-touch-icon",sizes:"120x120",href:"/icons/apple-touch-icon-120x120.png"}),v("link",{rel:"apple-touch-icon",sizes:"144x144",href:"/icons/apple-touch-icon-144x144.png"}),v("link",{rel:"apple-touch-icon",sizes:"152x152",href:"/icons/apple-touch-icon-152x152.png"}),v("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/icons/apple-touch-icon-180x180.png"}),v("link",{rel:"apple-touch-icon",sizes:"57x57",href:"/icons/apple-touch-icon-57x57.png"}),v("link",{rel:"apple-touch-icon",sizes:"60x60",href:"/icons/apple-touch-icon-60x60.png"}),v("link",{rel:"apple-touch-icon",sizes:"72x72",href:"/icons/apple-touch-icon-72x72.png"}),v("link",{rel:"apple-touch-icon",sizes:"76x76",href:"/icons/apple-touch-icon-76x76.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-320x460.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x920.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x1096.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-750x1294.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1182x2208.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1242x2148.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-748x1024.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1496x2048.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-768x1004.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1536x2008.png"}),v("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/icons/favicon-16x16.png"}),v("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/icons/favicon-32x32.png"}),v("link",{rel:"manifest",href:"/icons/manifest.json"}),v("link",{rel:"shortcut icon",href:"/icons/favicon.ico"}),v("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),v("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),v("meta",{name:"apple-mobile-web-app-title",content:"Valyrian.js"}),v("meta",{name:"application-name",content:"Valyrian.js"}),v("meta",{name:"mobile-web-app-capable",content:"yes"}),v("meta",{name:"msapplication-TileColor",content:"#fff"}),v("meta",{name:"msapplication-TileImage",content:"/icons/mstile-144x144.png"}),v("meta",{name:"msapplication-config",content:"/icons/browserconfig.xml"}),v("meta",{name:"theme-color",content:"#fff"})]}},n={title:"",version:"",css:"",js:"",view:function(){return[v("head",[v("title",n.title),v("style",n.css),v(e)]),v("body",[n.attributes.children,v("script",n.js)])]}},t={data:{hello:"",name:""},oninit:function(){return t.getServer()},getServer:function(){return v.request.get("/api/hola").then(function(e){t.data=e})},view:function(){return v("div#mundo.hola",t.data.hello+" "+t.data.name)}},o={count:0,down:function(e){o.count-=e},up:function(e){o.count+=e},view:function(){return v("div",[v("h1",o.count),v("button",{onclick:function(){return o.down(1)}},"-"),v("button",{onclick:function(){return o.up(1)}},"+"),v("button",{onclick:function(){return v.routes.go("/hello")}},"Go to hello"),v([2===o.count?v(2):"",v("br"),v("","boolean true"),v(!0),v("br"),v("","boolean false"),v(!1),v("br"),v("","empty object"),v({},{}),v("br"),v("","null"),v(null),v("br"),v("","undefined"),v(void 0),v("br"),v("ul",function(){var e=[];if(o.count>=0)for(var n=o.count;n--;)e.push(v("li",n));return e}()),v("img.div[src=http://placeimg.com/640/480/any]#ok")])])}},i={s:1,up:function(){return i.s+=1},down:function(){return i.s-=1},view:function(){return v("div",[i.s>0?v("h1",i.s):v("small",""),v("button",{onclick:i.up},"+"),v("button",{onclick:i.down},"-")])}},r={s:1,up:function(){r.s+=1,console.log(r.s)},down:function(){return r.s+=-1},oninit:function(e){console.log("component oninit",e)},oncreate:function(e){console.log("component oncreate",e)},onupdate:function(e){console.log("component onupdate",e)},onbeforeremove:function(e){console.log("component onbeforeremove",e)},onremove:function(e){console.log("component onremove",e)},view:function(){return v("div",[r.s>0?v("h1",{oninit:function(e){console.log("oninit",e)},oncreate:function(e){console.log("oncreate",e)},onupdate:function(e){console.log("onupdate",e)},onbeforeremove:function(e){console.log("onbeforeremove",e)},onremove:function(e){console.log("onremove",e)}},r.s):v("small",""),v("button",{onclick:r.up},"+"),v("button",{onclick:r.down},"-"),v("ul",function(){var e=[];if(r.s>=0)for(var n=r.s;n--;)4!==n&&e.push(v("li",{onbeforeremove:function(e){return console.log("onbeforeremovelistart"),new Promise(function(e){setTimeout(function(){console.log("onbeforeremoveliend"),e()},2e3)})}},v("span",{onbeforeremove:function(e){return console.log("onbeforeremovespanstart"),new Promise(function(e){setTimeout(function(){console.log("onbeforeremovespanend"),e()},1e3)})},onremove:function(e){console.log("onspanremove",e)}},n)));return e}())])}},a=function(){return{hidden:!0,view:function(e){var n=this;return[v("button",{onclick:function(){n.hidden=!n.hidden,v.update()}},this.hidden?"Unhide":"Hide"),v("div",this.hidden?"Hidden":"Unhidden")]}}},c={oninit:function(e){c.sub1=a(),c.sub2=a(),c.sub3=a()},view:function(){return[v(c.sub1,{hidden:!1}),v(c.sub2,{hidden:!0}),v(c.sub3)]}},s={Main:n,Hello:t,Counter:o,Diff:i,Lifecycle:r,Subcomponent:c},u=v.router();return u.use(function(){return console.log("ok")}).get("/",[function(){return console.log("Init")},function(){return s.Hello}]).get("/hello",[function(){return s.Hello.getServer()},function(){return s.Hello}]).get("/counter",function(){return s.Counter}).get("/diff",function(){return s.Diff}).get("/lifecycle",function(){return s.Lifecycle}).get("/subcomponent",function(){return s.Subcomponent}).get("/hello/:ok",function(e){return s.Hello}),v.routes("body",u),v.isBrowser&&v.sw("./sw.js").then(function(){console.log("SW registered")}),{Components:s}});
