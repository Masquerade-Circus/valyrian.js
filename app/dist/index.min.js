(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global.App = factory());
}(this, (function () { 'use strict';

    !function(){var e=function(r,t){if(void 0===t&&(t=[]), "function"==typeof r){ return t.push(r), t; }for(var n=0,o=r.length;n<o;n++){ Array.isArray(r[n])&&e(r[n],t), Array.isArray(r[n])||t.push(r[n]); }return t},r=function(t,n,o){var i,a;if("string"==typeof o[0]&&(i=o.shift()), "function"==typeof o[0]&&void 0!==o[0].paths&&void 0!==o[0].regexpList){ for(var s=o.shift(),d=0,u=s.paths.length;d<u;d++){var p=s.paths[d].middlewares,c=s.paths[d].method,f=s.paths[d].path;void 0!==i&&(f=i+(f||"*")), void 0!==f&&p.unshift(f), t=r(t,c,p);} }if((a=e(o)).length>0){if(void 0!==i&&void 0===t.regexpList[i]){var l=(i=i.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var h in l){ l[h]=l[h].replace(":",""); }var m=i.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");t.regexpList[i]={regexp:RegExp("^"+m+"/?(\\?.*)?$","gi"),params:l};}t.paths.push({method:n,path:i,middlewares:a});}return t},t=function(){
    var arguments$1 = arguments;
    for(var e=[],r=arguments.length;r--;){ e[r]=arguments$1[r]; }var n,o,i,a={name:"div",props:{},children:[]};if("string"==typeof e[0]&&e[0].trim().length>0&&(a.name=e.shift()), "textNode"===a.name){ return a.value=e.join(" ").trim(), a; }if(t.isVnode(e[0])||"object"!=typeof e[0]||Array.isArray(e[0])||null===e[0]||(a.props=e.shift()), /(\.|\[|#)/gi.test(a.name)&&(i=a.name.match(/([\.|\#]\w+|\[[^\]]+\])/gi), a.name=a.name.replace(/([\.|\#]\w+|\[[^\]]+\])/gi,""), i)){ for(n=i.length;n--;){ "#"!==i[n].charAt(0)?"."!==i[n].charAt(0)?"["===i[n].charAt(0)&&(i[n]=i[n].trim().slice(1,-1).split("="), a.props[i[n][0]]=i[n][1]):a.props.class=((a.props.class||"")+" "+i[n].slice(1)).trim():a.props.id=i[n].slice(1); } }var s=t.flatenArray(e);for(o=0, n=s.length;o<n;o++){ a.children.push(t.isVnode(s[o])?s[o]:t("textNode",s[o])); }return a};t.flatenArray=function(e,r){if(void 0===r&&(r=[]), !Array.isArray(e)){ return r.push(e), r; }for(var n=0,o=e.length;n<o;n++){ Array.isArray(e[n])&&t.flatenArray(e[n],r), Array.isArray(e[n])||r.push(e[n]); }return r}, t.isVnode=function(e){return e&&e.name&&e.props&&e.children}, t.vnode=function(e){if(e){ return 3===e.nodeType?{value:e.nodeValue,name:"textNode",props:{},children:[],dom:e}:{name:e.nodeName.toLowerCase(),props:{},children:Array.prototype.map.call(e.childNodes,function(e){return t.vnode(e)}),dom:e} }};var n=function(e,r){void 0===e&&(e=""), void 0===r&&(r={});var t,o=e.replace(/\/$/gi,"").trim(),i=Object.assign({},r),a="undefined"==typeof window,s=a?require("node-fetch"):fetch.bind(window);function d(e,r,n,o){void 0===o&&(o={});var i=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},d.options,o),a=i.headers.Accept;return void 0!==n&&("get"===i.method&&"object"==typeof n&&(r+=n=function e(r,t){var n=encodeURIComponent;return"?"+Object.keys(r).map(function(o){return void 0!==t&&(o=t+"["+o+"]"), "object"==typeof r[o]?e(r[o],o):n(o)+"="+n(r[o])}).join("&")}(n)), "get"!==i.method&&(i.body=JSON.stringify(n))), s(t(r),i).then(function(e){if(e.status<200||e.status>300){var r=Error(e.statusText);throw r.response=e, r}return/text/gi.test(a)?e.text():/json/gi.test(a)?e.json():e})}return t=function(e){var r=(d.baseUrl+"/"+e).trim().replace(/^\/\//gi,"/").trim();return a&&"string"==typeof d.nodeUrl&&(d.nodeUrl=d.nodeUrl.replace(/\/$/gi,"").trim(), /^http/gi.test(r)&&"string"==typeof d.apiUrl&&(d.apiUrl=d.apiUrl.replace(/\/$/gi,"").trim(), r=r.replace(d.apiUrl,d.nodeUrl)), /^http/gi.test(r)||(r=d.nodeUrl+r)), r}, d.new=function(e,r){var t=d.baseUrl+"/"+e,o=Object.assign({},d.options,r);return n(t,o)}, d.apiUrl=void 0, d.nodeUrl=void 0, d.options=i, d.baseUrl=o, ["get","post","put","patch","delete"].forEach(function(e){return d[e]=function(r,t,n){return d(e,r,t,n)}}), d},o=n();function i(e){return"object"==typeof e&&null!==e&&"function"==typeof e.view}function a(e,r){void 0===r&&(r={}), e.attributes=r.name&&r.props&&Array.isArray(r.children)?{children:r}:Array.isArray(r)?{children:1===r.length?r[0]:r}:Object.assign({},e.attributes,r);}function s(e,r){void 0===r&&(r={}), a(e,r);var t=e.view();return Array.isArray(t)?t:[t]}function d(){
    var arguments$1 = arguments;
    for(var e=[],r=arguments.length;r--;){ e[r]=arguments$1[r]; }return i(e[0])?s.apply(d,e):t.apply(t,e)}function u(e,r,t,n){d.is.browser&&r.split(" ").forEach(function(r){e.addEventListener(r,t,n);});}d.ready=function(e){u(document,/https?:\/\//.test(window.document.URL)?"DOMContentLoaded":"deviceready",e,!1);}, d.request=o, d.router=function(){var t=async function(r){void 0===r&&(r="/");var n,o={},i=[],a=0,s=t.paths.length;for(t.url=r;a<s;a++){var d=t.paths[a];if("get"===d.method||"use"===d.method){ if("use"!==d.method&&"get"!==d.method||void 0!==d.path){var u=t.regexpList[d.path].regexp.exec(r);if(t.regexpList[d.path].regexp.lastIndex=-1, Array.isArray(u)){u.shift();for(var p=t.regexpList[d.path].params.length;p--;){ void 0===o[t.regexpList[d.path].params[p]]&&(o[t.regexpList[d.path].params[p]]=u[p]); }i=e(d.middlewares,i);}}else { i=e(d.middlewares,i); } }}if(t.params=o, i.length>0){ for(var c=0,f=i.length;c<f;c++){ if(void 0!==(n=await i[c](o))){ return n; } } }if(t.throwNotFound){ throw Error("The url "+r+" requested wasn't found") }};return t.url="/", t.params={}, t.throwNotFound=!0, t.paths=[], t.regexpList={}, ["get","use"].map(function(e){t[e]=function(){
    var arguments$1 = arguments;
    for(var n=[],o=arguments.length;o--;){ n[o]=arguments$1[o]; }return r(t,e,n)};}), t}, (d.is={}).node="undefined"==typeof window, d.is.browser=!d.is.node, d.is.mounted=!1, d.window=d.is.node?require("html-element"):window;var p,c,f,l,h,m,v=function(e){var r=e.window.document;function n(e,r,t){"className"!==r?"function"!=typeof t?("boolean"==typeof t&&(e[r]=t), void 0!==t&&!1!==t?e.setAttribute(r,t):e.removeAttribute(r)):e[r]=t.bind(e):e.setAttribute("class",t);}function o(e,r){void 0===r&&(r={});var t=e.props,o=r.props||{},i=Object.assign({},t,o);for(var a in i){ t[a]!==o[a]&&n(e.dom,a,t[a]); }}function i(e,r){return e.props&&e.props[r]&&e.props[r](e)}function a(e){var t;delete e.dom, i(e,"oninit"), t="textNode"===e.name?r.createTextNode(e.value):"svg"===e.name?r.createElementNS("http://www.w3.org/2000/svg",e.name):r.createElement(e.name), e.dom=t, o(e);for(var n=0;n<e.children.length;n++){ t.appendChild(a(e.children[n])); }return i(e,"oncreate"), t}function s(e,r){return void 0===r&&(r=!1), Promise.resolve(i(e,"onbeforeremove")).then(function(){!r&&e.dom&&e.dom.parentElement&&e.dom.parentElement.removeChild(e.dom);for(var t=0,n=e.children.length;t<n;t++){ s(e.children[t],r); }i(e,"onremove");})}return function e(r,n,d){if(void 0===d&&void 0!==n&&r.appendChild(a(n)), void 0===n&&s(d), t.isVnode(d)&&t.isVnode(n)){if(n.dom=d.dom, "textNode"===n.name&&d.value==n.value){ return r; }if("textNode"===n.name&&n.value!=d.value||n.name!==d.name){ return a(n), Promise.resolve(s(d,!0)).then(function(){r.replaceChild(n.dom,d.dom);}), r; }o(n,d);for(var u=Math.max(n.children.length,d.children.length),p=0;p<u;p++){ e(n.dom,n.children[p],d.children[p]); }i(n,"onupdate");}return r}}(d);function g(){d.is.mounted=!1, p=d.window.document.createElement("html"), d.window.document.createElement("div").appendChild(p), c=t.vnode(p), f=Object.assign({},c);}function w(e,r){return void 0===r&&(r={}), i(e)&&(a(e,r), l=e, c.props={}, Object.keys(l).forEach(function(e){"function"==typeof l[e]&&(c.props[e]=function(){
    var arguments$1 = arguments;
    for(var r=[],t=arguments.length;t--;){ r[t]=arguments$1[t]; }return l[e].apply(l,r)});})), l&&(d.is.node&&g(), c.children=s(l), v(c.dom.parentElement,c,f), f=Object.assign({},c), d.is.mounted||(d.is.mounted=!0)), d.is.node?require("he").decode(c.dom.parentElement.innerHTML):c.dom.parentElement}g(), d.mount=function(e,r,n){if(void 0===n&&(n={}), void 0===e){ throw Error("A container element is required as first element"); }if(!i(r)){ throw Error("A component is required as a second argument"); }return d.is.browser&&p&&function(e,r,t){d.is.browser&&r.split(" ").forEach(function(r){e.removeEventListener(r,t);});}(p,"mouseup keyup",d.update), p=d.is.node?d.window.document.createElement("div"):"string"==typeof e?d.window.document.querySelectorAll(e)[0]:e, c=t.vnode(p), f=Object.assign({},c), d.is.browser&&u(p,"mouseup keyup",d.update,!1), d.update(r,n)}, d.update=function(e,r){if(void 0===r&&(r={}), !d.is.browser){ return w(e,r); }requestAnimationFrame(function(){return w(e,r)});}, (d.routes=function(e,r){if(!e||!r){var t=[];return h.paths.forEach(function(e){"get"===e.method&&t.push(""===e.path?"/":e.path);}), t}if(h=r, m=e, d.is.browser){var n=document.location.pathname;u(window,"popstate",function(){return d.routes.go(n)},!1), d.ready(function(){return d.routes.go(n)});}}).current="/", d.routes.params={}, d.routes.go=async function(e,r){return d.is.browser&&window.history.pushState({},"",e), await async function(e,r){void 0===e&&(e="/"), void 0===r&&(r=void 0);var t=await h(e);if(!i(t)){var n=t;t={view:function(){return n}};}if(r){var o=t;t={view:function(){return d(r,d(o))}};}return d.is.node||!d.is.mounted?d.mount(m,t,{params:h.params}):d.update(t,{params:h.params})}(e,r)}, d.is.browser&&((d.sw=function(e,r){return void 0===e&&(e=d.sw.file), void 0===r&&(r=d.sw.options), navigator.serviceWorker.register(e,r).then(function(){return navigator.serviceWorker.ready}).then(function(t){return d.sw.ready=!0, d.sw.file=e, d.sw.options=r, new Promise(function(e,r){setTimeout(function(){e(navigator.serviceWorker);},10);})}).catch(function(e){return console.error("ServiceWorker registration failed: ",e)})}).ready=!1, d.sw.file="/sw.js", d.sw.options={scope:"/"}), d.is.node&&"undefined"!=typeof VNodeFactory&&VNodeFactory(d), (d.is.node?global:window).v=d;}();

    var links = {
        view: function view() {
            return [
                v("link", {"rel": "apple-touch-icon", "sizes": "114x114", "href": "/icons/apple-touch-icon-114x114.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "120x120", "href": "/icons/apple-touch-icon-120x120.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "144x144", "href": "/icons/apple-touch-icon-144x144.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "152x152", "href": "/icons/apple-touch-icon-152x152.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "180x180", "href": "/icons/apple-touch-icon-180x180.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "57x57", "href": "/icons/apple-touch-icon-57x57.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "60x60", "href": "/icons/apple-touch-icon-60x60.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "72x72", "href": "/icons/apple-touch-icon-72x72.png"}),
                v("link", {"rel": "apple-touch-icon", "sizes": "76x76", "href": "/icons/apple-touch-icon-76x76.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)", "href": "/icons/apple-touch-startup-image-320x460.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)", "href": "/icons/apple-touch-startup-image-640x920.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)", "href": "/icons/apple-touch-startup-image-640x1096.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)", "href": "/icons/apple-touch-startup-image-750x1294.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)", "href": "/icons/apple-touch-startup-image-1182x2208.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)", "href": "/icons/apple-touch-startup-image-1242x2148.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)", "href": "/icons/apple-touch-startup-image-748x1024.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)", "href": "/icons/apple-touch-startup-image-1496x2048.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)", "href": "/icons/apple-touch-startup-image-768x1004.png"}),
                v("link", {"rel": "apple-touch-startup-image", "media": "(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)", "href": "/icons/apple-touch-startup-image-1536x2008.png"}),
                v("link", {"rel": "icon", "type": "image/png", "sizes": "16x16", "href": "/icons/favicon-16x16.png"}),
                v("link", {"rel": "icon", "type": "image/png", "sizes": "32x32", "href": "/icons/favicon-32x32.png"}),
                v("link", {"rel": "manifest", "href": "/icons/manifest.json"}),
                v("link", {"rel": "shortcut icon", "href": "/icons/favicon.ico"}),
                v("meta", {"name": "apple-mobile-web-app-capable", "content": "yes"}),
                v("meta", {"name": "apple-mobile-web-app-status-bar-style", "content": "black-translucent"}),
                v("meta", {"name": "apple-mobile-web-app-title", "content": "Valyrian.js"}),
                v("meta", {"name": "application-name", "content": "Valyrian.js"}),
                v("meta", {"name": "mobile-web-app-capable", "content": "yes"}),
                v("meta", {"name": "msapplication-TileColor", "content": "#fff"}),
                v("meta", {"name": "msapplication-TileImage", "content": "/icons/mstile-144x144.png"}),
                v("meta", {"name": "msapplication-config", "content": "/icons/browserconfig.xml"}),
                v("meta", {"name": "theme-color", "content": "#fff"})
            ];
        }
    };

    var Main = {
        title: '',
        version: '',
        css: '',
        js: '',
        view: function view() {
            return [
                v('head', [
                    v('title', Main.title),
                    v('style', Main.css),
                    v(links)
                ]),
                v('body', [
                    Main.attributes.children,
                    v('script', Main.js)
                ])
            ];
        }
    };

    var Hello = {
        data: {
            hello: '',
            name: ''
        },
        oninit: function oninit() {
            return Hello.getServer();
        },
        getServer: function () {
            return v.request.get('/api/hola').then(function (data) {
                Hello.data = data;
            });
        },
        view: function view() {
            return v('div#mundo.hola', ((Hello.data.hello) + " " + (Hello.data.name)));
        }
    };

    var Counter = {
        count: 0,
        down: function (value) {
            Counter.count -= value;
        },
        up: function (value) {
            Counter.count += value;
        },
        view: function () {
            return v("div", [
                v("h1", Counter.count),
                v("button", { onclick: function () { return Counter.down(1); } }, "-"),
                v("button", { onclick: function () { return Counter.up(1); } }, "+"),
                v("button", { onclick: function () { return v.routes.go('/hello'); } }, "Go to hello"),
                v([
                    Counter.count === 2 ? v(2) : '',
                    v('br'),
                    v('', 'boolean true'),
                    v(true),
                    v('br'),
                    v('', 'boolean false'),
                    v(false),
                    v('br'),
                    v('', 'empty object'),
                    v({}, {}),
                    v('br'),
                    v('', 'null'),
                    v(null),
                    v('br'),
                    v('', 'undefined'),
                    v(undefined),
                    v('br'),
                    v('ul', (function () {
                        var elem = [];
                        if (Counter.count >= 0) {
                            for (var l = Counter.count; l--;) {
                                elem.push(v('li', l));
                            }
                        }

                        return elem;
                    }())),
                    v('img.div[src=http://placeimg.com/640/480/any]#ok')
                ])
            ]);
        }
    };

    var Diff = {
        s: 1,
        up: function () { return Diff.s += 1; },
        down: function () { return Diff.s -= 1; },
        view: function view() {
            return v('div', [
                Diff.s > 0 ? v('h1', Diff.s) : v('small', ''),
                v('button', { onclick: Diff.up }, '+'),
                v('button', { onclick: Diff.down }, '-')
            ]);
        }
    };

    var Lifecycle = {
        s: 1,
        up: function () {
            Lifecycle.s += 1;
            console.log(Lifecycle.s);
        },
        down: function () { return Lifecycle.s += -1; },
        oninit: function oninit(vnode) { // Before dom element is created
            console.log('component oninit', vnode);
        },
        oncreate: function oncreate(vnode) { // After dom element is created and attached to the document
            console.log('component oncreate', vnode);
        },
        onupdate: function onupdate(vnode) { // after dom element is updated
            console.log('component onupdate', vnode);
        },
        onbeforeremove: function onbeforeremove(vnode) { // before dom element is detached from the document
            console.log('component onbeforeremove', vnode);
        },
        onremove: function onremove(vnode) { // after dom element is removed
            console.log('component onremove', vnode);
        },
        view: function view() {
            return v('div', [
                Lifecycle.s > 0 ? v('h1', {
                    oninit: function oninit(vnode) { // Before dom element is created
                        console.log('oninit', vnode);
                    },
                    oncreate: function oncreate(vnode) { // After dom element is created and attached to the document
                        console.log('oncreate', vnode);
                    },
                    onupdate: function onupdate(vnode) { // after dom element is updated
                        console.log('onupdate', vnode);
                    },
                    onbeforeremove: function onbeforeremove(vnode) { // before dom element is detached from the document
                        console.log('onbeforeremove', vnode);
                    },
                    onremove: function onremove(vnode) { // after dom element is removed
                        console.log('onremove', vnode);
                    }
                }, Lifecycle.s) : v('small', ''),
                v('button', {onclick: Lifecycle.up}, '+'),
                v('button', {onclick: Lifecycle.down}, '-'),
                v('ul', (function () {
                    var elem = [];
                    if (Lifecycle.s >= 0) {
                        for (var l = Lifecycle.s; l--;) {
                            if (l !== 4) {
                                elem.push(v('li', {
                                    onbeforeremove: function onbeforeremove(vnode) {
                                        console.log('onbeforeremovelistart');
                                        var p = new Promise(function (resolve) {
                                            setTimeout(function () {
                                                console.log('onbeforeremoveliend');
                                                resolve();
                                            }, 2000);
                                        });
                                        return p;
                                    }
                                }, v('span', {
                                    onbeforeremove: function onbeforeremove(vnode) {
                                        console.log('onbeforeremovespanstart');
                                        var p = new Promise(function (resolve) {
                                            setTimeout(function () {
                                                console.log('onbeforeremovespanend');
                                                resolve();
                                            }, 1000);
                                        });
                                        return p;
                                    },
                                    onremove: function onremove(vnode) {
                                        console.log('onspanremove', vnode);
                                    }
                                }, l)));
                            }
                        }
                    }

                    return elem;
                }()))
            ]);
        }
    };

    var SubcomponentFactory = function () {
        var Subcomponent = {
            hidden: true,
            view: function view(vnode) {
                var this$1 = this;

                return [
                    v('button', {
                        onclick: function () {
                            this$1.hidden = !this$1.hidden;
                            v.update();
                        }
                    }, this.hidden ? 'Unhide' : 'Hide'),
                    v('div', this.hidden ? 'Hidden' : 'Unhidden')
                ];
            }
        };
        return Subcomponent;
    };

    var Component = {
        oninit: function oninit(vnode) {
            Component.sub1 = SubcomponentFactory();
            Component.sub2 = SubcomponentFactory();
            Component.sub3 = SubcomponentFactory();
        },
        view: function view() {
            return [
                v(Component.sub1, { hidden: false }),
                v(Component.sub2, { hidden: true }),
                v(Component.sub3)
            ];
        }
    };

    var Components = {
        Main: Main,
        Hello: Hello,
        Counter: Counter,
        Diff: Diff,
        Lifecycle: Lifecycle,
        Subcomponent: Component
    };

    // Create a router
    var router = v.router();
    router
        .use(function () { return console.log('ok'); })
        .get('/', [
            function () { return console.log('Init'); },
            function () { return Components.Hello; }
        ])
        .get('/hello', [
            function () { return Components.Hello.getServer(); },
            function () { return Components.Hello; }
        ])
        .get('/counter', function () { return Components.Counter; })
        .get('/diff', function () { return Components.Diff; })
        .get('/lifecycle', function () { return Components.Lifecycle; })
        .get('/subcomponent', function () { return Components.Subcomponent; })
        .get('/hello/:ok', function (params) {
            return Components.Hello;
        })
    ;

    // Assign routes to ValyrianJs
    v.routes('body', router);

    if (v.isBrowser) {
        v.sw('./sw.js')
            .then(function () {
                console.log('SW registered');
            });
    }

    // Export what is needed for the backend
    var index = {Components: Components};

    return index;

})));
//# sourceMappingURL=index.min.js.map
