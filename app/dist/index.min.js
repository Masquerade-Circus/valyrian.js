(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global.App = factory());
}(this, (function () { 'use strict';

    !function(){var e=function(t,r){if(void 0===r&&(r=[]), "function"==typeof t){ return r.push(t), r; }for(var n=0,o=t.length;n<o;n++){ Array.isArray(t[n])&&e(t[n],r), Array.isArray(t[n])||r.push(t[n]); }return r},t=function(r,n,o){var i,a;if("string"==typeof o[0]&&(i=o.shift()), "function"==typeof o[0]&&void 0!==o[0].paths&&void 0!==o[0].regexpList){ for(var s=o.shift(),d=0,u=s.paths.length;d<u;d++){var p=s.paths[d].middlewares,c=s.paths[d].method,f=s.paths[d].path;void 0!==i&&(f=i+(f||"*")), void 0!==f&&p.unshift(f), r=t(r,c,p);} }if((a=e(o)).length>0){if(void 0!==i&&void 0===r.regexpList[i]){var l=(i=i.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var m in l){ l[m]=l[m].replace(":",""); }var h=i.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");r.regexpList[i]={regexp:RegExp("^"+h+"/?(\\?.*)?$","gi"),params:l};}r.paths.push({method:n,path:i,middlewares:a});}return r},r=function(){var r=async function(t){void 0===t&&(t="/");var n,o={},i=[],a=0,s=r.paths.length;for(r.url=t;a<s;a++){var d=r.paths[a];if("get"===d.method||"use"===d.method){ if("use"!==d.method&&"get"!==d.method||void 0!==d.path){var u=r.regexpList[d.path].regexp.exec(t);if(r.regexpList[d.path].regexp.lastIndex=-1, Array.isArray(u)){u.shift();for(var p=r.regexpList[d.path].params.length;p--;){ void 0===o[r.regexpList[d.path].params[p]]&&(o[r.regexpList[d.path].params[p]]=u[p]); }i=e(d.middlewares,i);}}else { i=e(d.middlewares,i); } }}if(r.params=o, i.length>0){ for(var c=0,f=i.length;c<f;c++){ if(void 0!==(n=await i[c](o))){ return n; } } }if(r.throwNotFound){ throw Error("The url "+t+" requested wasn't found") }};return r.url="/", r.params={}, r.throwNotFound=!0, r.paths=[], r.regexpList={}, ["get","use"].map(function(e){r[e]=function(){
    var arguments$1 = arguments;
    for(var n=[],o=arguments.length;o--;){ n[o]=arguments$1[o]; }return t(r,e,n)};}), r},n=function(){
    var arguments$1 = arguments;
    for(var e=[],t=arguments.length;t--;){ e[t]=arguments$1[t]; }var r,o,i,a={name:"div",props:{},children:[]};if("string"==typeof e[0]&&e[0].trim().length>0&&(a.name=e.shift()), "textNode"===a.name){ return a.value=e.join(" ").trim(), a; }if(n.isVnode(e[0])||"object"!=typeof e[0]||Array.isArray(e[0])||null===e[0]||(a.props=e.shift()), /(\.|\[|#)/gi.test(a.name)&&(i=a.name.match(/([\.|\#]\w+|\[[^\]]+\])/gi), a.name=a.name.replace(/([\.|\#]\w+|\[[^\]]+\])/gi,""), i)){ for(r=i.length;r--;){ "#"!==i[r].charAt(0)?"."!==i[r].charAt(0)?"["===i[r].charAt(0)&&(i[r]=i[r].trim().slice(1,-1).split("="), a.props[i[r][0]]=i[r][1]):a.props.class=((a.props.class||"")+" "+i[r].slice(1)).trim():a.props.id=i[r].slice(1); } }for(o=0, r=e.length;o<r;o++){ if(Array.isArray(e[o])){ for(var s=0,d=e[o].length;s<d;s++){ a.children.push(n.isVnode(e[o][s])?e[o][s]:n("textNode",e[o][s])); } }else { a.children.push(n.isVnode(e[o])?e[o]:n("textNode",e[o])); } }return a};n.isVnode=function(e){return e&&e.name&&e.props&&e.children}, n.vnode=function(e){if(e){ return 3===e.nodeType?{value:e.nodeValue,name:"textNode",props:{},children:[],dom:e}:{name:e.nodeName.toLowerCase(),props:{},children:Array.prototype.map.call(e.childNodes,function(e){return n.vnode(e)}),dom:e} }};var o=function(e,t){void 0===e&&(e=""), void 0===t&&(t={});var r=e.replace(/\/$/gi,"").trim(),n=Object.assign({},t),i=function(e,t){var r=i.baseUrl+"/"+e,n=Object.assign({},i.options,t);return o(r,n)};i.apiUrl=void 0, i.nodeUrl=void 0, i.isNode="undefined"==typeof window, i.options=n, i.baseUrl=r;var a=i.isNode?require("node-fetch"):fetch.bind(window);function s(e,t,r,n){void 0===n&&(n={});var o=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},i.options,n),s=o.headers.Accept;return void 0!==r&&("get"===o.method&&"object"==typeof r&&(t+=r=function e(t,r){var n=encodeURIComponent;return"?"+Object.keys(t).map(function(o){return void 0!==r&&(o=r+"["+o+"]"), "object"==typeof t[o]?e(t[o],o):n(o)+"="+n(t[o])}).join("&")}(r)), "get"!==o.method&&(o.body=JSON.stringify(r))), a(function(e){var t=(i.baseUrl+"/"+e).trim().replace(/^\/\//gi,"/").trim();return i.isNode&&"string"==typeof i.nodeUrl&&(i.nodeUrl=i.nodeUrl.replace(/\/$/gi,"").trim(), /^http/gi.test(t)&&"string"==typeof i.apiUrl&&(i.apiUrl=i.apiUrl.replace(/\/$/gi,"").trim(), t=t.replace(i.apiUrl,i.nodeUrl)), /^http/gi.test(t)||(t=i.nodeUrl+t)), t}(t),o).then(function(e){if(e.status<200||e.status>300){var t=Error(e.statusText);throw t.response=e, t}return/text/gi.test(s)?e.text():/json/gi.test(s)?e.json():e})}return["get","post","put","patch","delete","options","head"].forEach(function(e){return i[e]=function(t,r,n){return s(e,t,r,n)}}), i},i=o(),a=function(){var e=function(){
    var arguments$1 = arguments;
    for(var t=[],r=arguments.length;r--;){ t[r]=arguments$1[r]; }return e.isComponent(t[0])?e.render.apply(e,t):n.apply(n,t)};e.domReady=function(e){d(document,/https?:\/\//.test(window.document.URL)?"DOMContentLoaded":"deviceready",e,!1);}, e.request=i, Object.keys(i).forEach(function(t){"function"==typeof i[t]&&(e[t]=function(){
    var arguments$1 = arguments;
    for(var r=[],n=arguments.length;n--;){ r[n]=arguments$1[n]; }return i[t].apply(i,r).then(function(t){return e.update(), t})});}), e.router=r, e.isVnode=n.isVnode, e.vnode=n.vnode, e.isDomElement=n.isDomElement, e.isNode="undefined"==typeof window, e.window=e.isNode?require("html-element"):window, e.document=e.window.document;var t=function(e){var t=e.document;function r(e,t,r){"className"!==t?"function"!=typeof r?("boolean"==typeof r&&(e[t]=r), void 0!==r&&!1!==r?e.setAttribute(t,r):e.removeAttribute(t)):e[t]=r.bind(e):e.setAttribute("class",r);}function n(e,t){void 0===t&&(t={});var n=e.props,o=t.props||{},i=Object.assign({},n,o);for(var a in i){ n[a]!==o[a]&&r(e.dom,a,n[a]); }}async function o(t,r){
    var arguments$1 = arguments;
    for(var n=[],o=arguments.length-2;o-- >0;){ n[o]=arguments$1[o+2]; }if(e.isVnode(t)){var i=t.props[r];if(i&&i.call){ return n.unshift(t), await i.apply(t,n) }}}function i(e){var r;delete e.dom, o(e,"oninit"), r="textNode"===e.name?t.createTextNode(e.value):"svg"===e.name?t.createElementNS("http://www.w3.org/2000/svg",e.name):t.createElement(e.name), e.dom=r, n(e);for(var a=0;a<e.children.length;a++){ r.appendChild(i(e.children[a])); }return o(e,"oncreate"), r}function a(e,t){return void 0===t&&(t=!1), Promise.resolve(o(e,"onbeforeremove")).then(function(){!t&&e.dom&&e.dom.parentElement&&e.dom.parentElement.removeChild(e.dom);for(var r=0,n=e.children.length;r<n;r++){ a(e.children[r],t); }o(e,"onremove");})}return function t(r,s,d){if(void 0===d&&void 0!==s){ return r.appendChild(i(s)), r; }if(void 0===s){ return a(d), r; }if(e.isVnode(d)&&e.isVnode(s)){if(s.dom=d.dom, "textNode"===s.name&&d.value==s.value){ return r; }if("textNode"===s.name&&s.value!=d.value||s.name!==d.name){ return i(s), Promise.resolve(a(d,!0)).then(function(){r.replaceChild(s.dom,d.dom);}), r; }n(s,d);for(var u=Math.max(s.children.length,d.children.length),p=0;p<u;p++){ t(s.dom,s.children[p],d.children[p]); }return o(s,"onupdate"), r}return r}}(e);function o(){e.isMounted=!1, e.container=e.document.createElement("html"), e.parent=e.document.createElement("div"), e.parent.appendChild(e.container), e.rootTree=e.vnode(e.container), e.oldTree=Object.assign({},e.rootTree);}function s(e,t){void 0===t&&(t={}), e.attributes=t.name&&t.props&&Array.isArray(t.children)?{children:t}:Array.isArray(t)?{children:1===t.length?t[0]:t}:Object.assign({},e.attributes,t);}function d(t,r,n,o){e.isNode||r.split(" ").forEach(function(e){t.addEventListener(e,n,o);});}function u(r,n){return void 0===n&&(n={}), e.isComponent(r)&&(s(r,n), e.rootComponent=r, e.rootTree.props={}, Object.keys(e.rootComponent).forEach(function(t){"function"==typeof e.rootComponent[t]&&(e.rootTree.props[t]=function(){
    var arguments$1 = arguments;
    for(var r=[],n=arguments.length;n--;){ r[n]=arguments$1[n]; }return e.rootComponent[t].apply(e.rootComponent,r)});})), e.rootComponent&&(e.isNode&&o(), e.rootTree.children=e.render(e.rootComponent), t(e.rootTree.dom.parentElement,e.rootTree,e.oldTree), e.oldTree=Object.assign({},e.rootTree), e.isMounted||(e.isMounted=!0)), e.isNode?e.rootTree.dom.parentElement.innerHTML:e.rootTree.dom.parentElement}return o(), e.rootComponent=void 0, e.render=function(t,r){if(void 0===r&&(r={}), !e.isComponent(t)){ throw Error("A component is required"); }return s(t,r), function e(t,r){if(void 0===r&&(r=[]), !Array.isArray(t)){ return r.push(t), r; }for(var n=0,o=t.length;n<o;n++){ Array.isArray(t[n])&&e(t[n],r), Array.isArray(t[n])||r.push(t[n]); }return r}(t.view())}, e.mount=function(t,r,n){if(void 0===n&&(n={}), void 0===t){ throw Error("A container element is required as first element"); }if(!e.isComponent(r)){ throw Error("A component is required as a second argument"); }return!e.isNode&&e.container&&function(t,r,n){e.isNode||r.split(" ").forEach(function(e){t.removeEventListener(e,n);});}(e.container,"mouseup keyup",e.update), e.container=e.isNode?e.document.createElement("div"):"string"==typeof t?e.document.querySelectorAll(t)[0]:t, e.rootTree=e.vnode(e.container), e.oldTree=Object.assign({},e.rootTree), e.isNode||d(e.container,"mouseup keyup",e.update,!1), e.update(r,n)}, e.update=function(t,r){if(void 0===r&&(r={}), e.isNode){ return u(t,r); }requestAnimationFrame(function(){return u(t,r)});}, e.isComponent=function(e){return"object"==typeof e&&null!==e&&"function"==typeof e.view}, e.routes=function(t,r){if(t&&r){ return e.routes.router=r, e.routes.container=t, void e.routes.init(); }var n=[];return e.routes.router.paths.forEach(function(e){"get"===e.method&&n.push(""===e.path?"/":e.path);}), n}, e.routes.run=async function(t,r){void 0===t&&(t="/"), void 0===r&&(r=void 0);var n=await e.routes.router(t);if(!e.isComponent(n)){var o=n;n={view:function(){return o}};}if(r){var i=n;n={view:function(){return e(r,e(i))}};}return e.isNode||!e.isMounted?e.mount(e.routes.container,n,{params:e.routes.router.params}):e.update(n,{params:e.routes.router.params})}, e.routes.go=function(t,r){return e.isNode||window.history.pushState({},"",t), e.routes.run(t,r)}, e.routes.init=function(){e.isNode||(d(window,"popstate",function(t){e.routes.run(document.location.pathname);},!1), e.domReady(function(){e.routes.run(document.location.pathname);}));}, e.new=a, e};("undefined"==typeof window?global:window).v=a();}();
    //# sourceMappingURL=valyrian.min.js.map

    var Main = {
        title: '',
        version: '',
        css: '',
        script: '',
        view: function view() {
            return [
                v('head', [
                    v('title', Main.title),
                    v('style', Main.css)
                ]),
                v('body', [
                    Main.attributes.children,
                    // v('script', { src: 'valyrian.min.js' }),
                    v('script', { src: 'index.min.js?v='+Main.version }) ])
            ];
        }
    };

    var Hello = {
        data: {
            hello: '',
            name: ''
        },
        oninit: function oninit(){
            return Hello.getServer();
        },
        getServer: function () {
            return v.get('/api/hola').then(function (data) {
                Hello.data = data;
            });
        },
        view: function view() {
            return v('div#mundo.hola', ((Hello.data.hello) + " " + (Hello.data.name)));
        }
    };

    var Counter = {
        count: 0,
        down: function (value) {
            Counter.count -= value;
        },
        up: function (value) {
            Counter.count += value;
        },
        view: function () {
            return v("div", [
                v("h1", Counter.count),
                v("button", { onclick: function () { return Counter.down(1); } }, "-"),
                v("button", { onclick: function () { return Counter.up(1); } }, "+"),
                v("button", { onclick: function () { return v.routes.go('/hello'); } }, "Go to hello"),
                v([
                    Counter.count === 2 ? v(2) : '',
                    v('br'),
                    v('','boolean true'),
                    v(true),
                    v('br'),
                    v('','boolean false'),
                    v(false),
                    v('br'),
                    v('','empty object'),
                    v({}, {}),
                    v('br'),
                    v('','null'),
                    v(null),
                    v('br'),
                    v('','undefined'),
                    v(undefined),
                    v('br'),
                    v('ul', (function () {
                        var elem = [];
                        if (Counter.count >= 0) {
                            for (var l = Counter.count; l--;) {
                                elem.push(v('li', l));
                            }
                        }

                        return elem;
                    })()),
                    v('img.div[src=http://placeimg.com/640/480/any]#ok')
                ])
            ]);
        }
    };

    var Diff = {
        s: 1,
        up: function () { return Diff.s += 1; },
        down: function () { return Diff.s -= 1; },
        view: function view() {
            return v('div', [
                Diff.s > 0 ? v('h1', Diff.s) : v('small', ''),
                v('button', { onclick: Diff.up }, '+'),
                v('button', { onclick: Diff.down }, '-') ]);
        }
    };

    var Lifecycle = {
        s: 1,
        up: function () { return Lifecycle.s+=1; },
        down: function () { return Lifecycle.s+=-1; },
        oninit: function oninit(vnode){ // Before dom element is created
            console.log('component oninit', vnode);
        },
        oncreate: function oncreate(vnode){ // After dom element is created and attached to the document
            console.log('component oncreate', vnode);
        },
        onupdate: function onupdate(vnode){ // after dom element is updated
            console.log('component onupdate', vnode);
        },
        onbeforeremove: function onbeforeremove(vnode){ // before dom element is detached from the document
            console.log('component onbeforeremove', vnode);
        },
        onremove: function onremove(vnode){ // after dom element is removed
            console.log('component onremove', vnode);
        },
        view: function view() {
            return v('div', [
                Lifecycle.s > 0 ? v('h1', {
                    oninit: function oninit(vnode){ // Before dom element is created
                        console.log('oninit', vnode);
                    },
                    oncreate: function oncreate(vnode){ // After dom element is created and attached to the document
                        console.log('oncreate', vnode);
                    },
                    onupdate: function onupdate(vnode){ // after dom element is updated
                        console.log('onupdate', vnode);
                    },
                    onbeforeremove: function onbeforeremove(vnode){ // before dom element is detached from the document
                        console.log('onbeforeremove', vnode);
                    },
                    onremove: function onremove(vnode){ // after dom element is removed
                        console.log('onremove', vnode);
                    }
                }, Lifecycle.s) : v('small', ''),
                v('button', {onclick: Lifecycle.up}, '+'),
                v('button', {onclick: Lifecycle.down}, '-'),
                v('ul', (function(){
                    var elem = [];
                    if (Lifecycle.s >= 0){
                        for (var l = Lifecycle.s; l--;){
                            if (l !== 4){
                                elem.push(v('li', {
                                    onbeforeremove: function onbeforeremove(vnode){
                                        console.log('onbeforeremovelistart');
                                        var p = new Promise(function (resolve) {
                                            setTimeout(function(){
                                                console.log('onbeforeremoveliend');
                                                resolve();
                                            }, 2000);
                                        });
                                        return p;
                                    }
                                }, v('span',{
                                    onbeforeremove: function onbeforeremove(vnode){
                                        console.log('onbeforeremovespanstart');
                                        var p = new Promise(function (resolve) {
                                            setTimeout(function(){
                                                console.log('onbeforeremovespanend');
                                                resolve();
                                            }, 1000);
                                        });
                                        return p;
                                    },
                                    onremove: function onremove(vnode){
                                        console.log('onspanremove', vnode);
                                    }
                                }, l)));
                            }
                        }
                    }

                    return elem;
                })())
            ]);
        }
    };

    var SubcomponentFactory = function(){
        var Subcomponent = {
            hidden: true,
            view: function view(vnode) {
                var this$1 = this;

                return [
                    v('button', {
                        onclick: function () {
                            this$1.hidden = !this$1.hidden;
                            v.update();
                        }
                    }, this.hidden ? 'Unhide' : 'Hide'),
                    v('div', this.hidden ? 'Hidden' : 'Unhidden')
                ]
            }
        };
        return Subcomponent;
    };

    var Component = {
        oninit: function oninit(vnode){
            Component.sub1 = SubcomponentFactory();
            Component.sub2 = SubcomponentFactory();
            Component.sub3 = SubcomponentFactory();
        },
        view: function view() {
            return [
                v(Component.sub1, { hidden: false }),
                v(Component.sub2, { hidden: true }),
                v(Component.sub3)
            ];
        }
    };

    var Components = {
        Main: Main,
        Hello: Hello,
        Counter: Counter,
        Diff: Diff,
        Lifecycle: Lifecycle,
        Subcomponent: Component
    };

    // Create a router
    var router = v.router();
    router
        .use(function () { return console.log('ok'); })
        .get('/', [
            function () { return console.log('Init'); },
            function () { return Components.Hello; }
        ])
        .get('/hello', [
            function () { return Components.Hello.getServer(); },
            function () { return Components.Hello; }
        ])
        .get('/counter', function () { return Components.Counter; })
        .get('/diff', function () { return Components.Diff; })
        .get('/lifecycle', function () { return Components.Lifecycle; })
        .get('/subcomponent', function () { return Components.Subcomponent; })
        ;

    // Assign routes to ValyrianJs
    v.routes('body', router);

    // Export what is needed for the backend
    var index = {Components: Components};

    return index;

})));
//# sourceMappingURL=index.min.js.map
