!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.App=n()}(this,function(){"use strict";!function(){var e=function(n,t){if(void 0===t&&(t=[]),"function"==typeof n)return t.push(n),t;for(var o=0,r=n.length;o<r;o++)Array.isArray(n[o])&&e(n[o],t),Array.isArray(n[o])||t.push(n[o]);return t},n=function(t,o,r){var i,a;if("string"==typeof r[0]&&(i=r.shift()),"function"==typeof r[0]&&void 0!==r[0].paths&&void 0!==r[0].regexpList)for(var c=r.shift(),u=0,s=c.paths.length;u<s;u++){var p=c.paths[u].middlewares,l=c.paths[u].method,d=c.paths[u].path;void 0!==i&&(d=i+(d||"*")),void 0!==d&&p.unshift(d),t=n(t,l,p)}if((a=e(r)).length>0){if(void 0!==i&&void 0===t.regexpList[i]){var f=(i=i.replace(/\/(\?.*)?$/gi,"$1")).match(/:(\w+)?/gi)||[];for(var v in f)f[v]=f[v].replace(":","");var h=i.replace(/:(\w+)/gi,"([^\\s\\/|\\?]+)").replace(/\*/g,".*").replace(/\/(\?.*)?$/gi,"$1");t.regexpList[i]={regexp:RegExp("^"+h+"/?(\\?.*)?$","gi"),params:f}}t.paths.push({method:o,path:i,middlewares:a})}return t},t=function(){for(var e=arguments,n=[],o=arguments.length;o--;)n[o]=e[o];var r,i,a,c={name:"div",props:{},children:[]};if("string"==typeof n[0]&&n[0].trim().length>0&&(c.name=n.shift()),"textNode"===c.name)return c.value=n.join(" ").trim(),c;if(t.isVnode(n[0])||"object"!=typeof n[0]||Array.isArray(n[0])||null===n[0]||(c.props=n.shift()),/(\.|\[|#)/gi.test(c.name)&&(a=c.name.match(/([\.|\#]\w+|\[[^\]]+\])/gi),c.name=c.name.replace(/([\.|\#]\w+|\[[^\]]+\])/gi,""),a))for(r=a.length;r--;)"#"!==a[r].charAt(0)?"."!==a[r].charAt(0)?"["===a[r].charAt(0)&&(a[r]=a[r].trim().slice(1,-1).split("="),c.props[a[r][0]]=a[r][1]):c.props.class=((c.props.class||"")+" "+a[r].slice(1)).trim():c.props.id=a[r].slice(1);var u=t.flatenArray(n);for(i=0,r=u.length;i<r;i++)c.children.push(t.isVnode(u[i])?u[i]:t("textNode",u[i]));return c};t.flatenArray=function(e,n){if(void 0===n&&(n=[]),!Array.isArray(e))return n.push(e),n;for(var o=0,r=e.length;o<r;o++)Array.isArray(e[o])&&t.flatenArray(e[o],n),Array.isArray(e[o])||n.push(e[o]);return n},t.isVnode=function(e){return e&&e.name&&e.props&&e.children},t.vnode=function(e){if(e)return 3===e.nodeType?{value:e.nodeValue,name:"textNode",props:{},children:[],dom:e}:{name:e.nodeName.toLowerCase(),props:{},children:Array.prototype.map.call(e.childNodes,function(e){return t.vnode(e)}),dom:e}};var o=function(e,n){void 0===e&&(e=""),void 0===n&&(n={});var t=e.replace(/\/$/gi,"").trim(),r=Object.assign({},n),i=function(e,n){var t=i.baseUrl+"/"+e,r=Object.assign({},i.options,n);return o(t,r)};i.apiUrl=void 0,i.nodeUrl=void 0,i.isNode="undefined"==typeof window,i.options=r,i.baseUrl=t;var a=i.isNode?require("node-fetch"):fetch.bind(window);return["get","post","put","patch","delete"].forEach(function(e){return i[e]=function(n,t,o){return function(e,n,t,o){void 0===o&&(o={});var r=Object.assign({method:e.toLowerCase(),headers:{Accept:"application/json","Content-Type":"application/json"}},i.options,o),c=r.headers.Accept;return void 0!==t&&("get"===r.method&&"object"==typeof t&&(n+=t=function e(n,t){var o=encodeURIComponent;return"?"+Object.keys(n).map(function(r){return void 0!==t&&(r=t+"["+r+"]"),"object"==typeof n[r]?e(n[r],r):o(r)+"="+o(n[r])}).join("&")}(t)),"get"!==r.method&&(r.body=JSON.stringify(t))),a(function(e){var n=(i.baseUrl+"/"+e).trim().replace(/^\/\//gi,"/").trim();return i.isNode&&"string"==typeof i.nodeUrl&&(i.nodeUrl=i.nodeUrl.replace(/\/$/gi,"").trim(),/^http/gi.test(n)&&"string"==typeof i.apiUrl&&(i.apiUrl=i.apiUrl.replace(/\/$/gi,"").trim(),n=n.replace(i.apiUrl,i.nodeUrl)),/^http/gi.test(n)||(n=i.nodeUrl+n)),n}(n),r).then(function(e){if(e.status<200||e.status>300){var n=Error(e.statusText);throw n.response=e,n}return/text/gi.test(c)?e.text():/json/gi.test(c)?e.json():e})}(e,n,t,o)}}),i},r=o(),i=function(){for(var e=arguments,n=[],o=arguments.length;o--;)n[o]=e[o];return d(n[0])?s.apply(i,n):t.apply(t,n)};i.ready=function(e){p(document,/https?:\/\//.test(window.document.URL)?"DOMContentLoaded":"deviceready",e,!1)},i.request=r,Object.keys(r).forEach(function(e){"function"==typeof r[e]&&(i[e]=function(){for(var n=arguments,t=[],o=arguments.length;o--;)t[o]=n[o];return r[e].apply(r,t).then(function(e){return i.update(),e})})}),i.router=function(){var t=async function(n){void 0===n&&(n="/");var o,r={},i=[],a=0,c=t.paths.length;for(t.url=n;a<c;a++){var u=t.paths[a];if("get"===u.method||"use"===u.method)if("use"!==u.method&&"get"!==u.method||void 0!==u.path){var s=t.regexpList[u.path].regexp.exec(n);if(t.regexpList[u.path].regexp.lastIndex=-1,Array.isArray(s)){s.shift();for(var p=t.regexpList[u.path].params.length;p--;)void 0===r[t.regexpList[u.path].params[p]]&&(r[t.regexpList[u.path].params[p]]=s[p]);i=e(u.middlewares,i)}}else i=e(u.middlewares,i)}if(t.params=r,i.length>0)for(var l=0,d=i.length;l<d;l++)if(void 0!==(o=await i[l](r)))return o;if(t.throwNotFound)throw Error("The url "+n+" requested wasn't found")};return t.url="/",t.params={},t.throwNotFound=!0,t.paths=[],t.regexpList={},["get","use"].map(function(e){t[e]=function(){for(var o=arguments,r=[],i=arguments.length;i--;)r[i]=o[i];return n(t,e,r)}}),t},i.isNode="undefined"==typeof window,i.isBrowser=!i.isNode,i.window=i.isNode?require("html-element"):window,i.document=i.window.document;var a=function(e){var n=e.document;function o(e,n,t){"className"!==n?"function"!=typeof t?("boolean"==typeof t&&(e[n]=t),void 0!==t&&!1!==t?e.setAttribute(n,t):e.removeAttribute(n)):e[n]=t.bind(e):e.setAttribute("class",t)}function r(e,n){void 0===n&&(n={});var t=e.props,r=n.props||{},i=Object.assign({},t,r);for(var a in i)t[a]!==r[a]&&o(e.dom,a,t[a])}function i(e,n){return e.props&&e.props[n]&&e.props[n](e)}function a(e){var t;delete e.dom,i(e,"oninit"),t="textNode"===e.name?n.createTextNode(e.value):"svg"===e.name?n.createElementNS("http://www.w3.org/2000/svg",e.name):n.createElement(e.name),e.dom=t,r(e);for(var o=0;o<e.children.length;o++)t.appendChild(a(e.children[o]));return i(e,"oncreate"),t}function c(e,n){return void 0===n&&(n=!1),Promise.resolve(i(e,"onbeforeremove")).then(function(){!n&&e.dom&&e.dom.parentElement&&e.dom.parentElement.removeChild(e.dom);for(var t=0,o=e.children.length;t<o;t++)c(e.children[t],n);i(e,"onremove")})}return function e(n,o,u){if(void 0===u&&void 0!==o&&n.appendChild(a(o)),void 0===o&&c(u),t.isVnode(u)&&t.isVnode(o)){if(o.dom=u.dom,"textNode"===o.name&&u.value==o.value)return n;if("textNode"===o.name&&o.value!=u.value||o.name!==u.name)return a(o),Promise.resolve(c(u,!0)).then(function(){n.replaceChild(o.dom,u.dom)}),n;r(o,u);for(var s=Math.max(o.children.length,u.children.length),p=0;p<s;p++)e(o.dom,o.children[p],u.children[p]);i(o,"onupdate")}return n}}(i);function c(){i.isMounted=!1,i.container=i.document.createElement("html"),i.parent=i.document.createElement("div"),i.parent.appendChild(i.container),i.rootTree=t.vnode(i.container),i.oldTree=Object.assign({},i.rootTree)}function u(e,n){void 0===n&&(n={}),e.attributes=n.name&&n.props&&Array.isArray(n.children)?{children:n}:Array.isArray(n)?{children:1===n.length?n[0]:n}:Object.assign({},e.attributes,n)}function s(e,n){void 0===n&&(n={}),u(e,n);var t=e.view();return Array.isArray(t)?t:[t]}function p(e,n,t,o){i.isBrowser&&n.split(" ").forEach(function(n){e.addEventListener(n,t,o)})}function l(e,n){return void 0===n&&(n={}),d(e)&&(u(e,n),i.rootComponent=e,i.rootTree.props={},Object.keys(i.rootComponent).forEach(function(e){"function"==typeof i.rootComponent[e]&&(i.rootTree.props[e]=function(){for(var n=arguments,t=[],o=arguments.length;o--;)t[o]=n[o];return i.rootComponent[e].apply(i.rootComponent,t)})})),i.rootComponent&&(i.isNode&&c(),i.rootTree.children=s(i.rootComponent),a(i.rootTree.dom.parentElement,i.rootTree,i.oldTree),i.oldTree=Object.assign({},i.rootTree),i.isMounted||(i.isMounted=!0)),i.isNode?require("he").decode(i.rootTree.dom.parentElement.innerHTML):i.rootTree.dom.parentElement}function d(e){return"object"==typeof e&&null!==e&&"function"==typeof e.view}c(),i.rootComponent=void 0,i.mount=function(e,n,o){if(void 0===o&&(o={}),void 0===e)throw Error("A container element is required as first element");if(!d(n))throw Error("A component is required as a second argument");return i.isBrowser&&i.container&&function(e,n,t){i.isBrowser&&"mouseup keyup".split(" ").forEach(function(n){e.removeEventListener(n,t)})}(i.container,0,i.update),i.container=i.isNode?i.document.createElement("div"):"string"==typeof e?i.document.querySelectorAll(e)[0]:e,i.rootTree=t.vnode(i.container),i.oldTree=Object.assign({},i.rootTree),i.isBrowser&&p(i.container,"mouseup keyup",i.update,!1),i.update(n,o)},i.update=function(e,n){if(void 0===n&&(n={}),!i.isBrowser)return l(e,n);requestAnimationFrame(function(){return l(e,n)})},i.routes=function(e,n){if(e&&n)return i.routes.router=n,i.routes.container=e,void i.routes.init();var t=[];return i.routes.router.paths.forEach(function(e){"get"===e.method&&t.push(""===e.path?"/":e.path)}),t},i.routes.run=async function(e,n){void 0===e&&(e="/"),void 0===n&&(n=void 0);var t=await i.routes.router(e);if(!d(t)){var o=t;t={view:function(){return o}}}if(n){var r=t;t={view:function(){return i(n,i(r))}}}return i.isNode||!i.isMounted?i.mount(i.routes.container,t,{params:i.routes.router.params}):i.update(t,{params:i.routes.router.params})},i.routes.go=function(e,n){return i.isBrowser&&window.history.pushState({},"",e),i.routes.run(e,n)},i.routes.init=function(){i.isBrowser&&(p(window,"popstate",function(e){i.routes.run(document.location.pathname)},!1),i.ready(function(){i.routes.run(document.location.pathname)}))},i.isBrowser&&(i.sw={ready:!1,file:"/sw.js",options:{scope:"/"},register:function(e,n){return void 0===e&&(e=i.sw.file),void 0===n&&(n=i.sw.options),navigator.serviceWorker.register(e,n).then(function(){return navigator.serviceWorker.ready}).then(function(t){return i.sw.ready=!0,i.sw.file=e,i.sw.options=n,new Promise(function(e,n){setTimeout(function(){e()},10)})}).catch(function(e){return console.error("ServiceWorker registration failed: ",e)})}}),i.isNode&&"undefined"!=typeof VNodeFactory&&VNodeFactory(i),(i.isNode?global:window).v=i}();var e={view:function(){return[v("link",{rel:"apple-touch-icon",sizes:"114x114",href:"/icons/apple-touch-icon-114x114.png"}),v("link",{rel:"apple-touch-icon",sizes:"120x120",href:"/icons/apple-touch-icon-120x120.png"}),v("link",{rel:"apple-touch-icon",sizes:"144x144",href:"/icons/apple-touch-icon-144x144.png"}),v("link",{rel:"apple-touch-icon",sizes:"152x152",href:"/icons/apple-touch-icon-152x152.png"}),v("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/icons/apple-touch-icon-180x180.png"}),v("link",{rel:"apple-touch-icon",sizes:"57x57",href:"/icons/apple-touch-icon-57x57.png"}),v("link",{rel:"apple-touch-icon",sizes:"60x60",href:"/icons/apple-touch-icon-60x60.png"}),v("link",{rel:"apple-touch-icon",sizes:"72x72",href:"/icons/apple-touch-icon-72x72.png"}),v("link",{rel:"apple-touch-icon",sizes:"76x76",href:"/icons/apple-touch-icon-76x76.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-320x460.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x920.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-640x1096.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-750x1294.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1182x2208.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)",href:"/icons/apple-touch-startup-image-1242x2148.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-748x1024.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1496x2048.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)",href:"/icons/apple-touch-startup-image-768x1004.png"}),v("link",{rel:"apple-touch-startup-image",media:"(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)",href:"/icons/apple-touch-startup-image-1536x2008.png"}),v("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/icons/favicon-16x16.png"}),v("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/icons/favicon-32x32.png"}),v("link",{rel:"manifest",href:"/icons/manifest.json"}),v("link",{rel:"shortcut icon",href:"/icons/favicon.ico"}),v("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),v("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),v("meta",{name:"apple-mobile-web-app-title",content:"Valyrian.js"}),v("meta",{name:"application-name",content:"Valyrian.js"}),v("meta",{name:"mobile-web-app-capable",content:"yes"}),v("meta",{name:"msapplication-TileColor",content:"#fff"}),v("meta",{name:"msapplication-TileImage",content:"/icons/mstile-144x144.png"}),v("meta",{name:"msapplication-config",content:"/icons/browserconfig.xml"}),v("meta",{name:"theme-color",content:"#fff"})]}},n={title:"",version:"",css:"",js:"",view:function(){return[v("head",[v("title",n.title),v("style",n.css),v(e)]),v("body",[n.attributes.children,v("script",n.js)])]}},t={data:{hello:"",name:""},oninit:function(){return t.getServer()},getServer:function(){return v.get("/api/hola").then(function(e){t.data=e})},view:function(){return v("div#mundo.hola",t.data.hello+" "+t.data.name)}},o={count:0,down:function(e){o.count-=e},up:function(e){o.count+=e},view:function(){return v("div",[v("h1",o.count),v("button",{onclick:function(){return o.down(1)}},"-"),v("button",{onclick:function(){return o.up(1)}},"+"),v("button",{onclick:function(){return v.routes.go("/hello")}},"Go to hello"),v([2===o.count?v(2):"",v("br"),v("","boolean true"),v(!0),v("br"),v("","boolean false"),v(!1),v("br"),v("","empty object"),v({},{}),v("br"),v("","null"),v(null),v("br"),v("","undefined"),v(void 0),v("br"),v("ul",function(){var e=[];if(o.count>=0)for(var n=o.count;n--;)e.push(v("li",n));return e}()),v("img.div[src=http://placeimg.com/640/480/any]#ok")])])}},r={s:1,up:function(){return r.s+=1},down:function(){return r.s-=1},view:function(){return v("div",[r.s>0?v("h1",r.s):v("small",""),v("button",{onclick:r.up},"+"),v("button",{onclick:r.down},"-")])}},i={s:1,up:function(){i.s+=1,console.log(i.s)},down:function(){return i.s+=-1},oninit:function(e){console.log("component oninit",e)},oncreate:function(e){console.log("component oncreate",e)},onupdate:function(e){console.log("component onupdate",e)},onbeforeremove:function(e){console.log("component onbeforeremove",e)},onremove:function(e){console.log("component onremove",e)},view:function(){return v("div",[i.s>0?v("h1",{oninit:function(e){console.log("oninit",e)},oncreate:function(e){console.log("oncreate",e)},onupdate:function(e){console.log("onupdate",e)},onbeforeremove:function(e){console.log("onbeforeremove",e)},onremove:function(e){console.log("onremove",e)}},i.s):v("small",""),v("button",{onclick:i.up},"+"),v("button",{onclick:i.down},"-"),v("ul",function(){var e=[];if(i.s>=0)for(var n=i.s;n--;)4!==n&&e.push(v("li",{onbeforeremove:function(e){return console.log("onbeforeremovelistart"),new Promise(function(e){setTimeout(function(){console.log("onbeforeremoveliend"),e()},2e3)})}},v("span",{onbeforeremove:function(e){return console.log("onbeforeremovespanstart"),new Promise(function(e){setTimeout(function(){console.log("onbeforeremovespanend"),e()},1e3)})},onremove:function(e){console.log("onspanremove",e)}},n)));return e}())])}},a=function(){return{hidden:!0,view:function(e){var n=this;return[v("button",{onclick:function(){n.hidden=!n.hidden,v.update()}},this.hidden?"Unhide":"Hide"),v("div",this.hidden?"Hidden":"Unhidden")]}}},c={oninit:function(e){c.sub1=a(),c.sub2=a(),c.sub3=a()},view:function(){return[v(c.sub1,{hidden:!1}),v(c.sub2,{hidden:!0}),v(c.sub3)]}},u={Main:n,Hello:t,Counter:o,Diff:r,Lifecycle:i,Subcomponent:c};console.log(v);var s=v.router();return s.use(function(){return console.log("ok")}).get("/",[function(){return console.log("Init")},function(){return u.Hello}]).get("/hello",[function(){return u.Hello.getServer()},function(){return u.Hello}]).get("/counter",function(){return u.Counter}).get("/diff",function(){return u.Diff}).get("/lifecycle",function(){return u.Lifecycle}).get("/subcomponent",function(){return u.Subcomponent}).get("/hello/:ok",function(e){return u.Hello}),v.routes("body",s),v.isBrowser&&v.sw.register("./sw.js").then(function(){console.log("SW registered")}),{Components:u}});
