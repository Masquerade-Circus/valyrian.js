{"version":3,"file":"valyrian.node.helpers.min.js","sources":["../lib/node.js"],"sourcesContent":["import swTpl from './sw.tpl.js';\n\nlet VNodeHelpersFactory = function (v) {\n    let fs = require('fs'),\n        uncss = require('uncss'),\n        errorHandler = (resolve, reject) => err => {\n            if (err) {\n                return reject(err);\n            }\n\n            resolve();\n        };\n\n    function fileMethodFactory() {\n        let prop = '';\n        return function (file) {\n            if (!file) {\n                return prop;\n            }\n\n            if (/^https?:\\/\\//gi.test(file)) {\n                return v.request.get(file, {}, {\n                    headers: {\n                        'Accept': 'text/plain',\n                        'Content-Type': 'text/plain'\n                    }\n                })\n                    .then(contents => {\n                        prop += contents;\n                    });\n            }\n\n            return new Promise((resolve, reject) => {\n                fs.readFile(file, 'utf8', (err, contents) => {\n                    if (err) {\n                        return reject(err);\n                    }\n\n                    prop += contents;\n                    resolve(prop);\n                });\n            });\n        };\n    };\n\n    v.inline = function (...args) {\n        let promises = args.map(item => {\n            let ext = item.split('.').pop();\n            if (!v.inline[ext]) {\n                v.inline[ext] = fileMethodFactory();\n            }\n            return v.inline[ext](item);\n        });\n\n        return Promise.all(promises);\n    };\n\n    v.inline.uncss = (function () {\n        let prop = '';\n        return function (renderedHtml, options = {}) {\n            options.raw = v.inline.css();\n            if (!renderedHtml) {\n                return prop;\n            }\n\n            return Promise.all(renderedHtml)\n                .then(html => {\n                    html.forEach((item, index) => {\n                        html[index] = item.replace(/<script [^>]*><\\/script>/gi, '');\n                    });\n\n                    return new Promise((resolve, reject) => {\n                        uncss(html, options, (err, output) => {\n                            if (err) {\n                                reject(err);\n                            }\n                            prop = output;\n                            resolve(output);\n                        });\n                    });\n                });\n        };\n    }());\n\n\n    v.sw = function (file, options = {}) {\n        let opt = Object.assign({\n                version: 'v1::',\n                name: 'Valyrian.js',\n                urls: ['/'],\n                debug: false\n            }, options),\n            contents = swTpl\n                .replace('v1::', 'v' + opt.version + '::')\n                .replace('Valyrian.js', opt.name)\n                .replace('[\\'/\\']', '[\"' + opt.urls.join('\",\"') + '\"]');\n\n        if (!opt.debug) {\n            contents = contents.replace('console.log', '() => {}');\n        }\n\n        return new Promise((resolve, reject) => {\n            fs.writeFile(file, contents, 'utf8', errorHandler(resolve, reject));\n        });\n    };\n\n\n    v.icons = function (source, configuration = {}) {\n        let favicons = require('favicons'),\n            html2hs = require('html2hs'),\n            options = Object.assign({}, v.icons.options, configuration);\n\n        if (options.iconsPath) {\n            options.iconsPath = options.iconsPath.replace(/\\/$/gi, '') + '/';\n        }\n\n        if (options.iconsPath) {\n            options.linksViewPath = options.linksViewPath.replace(/\\/$/gi, '') + '/';\n        }\n\n        return new Promise((resolve, reject) => {\n            favicons(source, options, (err, response) => {\n                if (err) {\n                    process.stdout.write(err.status + '\\n'); // HTTP error code (e.g. `200`) or `null`\n                    process.stdout.write(err.name + '\\n'); // Error name e.g. \"API Error\"\n                    process.stdout.write(err.message + '\\n'); // Error description e.g. \"An unknown error has occurred\"\n\n                    return reject(err);\n                }\n\n                let promises = [];\n\n                if (options.iconsPath) {\n                    for (let i in response.images) {\n                        promises.push(new Promise((resolve, reject) => {\n                            fs.writeFile(options.iconsPath + response.images[i].name, response.images[i].contents, errorHandler(resolve, reject));\n                        }));\n                    }\n\n                    for (let i in response.files) {\n                        promises.push(new Promise((resolve, reject) => {\n                            fs.writeFile(options.iconsPath + response.files[i].name, response.files[i].contents, errorHandler(resolve, reject));\n                        }));\n                    }\n                }\n\n                if (options.linksViewPath) {\n                    let html = 'export default { \\n    view(){ \\n        return [';\n                    for (let i in response.html) {\n                        html += '\\n            ' + html2hs(response.html[i]) + ',';\n                    }\n                    html = html.replace(/,$/gi, '').replace(/h\\(\"/gi, 'v(\"') + '\\n        ];\\n    }\\n};';\n\n                    promises.push(new Promise((resolve, reject) => {\n                        fs.writeFile(`${options.linksViewPath}/links.js`, html, errorHandler(resolve, reject));\n                    }));\n                }\n\n                Promise.all(promises)\n                    .then(() => {\n                        resolve(response);\n                    })\n                    .catch(reject);\n            });\n        });\n    };\n\n    v.icons.options = {\n        iconsPath: null, // Path to the generated icons\n        linksViewPath: null, // Path to the generated links file\n\n        // favicons options\n        path: '', // Path for overriding default icons path. `string`\n        appName: null, // Your application's name. `string`\n        appDescription: null, // Your application's description. `string`\n        developerName: null, // Your (or your developer's) name. `string`\n        developerURL: null,\n        dir: 'auto',\n        lang: 'en-US',\n        background: '#fff', // Background colour for flattened icons. `string`\n        theme_color: '#fff',\n        display: \"standalone\", // Android display: \"browser\" or \"standalone\". `string`\n        orientation: \"any\", // Android orientation: \"any\" \"portrait\" or \"landscape\". `string`\n        start_url: \"/\", // Android start application's URL. `string`\n        version: '1.0', // Your application's version number. `number`\n        logging: false, // Print logs to console? `boolean`\n        icons: {\n            android: true, // Create Android homescreen icon. `boolean`\n            appleIcon: true, // Create Apple touch icons. `boolean` or `{ offset: offsetInPercentage }`\n            appleStartup: true, // Create Apple startup images. `boolean`\n            coast: false, // Create Opera Coast icon with offset 25%. `boolean` or `{ offset: offsetInPercentage }`\n            favicons: true, // Create regular favicons. `boolean`\n            firefox: false, // Create Firefox OS icons. `boolean` or `{ offset: offsetInPercentage }`\n            windows: true, // Create Windows 8 tile icons. `boolean`\n            yandex: false // Create Yandex browser icon. `boolean`\n        }\n    };\n};\n\nmodule.exports = VNodeHelpersFactory;\n"],"names":["let","prop","fs","require","uncss","errorHandler","resolve","reject","err","v","inline","promises","args","map","item","ext","split","pop","file","test","request","get","headers","Accept","Content-Type","then","contents","Promise","readFile","all","renderedHtml","options","raw","css","html","forEach","index","replace","output","sw","opt","Object","assign","version","name","urls","debug","swTpl","join","writeFile","icons","source","configuration","favicons","html2hs","iconsPath","linksViewPath","response","process","stdout","write","status","message","push","images","i","files","catch","path","appName","appDescription","developerName","developerURL","dir","lang","background","theme_color","display","orientation","start_url","logging","android","appleIcon","appleStartup","coast","firefox","windows","yandex","module","exports","VNodeHelpersFactory"],"mappings":"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"}