{"version":3,"file":"valyrian.node.helpers.min.js","sources":["../lib/node.js"],"sourcesContent":["import swTpl from './sw.tpl.js';\nlet cssnano = require('cssnano');\nlet CleanCSS = require('clean-css');\n\nlet VNodeHelpersFactory = function (v) {\n    let fs = require('fs'),\n        uncss = require('uncss'),\n        errorHandler = (resolve, reject) => err => {\n            if (err) {\n                return reject(err);\n            }\n\n            resolve();\n        };\n\n    function fileMethodFactory() {\n        let prop = '';\n        return function (file) {\n            if (!file) {\n                return prop;\n            }\n\n            if (/^https?:\\/\\//gi.test(file)) {\n                return v.request.get(file, {}, {\n                    headers: {\n                        'Accept': 'text/plain',\n                        'Content-Type': 'text/plain'\n                    }\n                })\n                    .then(contents => {\n                        prop += contents;\n                    });\n            }\n\n            return new Promise((resolve, reject) => {\n                fs.readFile(file, 'utf8', (err, contents) => {\n                    if (err) {\n                        return reject(err);\n                    }\n\n                    prop += contents;\n                    resolve(prop);\n                });\n            });\n        };\n    };\n\n    v.inline = function (...args) {\n        let promises = args.map(item => {\n            let ext = item.split('.').pop();\n            if (!v.inline[ext]) {\n                v.inline[ext] = fileMethodFactory();\n            }\n            return v.inline[ext](item);\n        });\n\n        return Promise.all(promises);\n    };\n\n    v.inline.uncss = (function () {\n        let prop = '';\n        return function (renderedHtml, options = {}) {\n            if (!renderedHtml) {\n                return prop;\n            }\n\n            let opt = Object.assign({\n                minify: true\n            }, options);\n\n            opt.raw = v.inline.css();\n            return Promise.all(renderedHtml)\n                .then(html => {\n                    html.forEach((item, index) => {\n                        html[index] = item.replace(/<script [^>]*><\\/script>/gi, '');\n                    });\n\n                    return new Promise((resolve, reject) => {\n                        uncss(html, opt, (err, output) => {\n                            if (err) {\n                                return reject(err);\n                            }\n\n                            if (!opt.minify) {\n                                prop = output;\n                                return resolve(output);\n                            }\n\n                            output = new CleanCSS({\n                                level: {\n                                    1: {\n                                        roundingPrecision: 'all=3', // rounds pixel values to `N` decimal places; `false` disables rounding; defaults to `false`\n                                        specialComments: 'none' // denotes a number of /*! ... */ comments preserved; defaults to `all`\n                                    },\n                                    2: {\n                                        restructureRules: true // controls rule restructuring; defaults to false\n                                    }\n                                },\n                                compatibility: 'ie11'\n                            }).minify(output).styles;\n\n                            cssnano.process(output).then(result => {\n                                prop = result.css;\n                                resolve(prop);\n                            });\n                        });\n                    });\n                });\n        };\n    }());\n\n\n    v.sw = function (file, options = {}) {\n        let opt = Object.assign({\n                version: 'v1::',\n                name: 'Valyrian.js',\n                urls: ['/'],\n                debug: false\n            }, options),\n            contents = swTpl\n                .replace('v1::', 'v' + opt.version + '::')\n                .replace('Valyrian.js', opt.name)\n                .replace('[\\'/\\']', '[\"' + opt.urls.join('\",\"') + '\"]');\n\n        if (!opt.debug) {\n            contents = contents.replace('console.log', '() => {}');\n        }\n\n        return new Promise((resolve, reject) => {\n            fs.writeFile(file, contents, 'utf8', errorHandler(resolve, reject));\n        });\n    };\n\n\n    v.icons = function (source, configuration = {}) {\n        let favicons = require('favicons'),\n            html2hs = require('html2hs'),\n            options = Object.assign({}, v.icons.options, configuration);\n\n        if (options.iconsPath) {\n            options.iconsPath = options.iconsPath.replace(/\\/$/gi, '') + '/';\n        }\n\n        if (options.iconsPath) {\n            options.linksViewPath = options.linksViewPath.replace(/\\/$/gi, '') + '/';\n        }\n\n        return new Promise((resolve, reject) => {\n            favicons(source, options, (err, response) => {\n                if (err) {\n                    process.stdout.write(err.status + '\\n'); // HTTP error code (e.g. `200`) or `null`\n                    process.stdout.write(err.name + '\\n'); // Error name e.g. \"API Error\"\n                    process.stdout.write(err.message + '\\n'); // Error description e.g. \"An unknown error has occurred\"\n\n                    return reject(err);\n                }\n\n                let promises = [];\n\n                if (options.iconsPath) {\n                    for (let i in response.images) {\n                        promises.push(new Promise((resolve, reject) => {\n                            fs.writeFile(options.iconsPath + response.images[i].name, response.images[i].contents, errorHandler(resolve, reject));\n                        }));\n                    }\n\n                    for (let i in response.files) {\n                        promises.push(new Promise((resolve, reject) => {\n                            fs.writeFile(options.iconsPath + response.files[i].name, response.files[i].contents, errorHandler(resolve, reject));\n                        }));\n                    }\n                }\n\n                if (options.linksViewPath) {\n                    let html = 'export default { \\n    view(){ \\n        return [';\n                    for (let i in response.html) {\n                        html += '\\n            ' + html2hs(response.html[i]) + ',';\n                    }\n                    html = html.replace(/,$/gi, '').replace(/h\\(\"/gi, 'v(\"') + '\\n        ];\\n    }\\n};';\n\n                    promises.push(new Promise((resolve, reject) => {\n                        fs.writeFile(`${options.linksViewPath}/links.js`, html, errorHandler(resolve, reject));\n                    }));\n                }\n\n                Promise.all(promises)\n                    .then(() => {\n                        resolve(response);\n                    })\n                    .catch(reject);\n            });\n        });\n    };\n\n    v.icons.options = {\n        iconsPath: null, // Path to the generated icons\n        linksViewPath: null, // Path to the generated links file\n\n        // favicons options\n        path: '', // Path for overriding default icons path. `string`\n        appName: null, // Your application's name. `string`\n        appDescription: null, // Your application's description. `string`\n        developerName: null, // Your (or your developer's) name. `string`\n        developerURL: null,\n        dir: 'auto',\n        lang: 'en-US',\n        background: '#fff', // Background colour for flattened icons. `string`\n        theme_color: '#fff',\n        display: \"standalone\", // Android display: \"browser\" or \"standalone\". `string`\n        orientation: \"any\", // Android orientation: \"any\" \"portrait\" or \"landscape\". `string`\n        start_url: \"/\", // Android start application's URL. `string`\n        version: '1.0', // Your application's version number. `number`\n        logging: false, // Print logs to console? `boolean`\n        icons: {\n            android: true, // Create Android homescreen icon. `boolean`\n            appleIcon: true, // Create Apple touch icons. `boolean` or `{ offset: offsetInPercentage }`\n            appleStartup: true, // Create Apple startup images. `boolean`\n            coast: false, // Create Opera Coast icon with offset 25%. `boolean` or `{ offset: offsetInPercentage }`\n            favicons: true, // Create regular favicons. `boolean`\n            firefox: false, // Create Firefox OS icons. `boolean` or `{ offset: offsetInPercentage }`\n            windows: true, // Create Windows 8 tile icons. `boolean`\n            yandex: false // Create Yandex browser icon. `boolean`\n        }\n    };\n};\n\nmodule.exports = VNodeHelpersFactory;\n"],"names":["CleanCSS","require","VNodeHelpersFactory","v","let","prop","fs","uncss","errorHandler","resolve","reject","err","inline","promises","args","map","item","ext","split","pop","file","test","request","get","headers","Accept","Content-Type","then","contents","Promise","readFile","all","renderedHtml","options","opt","Object","assign","minify","raw","css","html","forEach","index","replace","output","level","1","roundingPrecision","specialComments","2","restructureRules","compatibility","styles","cssnano","process","result","sw","version","name","urls","debug","swTpl","join","writeFile","icons","source","configuration","favicons","html2hs","iconsPath","linksViewPath","response","stdout","write","status","message","push","images","i","files","catch","path","appName","appDescription","developerName","developerURL","dir","lang","background","theme_color","display","orientation","start_url","logging","android","appleIcon","appleStartup","coast","firefox","windows","yandex","module","exports"],"mappings":"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"}