{"version":3,"file":"valyrian.min.js","sources":["../lib/patch.js","../lib/index.js"],"sourcesContent":["let plugin = function (v) {\n  let mountedComponent;\n  let oldTree;\n  let newTree;\n  let mainContainer;\n  let und;\n  let oninit = 'oninit';\n  let oncreate = 'oncreate';\n  let onupdate = 'onupdate';\n  let onremove = 'onremove';\n  let svgstr = 'http://www.w3.org/2000/svg';\n\n  function lifecycleCall(vnode, methodName, oldNode, l) {\n    if (vnode.el) {\n      if (vnode.props[methodName]) {\n        vnode.props[methodName](vnode, oldNode);\n      }\n\n      if (methodName === onremove) {\n        l = vnode.children.length;\n        while (l--) {\n          if (vnode.children[l].el) {\n            lifecycleCall(vnode.children[l], onremove);\n          }\n        }\n        vnode.children = [];\n      }\n    }\n  }\n\n  function eventListener(e) {\n    if (e.currentTarget.events['on' + e.type]) {\n      e.currentTarget.events['on' + e.type](e);\n    }\n    v.update();\n  }\n\n  function createElement(newNode, isSVG) {\n    lifecycleCall(newNode, oninit);\n    newNode.dom = isSVG ? document.createElementNS(svgstr, newNode.name) : document.createElement(newNode.name);\n    newNode.dom.events = {};\n  }\n\n  // eslint-disable-next-line complexity, sonarjs/cognitive-complexity\n  function patch($parent, newTree, oldTree, isSVG, max, newNode, oldNode, i, isNew, name) {\n    if (newTree.length === 0) {\n      i = oldTree.length;\n\n      while (i--) {\n        if (oldTree[i].el) {\n          lifecycleCall(oldTree[i], onremove);\n        }\n      }\n\n      $parent.textContent = '';\n      return;\n    }\n\n    max = newTree.length > oldTree.length ? newTree.length : oldTree.length;\n    for (i = 0; i < max; i++) {\n      newNode = newTree[i];\n      oldNode = oldTree[i];\n\n      if (!newNode) {\n        // Removed\n        if (oldNode !== und) {\n          if (oldNode.el) {\n            lifecycleCall(oldNode, onremove);\n          }\n          $parent.removeChild(oldNode.dom);\n        }\n        continue;\n      }\n\n      if (newNode.el === und || !newNode.el) {\n        // Is text\n        if (newNode.el === und) {\n          newTree[i] = newNode = {\n            isVnode: true,\n            nodeValue: newNode,\n            children: [],\n            el: false\n          };\n        }\n\n        if (!oldNode) {\n          newNode.dom = document.createTextNode(newNode.nodeValue);\n          $parent.appendChild(newNode.dom);\n        } else {\n          // Replaced\n          if (oldNode.el) {\n            newNode.dom = document.createTextNode(newNode.nodeValue);\n            lifecycleCall(oldNode, onremove);\n            $parent.replaceChild(newNode.dom, oldNode.dom);\n          } else {\n            newNode.dom = oldNode.dom;\n            if (newNode.nodeValue !== oldNode.nodeValue) {\n              newNode.dom.nodeValue = newNode.nodeValue;\n            }\n          }\n        }\n\n        continue;\n      }\n\n      isNew = !v.is.mounted;\n\n      isSVG = isSVG || newNode.isSVG;\n\n      if (!oldNode) {\n        // Added\n        createElement(newNode, isSVG);\n\n        $parent.appendChild(newNode.dom);\n        oldNode = { children: [] };\n        isNew = true;\n      } else {\n        if (newNode.name !== oldNode.name) {\n          // Replaced\n          createElement(newNode, isSVG);\n\n          lifecycleCall(oldNode, onremove);\n          $parent.replaceChild(newNode.dom, oldNode.dom);\n          isNew = true;\n        } else {\n          // Updated\n          newNode.dom = oldNode.dom;\n          for (name in oldNode.props) {\n            if (newNode.props[name] === und) {\n              if (typeof oldNode.props[name] === 'function') {\n                newNode.dom.removeEventListener(name.slice(2), eventListener);\n                continue;\n              }\n\n              if (v.is.browser && newNode.dom[name] !== und) {\n                newNode.dom[name] = null;\n                continue;\n              }\n\n              newNode.dom.removeAttribute(name);\n            }\n          }\n        }\n      }\n\n      patch(newNode.dom, newNode.children, oldNode.children, isSVG);\n\n      // Update props\n      for (name in newNode.props) {\n        if ((isNew || newNode.props[name] !== oldNode.props[name]) && newNode.props[name] !== und) {\n          if (typeof newNode.props[name] === 'function') {\n            switch (name) {\n              case oninit:\n              case oncreate:\n              case onupdate:\n              case onremove:\n                break;\n              default:\n                if (!newNode.dom.events[name]) {\n                  newNode.dom.events[name] = newNode.props[name];\n                  newNode.dom.addEventListener(name.slice(2), eventListener);\n                }\n                break;\n            }\n\n            continue;\n          }\n\n          if (v.is.browser && newNode.dom[name] !== und) {\n            newNode.dom[name] = newNode.props[name];\n            continue;\n          }\n\n          newNode.dom.setAttribute(name, newNode.props[name]);\n        }\n      }\n\n      if (!v.is.mounted && !isNew) {\n        lifecycleCall(newNode, oninit);\n        lifecycleCall(newNode, oncreate);\n      }\n\n      lifecycleCall(newNode, isNew ? oncreate : onupdate, oldNode);\n    }\n  }\n\n  // If use undom this serializes the dom to string html\n  function serialize(el, outer = true, i) {\n    if (el.nodeType === 3) {\n      return el.textContent;\n    }\n\n    let name = el.nodeName.toLowerCase();\n    let str = '';\n    let attr = el.attributes;\n    let child = el.childNodes;\n\n    if (outer) {\n      str += `<${name}`;\n      i = attr.length;\n      while (i--) {\n        str += ` ${attr[i].name}=\"${attr[i].value}\"`;\n      }\n\n      str += '>';\n    }\n\n    for (i = 0; i < child.length; i++) {\n      str += serialize(child[i]);\n    }\n\n    str += outer ? `</${name}>` : '';\n    return str;\n  }\n\n  v.update = function (args) {\n    args = v.utils.flat(arguments, 0, []);\n    if (args[0]) {\n      if (!args[0].view && typeof args[0] === 'function') {\n        args[0].view = args[0];\n      }\n\n      if (args[0].view) {\n        mountedComponent = args.shift();\n      }\n    }\n\n    if (!v.is.updating) {\n      v.is.updating = true;\n      args.unshift(mountedComponent);\n      newTree = v.apply(v, args);\n      patch(mainContainer, newTree, oldTree);\n      oldTree = newTree;\n      v.is.updating = false;\n      v.is.mounted = true;\n    }\n\n    if (v.is.node) {\n      return mainContainer.innerHTML;\n    }\n  };\n\n  v.mount = function (container) {\n    mainContainer = v.is.node\n      ? document.createElement('div')\n      : typeof container === 'string'\n        ? document.querySelectorAll(container)[0]\n        : container;\n\n    oldTree = v.utils.dom2vnode(mainContainer).children;\n\n    return v.update.apply(this, v.utils.flat(arguments, 1, []));\n  };\n};\n\nexport default plugin;\n","'use strict';\nimport Patch from './patch';\n\nfunction v(tagOrComponent, props, vnode, i, children) {\n  if (typeof tagOrComponent === 'string') {\n    vnode = {\n      name: tagOrComponent,\n      props: {},\n      children: [],\n      dom: null,\n      isVnode: true,\n      el: true,\n      isSVG: tagOrComponent === 'svg'\n    };\n\n    for (i in props) {\n      vnode.props[i] = props[i];\n    }\n\n    v.utils.flat(arguments, 2, vnode.children, true);\n    return vnode;\n  }\n\n  if (!tagOrComponent.view && typeof tagOrComponent === 'function') {\n    tagOrComponent.view = tagOrComponent;\n  }\n\n  if (tagOrComponent.view) {\n    children = tagOrComponent.view.apply(tagOrComponent, v.utils.flat(arguments, 1, []));\n    return Array.isArray(children) ? children : [children];\n  }\n}\n\n// This could be extended to do a deep clone\n// This mutates the component\nv.addState = function (component, state) {\n  Object.assign(component, { view: component }, state);\n};\n\nv.utils = {\n  flat: function (args, start, arr, notEmpty, l) {\n    l = args.length;\n\n    for (; start < l; start++) {\n      if (Array.isArray(args[start])) {\n        arr = v.utils.flat(args[start], 0, arr);\n        continue;\n      }\n      if (!notEmpty || (args[start] !== undefined && args[start] !== null)) {\n        arr.push(args[start]);\n      }\n    }\n\n    return arr;\n  },\n  dom2vnode($el, vnode, nt) {\n    nt = $el.nodeType;\n    if (nt === 3 || nt === 1) {\n      vnode = {\n        props: {},\n        children: [],\n        dom: $el,\n        isVnode: true,\n        el: true,\n        isSVG: false\n      };\n\n      if (nt === 3) {\n        vnode.nodeValue = $el.nodeValue;\n        vnode.el = false;\n        return vnode;\n      }\n\n      vnode.name = $el.nodeName.toLowerCase();\n\n      if (vnode.name === 'svg') {\n        vnode.isSVG = true;\n      }\n\n      vnode.dom.events = {};\n\n      Array.prototype.map.call($el.attributes, function (property) {\n        vnode.props[property.nodeName] = property.nodeValue;\n      });\n\n      Array.prototype.forEach.call($el.childNodes, function ($el) {\n        let childvnode = v.utils.dom2vnode($el);\n        if (childvnode) {\n          vnode.children.push(childvnode);\n        }\n      });\n\n      return vnode;\n    }\n  }\n};\n\nv.is = {\n  node: typeof window === 'undefined',\n  mounted: false,\n  updating: false\n};\nv.is.browser = !v.is.node;\n\n// NOTE: This does not work with undom for server side rendering\n// See: https://github.com/developit/undom/issues/7\nv.trust = function (htmlString) {\n  let div = document.createElement('div');\n  div.innerHTML = htmlString.trim();\n\n  return Array.prototype.map.call(div.childNodes, (item) => v.utils.dom2vnode(item));\n};\n\nlet plugins = [];\nv.use = function (plugin, options) {\n  if (plugins.indexOf(plugin) === -1) {\n    plugin(v, options);\n    plugins.push(plugin);\n  }\n  return v;\n};\n\nv.use(Patch);\n\n(v.is.node ? global : window).v = v;\n"],"names":["v","tagOrComponent","props","vnode","i","children","name","dom","isVnode","el","isSVG","utils","flat","arguments","view","apply","Array","isArray","addState","component","state","Object","assign","args","start","arr","notEmpty","l","length","undefined","push","[object Object]","$el","nt","nodeType","nodeValue","nodeName","toLowerCase","events","prototype","map","call","attributes","property","forEach","childNodes","childvnode","dom2vnode","is","node","window","mounted","updating","browser","trust","htmlString","div","document","createElement","innerHTML","trim","item","plugins","use","plugin","options","indexOf","mountedComponent","oldTree","newTree","mainContainer","und","oninit","oncreate","onupdate","onremove","svgstr","lifecycleCall","methodName","oldNode","eventListener","e","currentTarget","type","update","newNode","createElementNS","shift","unshift","patch","$parent","max","isNew","replaceChild","removeEventListener","slice","removeAttribute","appendChild","addEventListener","setAttribute","createTextNode","removeChild","textContent","mount","container","querySelectorAll","this","global"],"mappings":"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"}