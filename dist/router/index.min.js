(()=>{"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a={};((t,r)=>{for(var n in r)e(t,n,{get:r[n],enumerable:!0})})(a,{Router:()=>p,plugin:()=>l});var i,o,s=(i=a,((a,i,o,s)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let h of r(i))n.call(a,h)||h===o||e(a,h,{get:()=>i[h],enumerable:!(s=t(i,h))||s.enumerable});return a})(e({},"__esModule",{value:!0}),i));var h=(e,t,r,n)=>{if(0===n.length)return;let a=r.replace(/(\S)(\/+)$/,"$1"),i=a.match(/:(\w+)?/gi)||[];for(let e in i)i[e]=i[e].slice(1);let o="^"+a.replace(/:(\w+)/gi,"([^\\/\\s]+)")+"$";var s;e.paths.push({method:t,path:a,middlewares:(s=n,Array.isArray(s)?s.flat(1/0):[s]),params:i,regexp:new RegExp(o,"i")})};var p=class{paths=[];container=null;query={};options={};url="";path="";params={};matches=[];add(e,...t){return h(this,"add",e,t),this}use(...e){let t,r,n,a,i,o="string"==typeof e[0]?e.shift():"/";for(t=0;t<e.length;t++)if(n=e[t],"function"==typeof n)h(this,"use",`${o}.*`,[n]);else if(n.paths)for(r=0;r<n.paths.length;r++)a=n.paths[r],i=`${o}${a.path}`.replace(/^\/\//,"/"),h(this,a.method,i,a.middlewares);return this}routes(){let e=[];return this.paths.forEach(t=>{"add"===t.method&&e.push(t.path)}),e}async go(e,t){if(!e)throw new Error("router.url.required");let r=e.split("?",2),n=r[0].replace(/(.+)\/$/,"$1"),a=r[1];this.url=e,this.query=function(e){let t,r=e?e.split("&",20):[],n={},a=0;for(;a<r.length;a++)t=r[a].split("=",2),n[t[0]]=t[1];return n}(a);let i=function(e,t){let r,n,a,i,o,s=[],h={},p=[];for(e.params={},e.path="",e.matches=[],r=0;r<e.paths.length;r++)if(a=e.paths[r],i=a.regexp.exec(t),Array.isArray(i)){for(s.push(...a.middlewares),i.shift(),n=0;n<a.params.length;n++)o=a.params[n],h[o]=i.shift();for(;i.length;)p.push(i.shift());if("add"===a.method){e.path=a.path;break}}return e.params=h,e.matches=p,s}(this,n),s=await async function(e,t){let r,n={params:e.params,query:e.query,url:e.url,path:e.path,matches:e.matches,redirect:(t,r)=>(e.go(t,r),!1)},a=0;for(;a<t.length;a++){if(r=await t[a](n,r),void 0!==r&&o.isComponent(r))return r;if(!1===r)return!1}}(this,i);if(!1!==s){if(!s)throw new Error(`The url ${e} requested wasn't found`);if(o.isComponent(t)){let e=o.isVnodeComponent(s)?s:o(s,{});o.isVnodeComponent(t)?(t.children.push(e),s=t):s=o(t,{},e)}return o.isNodeJs||window.history.pushState(null,"",e),o.isMounted&&o.component===s?o.update():this.container?o.mount(this.container,s):void 0}}getOnClickHandler(e){return t=>{"string"==typeof e&&e.length>0&&this.go(e),t.preventDefault()}}};function l(e){return(o=e).mountRouter=(e,t)=>{if(t instanceof p){if(t.container=e,o.redirect=t.go.bind(t),!o.isNodeJs){let e=function(){t.go(document.location.pathname)};window.addEventListener("popstate",e,!1),e()}o.directive("route",(e,r,n)=>{o.setAttribute("href",e,r,n),o.setAttribute("onclick",t.getOnClickHandler(e),r,n)})}},p}"undefined"!=typeof module?module.exports=s:self.ValyrianRouter=s})();//# sourceMappingURL=index.min.js.map