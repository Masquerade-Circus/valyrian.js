{
  "version": 3,
  "sources": ["../../lib/translate/index.ts"],
  "sourcesContent": ["import { directive, isNodeJs, setPropNameReserved, update, VnodeWithDom } from \"valyrian.js\";\nimport { createContextScope, getContext, isServerContextActive, setContext } from \"valyrian.js/context\";\nimport { get, isString } from \"valyrian.js/utils\";\n\nconst translations: Record<string, Record<string, any>> = {};\nlet currentLang = \"en\";\n\nlet storeStrategy = {\n  get: () => currentLang,\n  set: (lang: string) => {\n    currentLang = lang;\n  }\n};\n\nconst langContextScope = createContextScope<string>(\"translate.lang\");\n\nlet log = false;\n\nexport function setLog(value: boolean) {\n  log = value;\n}\n\nexport function setStoreStrategy(strategy: { get: () => string; set: (lang: string) => void }) {\n  storeStrategy = strategy;\n}\n\nexport function getLang(): string {\n  if (isNodeJs && isServerContextActive()) {\n    const contextLang = getContext(langContextScope);\n    if (isString(contextLang)) {\n      return contextLang;\n    }\n  }\n\n  return storeStrategy.get();\n}\n\nexport function setLang(newLang: string): void {\n  if (!isString(newLang)) {\n    throw new Error(`Language ${newLang} not found`);\n  }\n\n  const parsedLang = newLang.toLowerCase().split(\"-\").shift()?.split(\"_\").shift();\n\n  if (!isString(parsedLang)) {\n    throw new Error(`Language ${newLang} not found`);\n  }\n\n  if (!translations[parsedLang]) {\n    throw new Error(`Language ${newLang} not found`);\n  }\n\n  if (isNodeJs && isServerContextActive()) {\n    setContext(langContextScope, parsedLang);\n  } else {\n    storeStrategy.set(parsedLang);\n  }\n  update();\n}\n\nexport function t(path: string, params?: Record<string, string>): string {\n  const langDef = translations[getLang()];\n  const translation = get(langDef, path);\n\n  if (!isString(translation)) {\n    if (log) {\n      // eslint-disable-next-line no-console\n      console.warn(`Translation not found for ${path}`);\n    }\n    return path;\n  }\n\n  if (!params) {\n    return translation;\n  }\n\n  return translation.replace(/{(\\w+)}/g, (_, key) => {\n    if (key in params) {\n      return params[key];\n    }\n    return `{${key}}`;\n  });\n}\n\nexport function setTranslations(\n  defaultTranslation: Record<string, any>,\n  newTranslations: Record<string, Record<string, any>> = {}\n) {\n  for (const lang in translations) {\n    Reflect.deleteProperty(translations, lang);\n  }\n\n  translations.en = { ...defaultTranslation };\n\n  for (const lang in newTranslations) {\n    translations[lang] = {\n      ...defaultTranslation,\n      ...newTranslations[lang]\n    };\n  }\n  update();\n}\n\nexport function getTranslations(): Record<string, Record<string, any>> {\n  return translations;\n}\n\ndirective(\"t\", (value: string | null, vnode: VnodeWithDom): void => {\n  const keys = isString(value) ? [value] : vnode.children;\n  const params = vnode.props[\"v-t-params\"] || {};\n  const children = keys.map((key) => (isString(key) && key.trim().length > 1 ? t(key.trim(), params) : key));\n  vnode.children = children;\n});\n\nsetPropNameReserved(\"v-t-params\");\n"],
  "mappings": ";AAAA,SAAS,WAAW,UAAU,qBAAqB,cAA4B;AAC/E,SAAS,oBAAoB,YAAY,uBAAuB,kBAAkB;AAClF,SAAS,KAAK,gBAAgB;AAE9B,IAAM,eAAoD,CAAC;AAC3D,IAAI,cAAc;AAElB,IAAI,gBAAgB;AAAA,EAClB,KAAK,MAAM;AAAA,EACX,KAAK,CAAC,SAAiB;AACrB,kBAAc;AAAA,EAChB;AACF;AAEA,IAAM,mBAAmB,mBAA2B,gBAAgB;AAEpE,IAAI,MAAM;AAEH,SAAS,OAAO,OAAgB;AACrC,QAAM;AACR;AAEO,SAAS,iBAAiB,UAA8D;AAC7F,kBAAgB;AAClB;AAEO,SAAS,UAAkB;AAChC,MAAI,YAAY,sBAAsB,GAAG;AACvC,UAAM,cAAc,WAAW,gBAAgB;AAC/C,QAAI,SAAS,WAAW,GAAG;AACzB,aAAO;AAAA,IACT;AAAA,EACF;AAEA,SAAO,cAAc,IAAI;AAC3B;AAEO,SAAS,QAAQ,SAAuB;AAC7C,MAAI,CAAC,SAAS,OAAO,GAAG;AACtB,UAAM,IAAI,MAAM,YAAY,OAAO,YAAY;AAAA,EACjD;AAEA,QAAM,aAAa,QAAQ,YAAY,EAAE,MAAM,GAAG,EAAE,MAAM,GAAG,MAAM,GAAG,EAAE,MAAM;AAE9E,MAAI,CAAC,SAAS,UAAU,GAAG;AACzB,UAAM,IAAI,MAAM,YAAY,OAAO,YAAY;AAAA,EACjD;AAEA,MAAI,CAAC,aAAa,UAAU,GAAG;AAC7B,UAAM,IAAI,MAAM,YAAY,OAAO,YAAY;AAAA,EACjD;AAEA,MAAI,YAAY,sBAAsB,GAAG;AACvC,eAAW,kBAAkB,UAAU;AAAA,EACzC,OAAO;AACL,kBAAc,IAAI,UAAU;AAAA,EAC9B;AACA,SAAO;AACT;AAEO,SAAS,EAAE,MAAc,QAAyC;AACvE,QAAM,UAAU,aAAa,QAAQ,CAAC;AACtC,QAAM,cAAc,IAAI,SAAS,IAAI;AAErC,MAAI,CAAC,SAAS,WAAW,GAAG;AAC1B,QAAI,KAAK;AAEP,cAAQ,KAAK,6BAA6B,IAAI,EAAE;AAAA,IAClD;AACA,WAAO;AAAA,EACT;AAEA,MAAI,CAAC,QAAQ;AACX,WAAO;AAAA,EACT;AAEA,SAAO,YAAY,QAAQ,YAAY,CAAC,GAAG,QAAQ;AACjD,QAAI,OAAO,QAAQ;AACjB,aAAO,OAAO,GAAG;AAAA,IACnB;AACA,WAAO,IAAI,GAAG;AAAA,EAChB,CAAC;AACH;AAEO,SAAS,gBACd,oBACA,kBAAuD,CAAC,GACxD;AACA,aAAW,QAAQ,cAAc;AAC/B,YAAQ,eAAe,cAAc,IAAI;AAAA,EAC3C;AAEA,eAAa,KAAK,EAAE,GAAG,mBAAmB;AAE1C,aAAW,QAAQ,iBAAiB;AAClC,iBAAa,IAAI,IAAI;AAAA,MACnB,GAAG;AAAA,MACH,GAAG,gBAAgB,IAAI;AAAA,IACzB;AAAA,EACF;AACA,SAAO;AACT;AAEO,SAAS,kBAAuD;AACrE,SAAO;AACT;AAEA,UAAU,KAAK,CAAC,OAAsB,UAA8B;AAClE,QAAM,OAAO,SAAS,KAAK,IAAI,CAAC,KAAK,IAAI,MAAM;AAC/C,QAAM,SAAS,MAAM,MAAM,YAAY,KAAK,CAAC;AAC7C,QAAM,WAAW,KAAK,IAAI,CAAC,QAAS,SAAS,GAAG,KAAK,IAAI,KAAK,EAAE,SAAS,IAAI,EAAE,IAAI,KAAK,GAAG,MAAM,IAAI,GAAI;AACzG,QAAM,WAAW;AACnB,CAAC;AAED,oBAAoB,YAAY;",
  "names": []
}
