(()=>{"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,o={};((t,r)=>{for(var n in r)e(t,n,{get:r[n],enumerable:!0})})(o,{createEffect:()=>p,createMutableStore:()=>d,createPulseStore:()=>f});var a,l=(a=o,((o,a,l,u)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let i of r(a))n.call(o,i)||i===l||e(o,i,{get:()=>a[i],enumerable:!(u=t(a,i))||u.enumerable});return o})(e({},"__esModule",{value:!0}),a)),u=require("valyrian.js"),i=require("valyrian.js/utils"),s=[];function c(e,t,r=!1){const n=new Set,o=new WeakSet,a={};for(const e in t){if("function"!=typeof t[e])throw new Error(`Pulse '${e}' must be a function`);if("state"===e)throw new Error("A pulse cannot be named 'state'");a[e]=m(e)}const l=("function"==typeof e?e():e)||{};function c(){if(r)throw new Error("You need to call a pulse to modify the state")}let f=null,d=0;const p=new Proxy(l,{get:(e,t)=>{if(f)return f[t];const r=s[s.length-1];r&&!n.has(r)&&n.add(r);const a=u.current.vnode;if(a&&!o.has(a.dom)){let r=!1,l=a.dom.parentElement;for(;l;){if(o.has(l)){r=!0;break}l=l.parentElement}if(r)return e[t];const i=a.dom,s=()=>{(0,u.updateVnode)(i.vnode),i.parentElement||(n.delete(s),o.delete(i))};n.add(s),o.add(i)}return e[t]},set:(e,t,r)=>(c(),Reflect.set(e,t,r),!0),deleteProperty:(e,t)=>(c(),Reflect.deleteProperty(e,t),!0)});function h(e){for(const t in e)l[t]=r?(0,i.deepFreeze)(e[t]):e[t];for(const t in l)t in e||Reflect.deleteProperty(l,t)}let y=null;function w(e){d--,(0,i.hasChanged)(l,e)&&(d>0||(h(e),f=null,y&&clearTimeout(y),y=setTimeout(()=>n.forEach(e=>e()),0)))}function m(e){return(...r)=>{d++,null===f&&(f=(0,i.deepCloneUnfreeze)(l));try{const n=t[e](f,...r);return n instanceof Promise?n.then(e=>(w(f),e)).catch(t=>{throw console.error(`Error in pulse '${e}':`,t),t}):(w(f),n)}catch(t){throw console.error(`Error in pulse '${e}':`,t),t}}}h(l);return new Proxy(a,{get:(e,t)=>{if("state"===t)return p;if(!(t in e))throw new Error(`Pulse '${t}' does not exist`);return e[t]}})}function f(e,t){return c(e,t,!0)}function d(e,t){return console.warn("Warning: You are working with a mutable state. This can lead to unpredictable behavior. All state changes made outside of a pulse will not trigger a re-render."),c(e,t,!1)}function p(e){const t=()=>{try{s.push(t),e()}finally{s.pop()}};t()}"undefined"!=typeof module?module.exports=l:self.ValyrianPulseStore=l})();//# sourceMappingURL=index.min.js.map