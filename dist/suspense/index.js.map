{
  "version": 3,
  "sources": ["../../lib/suspense/index.ts"],
  "sourcesContent": ["import { ValyrianComponent, Vnode, isVnodeComponent, isPOJOComponent, isComponent, v, Children } from \"valyrian.js\";\nimport { useState } from \"valyrian.js/hooks\";\n\nexport function Suspense(\n  {\n    fallback,\n    error\n  }: { fallback: any | Vnode | ValyrianComponent; error?: (e: Error) => any | Vnode | ValyrianComponent },\n  children: Children\n): ValyrianComponent {\n  const [loadedChildren, setLoadedChildren] = useState(null);\n  const [err, setErr] = useState(null);\n\n  return v(() => {\n    if (err()) {\n      if (error) {\n        return error(err());\n      }\n      return err().message;\n    }\n\n    if (loadedChildren()) {\n      return loadedChildren();\n    }\n\n    Promise.all(\n      children.map((child) => {\n        if (isVnodeComponent(child)) {\n          if (isPOJOComponent(child.tag)) {\n            return child.tag.view.bind(child.tag)(child.props || {}, child.children);\n          }\n\n          return child.tag(child.props || {}, child.children);\n        }\n\n        if (isPOJOComponent(child)) {\n          return child.view.bind(child)({}, []);\n        }\n\n        if (isComponent(child)) {\n          return child({}, []);\n        }\n\n        return child;\n      })\n    )\n      .then((newChildren) => {\n        setLoadedChildren(newChildren);\n      })\n      .catch((e) => {\n        setErr(e);\n      });\n\n    return fallback;\n  }, {}) as unknown as ValyrianComponent;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAAsG;AACtG,mBAAyB;AAElB,SAAS,SACd;AAAA,EACE;AAAA,EACA;AACF,GACA,UACmB;AACnB,QAAM,CAAC,gBAAgB,iBAAiB,QAAI,uBAAS,IAAI;AACzD,QAAM,CAAC,KAAK,MAAM,QAAI,uBAAS,IAAI;AAEnC,aAAO,mBAAE,MAAM;AACb,QAAI,IAAI,GAAG;AACT,UAAI,OAAO;AACT,eAAO,MAAM,IAAI,CAAC;AAAA,MACpB;AACA,aAAO,IAAI,EAAE;AAAA,IACf;AAEA,QAAI,eAAe,GAAG;AACpB,aAAO,eAAe;AAAA,IACxB;AAEA,YAAQ;AAAA,MACN,SAAS,IAAI,CAAC,UAAU;AACtB,gBAAI,kCAAiB,KAAK,GAAG;AAC3B,kBAAI,iCAAgB,MAAM,GAAG,GAAG;AAC9B,mBAAO,MAAM,IAAI,KAAK,KAAK,MAAM,GAAG,EAAE,MAAM,SAAS,CAAC,GAAG,MAAM,QAAQ;AAAA,UACzE;AAEA,iBAAO,MAAM,IAAI,MAAM,SAAS,CAAC,GAAG,MAAM,QAAQ;AAAA,QACpD;AAEA,gBAAI,iCAAgB,KAAK,GAAG;AAC1B,iBAAO,MAAM,KAAK,KAAK,KAAK,EAAE,CAAC,GAAG,CAAC,CAAC;AAAA,QACtC;AAEA,gBAAI,6BAAY,KAAK,GAAG;AACtB,iBAAO,MAAM,CAAC,GAAG,CAAC,CAAC;AAAA,QACrB;AAEA,eAAO;AAAA,MACT,CAAC;AAAA,IACH,EACG,KAAK,CAAC,gBAAgB;AACrB,wBAAkB,WAAW;AAAA,IAC/B,CAAC,EACA,MAAM,CAAC,MAAM;AACZ,aAAO,CAAC;AAAA,IACV,CAAC;AAEH,WAAO;AAAA,EACT,GAAG,CAAC,CAAC;AACP;",
  "names": []
}
