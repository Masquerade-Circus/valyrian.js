{
  "version": 3,
  "sources": ["../../lib/money/index.ts"],
  "sourcesContent": ["import { directive, setAttribute, VnodeWithDom } from \"valyrian.js\";\n\nexport type MoneyFormatOptions = {\n  locale?: Intl.LocalesArgument;\n  currency?: string;\n  digits?: number;\n  style?: Intl.NumberFormatOptions[\"style\"];\n};\n\nexport class NumberFormatter {\n  #value = 0;\n\n  get value() {\n    return this.#value;\n  }\n\n  private constructor() {}\n\n  set(newValue: number | string, shiftDecimal = false) {\n    this.#value = this.clean(newValue, shiftDecimal);\n    return this;\n  }\n\n  private clean(value: string | number, shiftDecimal = false) {\n    let stringNumber = String(value).replace(/[^0-9.-]+/g, \"\");\n    if (shiftDecimal) {\n      stringNumber = stringNumber.replace(/\\./g, \"\");\n    }\n    const number = Number(stringNumber);\n    return isNaN(number) ? 0 : number;\n  }\n\n  format(digits = 2, options: Intl.NumberFormatOptions = {}, locale: Intl.LocalesArgument = \"en\") {\n    const formatter = new Intl.NumberFormat(locale, {\n      style: \"currency\",\n      currency: \"USD\",\n      minimumFractionDigits: digits,\n      maximumFractionDigits: digits,\n      ...options\n    });\n\n    return formatter.format(this.#value);\n  }\n\n  fromDecimalPlaces(decimalPlaces: number) {\n    const currentDecimalPlaces = this.getDecimalPlaces();\n    const factor = Math.pow(10, decimalPlaces - currentDecimalPlaces);\n    this.#value = Number((this.#value / factor).toFixed(decimalPlaces));\n    return this;\n  }\n\n  toDecimalPlaces(decimalPlaces: number) {\n    const currentDecimalPlaces = this.getDecimalPlaces();\n    const factor = Math.pow(10, currentDecimalPlaces - decimalPlaces);\n    this.#value = Number((this.#value * factor).toFixed(decimalPlaces));\n    return this;\n  }\n\n  getDecimalPlaces() {\n    if (Math.floor(this.#value) === this.#value) {\n      return 0;\n    }\n\n    const stringValue = String(this.#value);\n    const decimalIndex = stringValue.indexOf(\".\");\n    return decimalIndex === -1 ? 0 : stringValue.length - decimalIndex - 1;\n  }\n\n  shiftDecimalPlaces() {\n    return this.toDecimalPlaces(0);\n  }\n\n  static create(value: number | string = 0, shiftDecimal = false) {\n    const formatter = new NumberFormatter();\n    return formatter.set(value, shiftDecimal);\n  }\n}\n\nexport class Money {\n  private cents: number;\n\n  private constructor(cents: number) {\n    this.cents = Math.trunc(cents);\n  }\n\n  static fromCents(cents: number) {\n    return new Money(cents);\n  }\n\n  static fromDecimal(value: number, decimalPlaces = 2) {\n    const factor = Math.pow(10, decimalPlaces);\n    return new Money(Math.round(value * factor));\n  }\n\n  toCents() {\n    return this.cents;\n  }\n\n  toDecimal(decimalPlaces = 2) {\n    const factor = Math.pow(10, decimalPlaces);\n    return this.cents / factor;\n  }\n\n  add(other: Money) {\n    return new Money(this.cents + other.toCents());\n  }\n\n  subtract(other: Money) {\n    return new Money(this.cents - other.toCents());\n  }\n\n  multiply(multiplier: number) {\n    return new Money(Math.round(this.cents * multiplier));\n  }\n\n  divide(divider: number) {\n    if (divider === 0) {\n      throw new Error(\"Cannot divide by zero\");\n    }\n    return new Money(Math.round(this.cents / divider));\n  }\n}\n\nexport function parseMoneyInput(value: string, options: { locale?: Intl.LocalesArgument; decimalPlaces?: number } = {}) {\n  const decimalPlaces = options.decimalPlaces ?? 2;\n  const clean = String(value)\n    .replace(/\\s/g, \"\")\n    .replace(/[^0-9,.-]/g, \"\")\n    .replace(/,(?=\\d{3}(\\D|$))/g, \"\")\n    .replace(/,/g, \".\");\n\n  const amount = Number(clean);\n  if (isNaN(amount)) {\n    return Money.fromCents(0);\n  }\n\n  return Money.fromDecimal(amount, decimalPlaces);\n}\n\nexport function formatMoney(value: Money | number, options: MoneyFormatOptions = {}) {\n  const digits = options.digits ?? 2;\n  const currency = options.currency || \"USD\";\n  const locale = options.locale || \"en\";\n  const style = options.style || \"currency\";\n  const amount = value instanceof Money ? value.toDecimal(digits) : value;\n\n  return NumberFormatter.create(amount).format(digits, { style, currency }, locale);\n}\n\ntype MoneyDirectiveOptions = {\n  model: Record<string, any>;\n  field: string;\n  currency?: string;\n  locale?: Intl.LocalesArgument;\n  decimalPlaces?: number;\n};\n\ndirective(\"money\", (config: MoneyDirectiveOptions, vnode: VnodeWithDom) => {\n  const decimalPlaces = config.decimalPlaces ?? 2;\n  const currency = config.currency || \"USD\";\n  const locale = config.locale || \"en\";\n  const cents = Number(config.model[config.field] || 0);\n  const value = formatMoney(Money.fromCents(cents), {\n    digits: decimalPlaces,\n    currency,\n    locale\n  });\n\n  setAttribute(\"value\", value, vnode);\n\n  const prevOnInput = vnode.props.oninput;\n\n  setAttribute(\n    \"oninput\",\n    (event: Event) => {\n      const target = event.target as HTMLInputElement;\n      const money = parseMoneyInput(target.value, { locale, decimalPlaces });\n      config.model[config.field] = money.toCents();\n\n      target.value = formatMoney(money, {\n        digits: decimalPlaces,\n        currency,\n        locale\n      });\n\n      if (typeof prevOnInput === \"function\") {\n        prevOnInput(event);\n      }\n    },\n    vnode\n  );\n});\n"],
  "mappings": "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",
  "names": []
}
