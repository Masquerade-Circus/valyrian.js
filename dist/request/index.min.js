(()=>{"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,s={};((t,o)=>{for(var r in o)e(t,r,{get:o[r],enumerable:!0})})(s,{request:()=>d});var n,a=(n=s,((s,n,a,i)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let l of o(n))r.call(s,l)||l===a||e(s,l,{get:()=>n[l],enumerable:!(i=t(n,l))||i.enumerable});return s})(e({},"__esModule",{value:!0}),n)),i=require("valyrian.js"),l=require("valyrian.js/utils");function c(e,t){if(null==e)return new URLSearchParams;const o=new URLSearchParams;return Object.keys(e).forEach(r=>{const s=t?`${t}[${r}]`:r;if("object"==typeof e[r]&&null!==e[r]){return void c(e[r],s).forEach((e,t)=>o.append(t,e))}o.append(s,e[r])}),o}var u={allowedMethods:["get","post","put","patch","delete","head","options"]};var d=function e(t="",o=u){const r=t.replace(/\/$/gi,"").trim();o.urls||(o.urls={base:"",node:null,api:null}),o.allowedMethods||(o.allowedMethods=u.allowedMethods);const s={...o,urls:{node:o.urls.node||null,api:o.urls.api||null,base:o.urls.base?o.urls.base+r:r}},n=new Map;let a=0;const d=async e=>{let t=e;for(const e of n.values()){if(!e.error)continue;const o=await e.error(t);o&&(t=o)}return t},p=async function(e,t,o,r={}){const a={method:e.toUpperCase(),headers:{},resolveWithFullResponse:!1,...s,...r};if(a.headers={...a.headers,...s.headers,...r.headers},a.headers.Accept||(a.headers.Accept="application/json"),!a.allowedMethods.includes(e))throw new Error(`Method ${e} not allowed. Allowed methods: ${a.allowedMethods.join(", ")}`);let u;try{u=function(e,t){const o=e.replace(/\/+$/g,"").trim(),r=/^https?/gi.test(o)?o:`${t.urls.base||""}${o}`;if(i.isNodeJs&&(0,l.isString)(t.urls.node)){if((0,l.isString)(t.urls.api))return new URL(r.replace(t.urls.api,t.urls.node));if(!/^https?/gi.test(r))return new URL(r,t.urls.node)}return/^https?/gi.test(r)||i.isNodeJs?new URL(r):new URL(r,window.location.origin)}(t,s)}catch(e){const o=new Error(`Failed to parse URL: ${t}`,{cause:e});throw o.cause=e,o}let p=await(async e=>{let t=e;for(const e of n.values()){if(!e.request)continue;const o=await e.request(t);o&&(t=o)}return t})({method:e,url:u,data:o,options:a});u=p.url;const f=p.options.headers.Accept,h=p.options.headers["Content-Type"]||p.options.headers["content-type"]||"";if(p.data)if("GET"===p.options.method&&"object"==typeof p.data)u.search=c(p.data).toString();else if((e=>e instanceof FormData||e instanceof URLSearchParams||e instanceof Blob||e instanceof ArrayBuffer||"undefined"!=typeof DataView&&e instanceof DataView||"undefined"!=typeof ReadableStream&&e instanceof ReadableStream)(p.data)||(0,l.isString)(p.data))p.options.body=p.data;else{const e=/json/gi.test(h);p.options.body=e?JSON.stringify(p.data):function(e){const t=new FormData;return Object.entries(e).forEach(([e,o])=>{null!=o&&(Array.isArray(o)?o.forEach(o=>t.append(e,o)):t.append(e,o))}),t}(p.data)}try{const e=await fetch(u.toString(),p.options);if(!e.ok){const t=new Error(`${e.status}: ${e.statusText}`);if(t.response=e,/text/gi.test(f))t.body=await e.text();else if(/json/gi.test(f))try{t.body=await e.json()}catch{t.body=null}const o=(await d({...p,response:e,body:t.body,error:t})).error;throw(0,l.isObject)(o)&&(o.__requestPluginHandled=!0),o}if(p.options.resolveWithFullResponse)return e;let t=e;if(/text/gi.test(f))t=await e.text();else if(/json/gi.test(f))try{t=await e.json()}catch{t=null}else/blob/gi.test(f)?t=await e.blob():/arraybuffer/gi.test(f)&&(t=await e.arrayBuffer());return(await(async e=>{let t=e;for(const e of n.values()){if(!e.response)continue;const o=await e.response(t);o&&(t=o)}return t})({...p,response:e,body:t})).body}catch(e){if(e&&(e.response||e.__requestPluginHandled))throw e;const t=(await d({...p,error:e})).error;throw(0,l.isObject)(t)&&(t.__requestPluginHandled=!0),t}};return p.new=(t,o)=>{const r=e(t,{...s,...o||{}});return n.forEach(e=>r.use(e)),r},p.use=e=>(a+=1,n.set(a,e),a),p.eject=e=>{n.delete(e)},p.setOption=(e,t)=>((0,l.set)(s,e,t),s),p.setOptions=e=>{for(const t of Object.keys(e))(0,l.set)(s,t,e[t]);return s},p.getOption=e=>(0,l.get)(s,e),p.getOptions=e=>e?(0,l.get)(s,e):s,Object.assign(p,s.allowedMethods.reduce((e,t)=>(e[t]=(e,o,r)=>p(t,e,o,r),e),{})),p}();"undefined"!=typeof module?module.exports=a:self.ValyrianRequest=a})();//# sourceMappingURL=index.min.js.map