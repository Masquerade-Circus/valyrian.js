(()=>{"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,n={};((t,r)=>{for(var o in r)e(t,o,{get:r[o],enumerable:!0})})(n,{request:()=>f});var s,a=(s=n,((n,s,a,i)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let c of r(s))o.call(n,c)||c===a||e(n,c,{get:()=>s[c],enumerable:!(i=t(s,c))||i.enumerable});return n})(e({},"__esModule",{value:!0}),s)),i=require("valyrian.js"),c=require("valyrian.js/context"),l=require("valyrian.js/utils");function u(e,t){if(null==e)return new URLSearchParams;const r=new URLSearchParams;return Object.keys(e).forEach(o=>{const n=t?`${t}[${o}]`:o;if("object"==typeof e[o]&&null!==e[o]){return void u(e[o],n).forEach((e,t)=>r.append(t,e))}r.append(n,e[o])}),r}var d={allowedMethods:["get","post","put","patch","delete","head","options"]},p=(0,c.createContextScope)("request");var f=function e(t="",r=d,o=!1){const n=t.replace(/\/$/gi,"").trim();r.urls||(r.urls={base:"",node:null,api:null}),r.allowedMethods||(r.allowedMethods=d.allowedMethods);const s={...r,urls:{node:r.urls.node||null,api:r.urls.api||null,base:r.urls.base?r.urls.base+n:n}},a=new Map;let f=0;function h(){if(!o||!i.isNodeJs)return null;const e=(0,c.getContext)(p);return e&&e!==y?e:null}const w=async e=>{let t=e;for(const e of a.values()){if(!e.error)continue;const r=await e.error(t);r&&(t=r)}return t},y=async function(e,t,r,o={}){const n=h();if(n)return n(e,t,r,o);const c={method:e.toUpperCase(),headers:{},resolveWithFullResponse:!1,...s,...o};if(c.headers={...c.headers,...s.headers,...o.headers},c.headers.Accept||(c.headers.Accept="application/json"),!c.allowedMethods.includes(e))throw new Error(`Method ${e} not allowed. Allowed methods: ${c.allowedMethods.join(", ")}`);let d;try{d=function(e,t){const r=e.replace(/\/+$/g,"").trim(),o=/^https?/gi.test(r)?r:`${t.urls.base||""}${r}`;if(i.isNodeJs&&(0,l.isString)(t.urls.node)){if((0,l.isString)(t.urls.api))return new URL(o.replace(t.urls.api,t.urls.node));if(!/^https?/gi.test(o))return new URL(o,t.urls.node)}return/^https?/gi.test(o)||i.isNodeJs?new URL(o):new URL(o,window.location.origin)}(t,s)}catch(e){const r=new Error(`Failed to parse URL: ${t}`,{cause:e});throw r.cause=e,r}let p=await(async e=>{let t=e;for(const e of a.values()){if(!e.request)continue;const r=await e.request(t);r&&(t=r)}return t})({method:e,url:d,data:r,options:c});d=p.url;const f=p.options.headers.Accept,y=p.options.headers["Content-Type"]||p.options.headers["content-type"]||"";if(p.data)if("GET"===p.options.method&&"object"==typeof p.data){const e=new URLSearchParams(d.search);u(p.data).forEach((t,r)=>e.append(r,t)),d.search=e.toString()}else if((e=>e instanceof FormData||e instanceof URLSearchParams||e instanceof Blob||e instanceof ArrayBuffer||"undefined"!=typeof DataView&&e instanceof DataView||"undefined"!=typeof ReadableStream&&e instanceof ReadableStream)(p.data)||(0,l.isString)(p.data))p.options.body=p.data;else{const e=/json/gi.test(y);p.options.body=e?JSON.stringify(p.data):function(e){const t=new FormData;return Object.entries(e).forEach(([e,r])=>{null!=r&&(Array.isArray(r)?r.forEach(r=>t.append(e,r)):t.append(e,r))}),t}(p.data)}try{const e=await fetch(d.toString(),p.options);if(!e.ok){const t=new Error(`${e.status}: ${e.statusText}`);if(t.response=e,/text/gi.test(f))t.body=await e.text();else if(/json/gi.test(f))try{t.body=await e.json()}catch{t.body=null}const r=(await w({...p,response:e,body:t.body,error:t})).error;throw(0,l.isObject)(r)&&(r.__requestPluginHandled=!0),r}if(p.options.resolveWithFullResponse)return e;let t=e;if(/text/gi.test(f))t=await e.text();else if(/json/gi.test(f))try{t=await e.json()}catch{t=null}else/blob/gi.test(f)?t=await e.blob():/arraybuffer/gi.test(f)&&(t=await e.arrayBuffer());return(await(async e=>{let t=e;for(const e of a.values()){if(!e.response)continue;const r=await e.response(t);r&&(t=r)}return t})({...p,response:e,body:t})).body}catch(e){if(e&&(e.response||e.__requestPluginHandled))throw e;const t=(await w({...p,error:e})).error;throw(0,l.isObject)(t)&&(t.__requestPluginHandled=!0),t}};return y.new=(t,r)=>{const n=h();if(n)return n.new(t,r);const i=e(t,{...s,...r||{}});return a.forEach(e=>i.use(e)),o&&(0,c.isServerContextActive)()&&(0,c.setContext)(p,i),i},y.use=e=>{const t=h();return t?t.use(e):(f+=1,a.set(f,e),f)},y.eject=e=>{const t=h();t?t.eject(e):a.delete(e)},y.setOption=(e,t)=>{const r=h();return r?r.setOption(e,t):((0,l.set)(s,e,t),s)},y.setOptions=e=>{const t=h();if(t)return t.setOptions(e);for(const t of Object.keys(e))(0,l.set)(s,t,e[t]);return s},y.getOption=e=>{const t=h();return t?t.getOption(e):(0,l.get)(s,e)},y.getOptions=e=>{const t=h();return t?t.getOptions(e):e?(0,l.get)(s,e):s},Object.assign(y,s.allowedMethods.reduce((e,t)=>(e[t]=(e,r,o)=>y(t,e,r,o),e),{})),y}("",d,!0);"undefined"!=typeof module?module.exports=a:self.ValyrianRequest=a})();//# sourceMappingURL=index.min.js.map