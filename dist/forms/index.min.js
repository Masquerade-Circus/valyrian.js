(()=>{"use strict";var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,n={};((t,r)=>{for(var i in r)e(t,i,{get:r[i],enumerable:!0})})(n,{FormStore:()=>ne,formSchemaShield:()=>ae});var a,s=(a=n,((n,a,s,o)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let l of r(a))i.call(n,l)||l===s||e(n,l,{get:()=>a[l],enumerable:!(o=t(a,l))||o.enumerable});return n})(e({},"__esModule",{value:!0}),a)),o=require("valyrian.js"),l=require("valyrian.js/pulses"),f=require("valyrian.js/utils"),u=class extends Error{message;item;keyword;cause;schemaPath="";instancePath="";data;schema;_getCause(e="#",t="#"){let r=`${e}/${this.keyword}`,i=`${t}`;return void 0!==this.item&&("string"==typeof this.item&&this.item in this.schema&&(r+=`/${this.item}`),i+=`/${this.item}`),this.instancePath=i,this.schemaPath=r,this.cause&&this.cause instanceof u?this.cause._getCause(r,i):this}getCause(){return this._getCause()}_getTree(){const e={message:this.message,keyword:this.keyword,item:this.item,schemaPath:this.schemaPath,instancePath:this.instancePath,data:this.data};return this.cause&&(e.cause=this.cause._getTree()),e}getTree(){return this.getCause(),this._getTree()}getPath(){const e=this.getCause();return{schemaPath:e.schemaPath,instancePath:e.instancePath}}},c=()=>!0;function d(e,t,r){if(r)return c;const i=new u(`Invalid ${e}`);i.keyword=e,i.schema=t;return g(`defineError_${e}`,(e,t={})=>(i.message=e,i.item=t.item,i.cause=t.cause&&!0!==t.cause?t.cause:void 0,i.data=t.data,i))}function m(e,t){if(Array.isArray(e)){if(!1===Array.isArray(t))return!0;if(e.length!==t.length)return!0;for(let r=0;r<t.length;r++)if(m(e[r],t[r]))return!0;return!1}if("object"==typeof e&&null!==e){if("object"!=typeof t||null===t)return!0;for(const r in t)if(m(e[r],t[r]))return!0;for(const r in e)if(m(e[r],t[r]))return!0;return!1}return!1===Object.is(e,t)}function h(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function p(e,t=!1,r=new WeakMap){if(null==e||"object"!=typeof e)return e;if(r.has(e))return r.get(e);let i;if("function"==typeof structuredClone)return i=structuredClone(e),r.set(e,i),i;switch(!0){case Array.isArray(e):i=[],r.set(e,i);for(let n=0,a=e.length;n<a;n++)i[n]=p(e[n],t,r);return i;case e instanceof Date:return i=new Date(e.getTime()),r.set(e,i),i;case e instanceof RegExp:return i=new RegExp(e.source,e.flags),r.set(e,i),i;case e instanceof Map:i=new Map,r.set(e,i);for(const[n,a]of e.entries())i.set(p(n,t,r),p(a,t,r));return i;case e instanceof Set:i=new Set,r.set(e,i);for(const n of e.values())i.add(p(n,t,r));return i;case e instanceof ArrayBuffer:return i=e.slice(0),r.set(e,i),i;case ArrayBuffer.isView(e):return i=new e.constructor(e.buffer.slice(0)),r.set(e,i),i;case"undefined"!=typeof Buffer&&e instanceof Buffer:return i=Buffer.from(e),r.set(e,i),i;case e instanceof Error:i=new e.constructor(e.message),r.set(e,i);break;case e instanceof Promise||e instanceof WeakMap||e instanceof WeakSet:return i=e,r.set(e,i),i;case e.constructor&&e.constructor!==Object:if(!t)return i=e,r.set(e,i),i;i=Object.create(Object.getPrototypeOf(e)),r.set(e,i);break;default:{i={},r.set(e,i);const n=Reflect.ownKeys(e);for(let a=0,s=n.length;a<s;a++){const s=n[a];i[s]=p(e[s],t,r)}return i}}const n=Object.getOwnPropertyDescriptors(e);for(const e of Reflect.ownKeys(n)){const a=n[e];"value"in a&&(a.value=p(a.value,t,r)),Object.defineProperty(i,e,a)}return i}function y(e){return h(e)&&"$validate"in e}function g(e,t){return Object.defineProperty(t,"name",{value:e})}var v=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,b=/^P(?!$)((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?$/,$=/^(\d{4})-(0[0-9]|1[0-2])-(\d{2})T(0[0-9]|1\d|2[0-3]):([0-5]\d):((?:[0-5]\d|60))(?:.\d+)?(?:([+-])(0[0-9]|1\d|2[0-3]):([0-5]\d)|Z)?$/i,S=/^[a-zA-Z][a-zA-Z0-9+\-.]*:[^\s]*$/,A=/^(?!\.)(?!.*\.$)[a-z0-9!#$%&'*+/=?^_`{|}~-]{1,20}(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]{1,21}){0,2}@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,60}[a-z0-9])?){0,3}$/i,O=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])$/,w=/(?:\s+|:::+|^\w{5,}|\w{5}$|^:{1}\w|\w:{1}$)/,P=/^[0-9a-fA-F:.]*$/,x=/^(?:(?:[0-9a-fA-F]{1,4}:){7}(?:[0-9a-fA-F]{1,4}|:))$/,j=/(?:[0-9a-fA-F]{5,}|\D[0-9a-fA-F]{3}:)/,_=/^(?:(?:(?:[0-9a-fA-F]{1,4}(?::|$)){1,6}))|(?:::(?:[0-9a-fA-F]{1,4})){0,5}$/,k=/^[a-z0-9][a-z0-9-]{0,62}(?:\.[a-z0-9][a-z0-9-]{0,62})*[a-z0-9]$/i,I=/^(\d{4})-(\d{2})-(\d{2})$/,V=/^\/(?:[^~]|~0|~1)*$/,F=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/,M=/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)(\.\d+)?(Z|([+-])([01]\d|2[0-3]):([0-5]\d))$/,R=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#((?![^#]*\\)[^#]*))?/i,T=/^(?:[^{}]|\{[^}]+\})*$/,E=/^[a-zA-Z][a-zA-Z0-9+\-.]*:[^\s]*$/,C=/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#((?![^#]*\\)[^#]*))?/i,z=/^[^@\s]+@[^@\s]+\.[^@\s]+$/,q=/^[^\s!@#$%^&*()_+\=\[\]{};':"\\|,<>\/?]+$/,D=/\\/,N=[31,28,31,30,31,30,31,31,30,31,30,31],L={"date-time"(e){const t=e.match($);if(!t)return!1;const[,r,i,n,a,s,o]=t,l=Number(r),f=Number(i),u=Number(n),c=Number(a),d=Number(s),m=Number(o);if(f<1||f>12)return!1;if(u<1)return!1;const h=2===f?l%4!=0||l%100==0&&l%400!=0?28:29:N[f-1];return!(!h||u>h)&&(60!==m||59===d&&23===c)},uri:e=>S.test(e),email:e=>A.test(e),ipv4:e=>O.test(e),ipv6(e){if("::"===e)return!0;if(-1===e.indexOf(":")||w.test(e))return!1;const t=-1!==e.indexOf(".");let r=e;if(t){r=e.split(":");const t=r.pop();if(!O.test(t))return!1}const i=-1!==e.indexOf("::"),n=t?r.join(":"):e;if(i)return!(n.split("::").length-1>1)&&(!!P.test(n)&&_.test(n));const a=x.test(n),s=j.test(n);return t?a||!s:a&&!s},hostname:e=>k.test(e),date(e){const t=I.exec(e);if(!t)return!1;const[,r,i,n]=t,a=Number(r),s=Number(i),o=Number(n);if(s<1||s>12)return!1;if(o<1)return!1;const l=2===s?a%4!=0||a%100==0&&a%400!=0?28:29:N[s-1];return!!l&&o<=l},regex(e){try{return new RegExp(e),!0}catch(e){return!1}},"json-pointer":e=>""===e||V.test(e),"relative-json-pointer":e=>""===e||F.test(e),time:e=>M.test(e),"uri-reference":e=>!D.test(e)&&R.test(e),"uri-template":e=>T.test(e),duration:e=>b.test(e),uuid:e=>v.test(e),iri:e=>E.test(e),"iri-reference":e=>!D.test(e)&&C.test(e),"idn-email":e=>z.test(e),"idn-hostname":e=>q.test(e)},B={object:e=>h(e),array:e=>Array.isArray(e),string:e=>"string"==typeof e,number:e=>"number"==typeof e,integer:e=>"number"==typeof e&&e%1==0,boolean:e=>"boolean"==typeof e,null:e=>null===e,timestamp:!1,int8:!1,unit8:!1,int16:!1,unit16:!1,int32:!1,unit32:!1,float32:!1,float64:!1},K={items(e,t,r){if(!Array.isArray(t))return;const i=e.items,n=t.length;if("boolean"==typeof i)return!1===i&&n>0?r("Array items are not allowed",{data:t}):void 0;if(Array.isArray(i)){const e=i.length,a=e<n?e:n;for(let e=0;e<a;e++){const n=i[e];if("boolean"==typeof n){if(!1===n&&void 0!==t[e])return r("Array item is not allowed",{item:e,data:t[e]});continue}const a=n&&n.$validate;if("function"==typeof a){const i=a(t[e]);if(i)return r("Array item is invalid",{item:e,cause:i,data:t[e]})}}return}const a=i&&i.$validate;if("function"==typeof a)for(let e=0;e<n;e++){const i=a(t[e]);if(i)return r("Array item is invalid",{item:e,cause:i,data:t[e]})}},elements(e,t,r){if(!Array.isArray(t))return;const i=e.elements,n=i&&i.$validate;if("function"==typeof n)for(let e=0;e<t.length;e++){const i=n(t[e]);if(i)return r("Array item is invalid",{item:e,cause:i,data:t[e]})}},minItems(e,t,r){if(Array.isArray(t)&&!(t.length>=e.minItems))return r("Array is too short",{data:t})},maxItems(e,t,r){if(Array.isArray(t)&&!(t.length<=e.maxItems))return r("Array is too long",{data:t})},additionalItems(e,t,r){if(e.items&&!h(e.items)){if(!1===e.additionalItems)return t.length>e.items.length?r("Array is too long",{data:t}):void 0;if(h(e.additionalItems)){if(y(e.additionalItems)){for(let i=e.items.length;i<t.length;i++){const n=e.additionalItems.$validate(t[i]);if(n)return r("Array item is invalid",{item:i,cause:n,data:t[i]})}return}}else;}},uniqueItems(e,t,r){if(!Array.isArray(t)||!e.uniqueItems)return;const i=t.length;if(i<=1)return;const n=new Set;for(let e=0;e<i;e++){const i=t[e],a=typeof i;if(null!==i&&"string"!==a&&"number"!==a&&"boolean"!==a){if(i&&"object"==typeof i)for(let n=0;n<e;n++){const e=t[n];if(e&&"object"==typeof e&&!m(e,i))return r("Array items are not unique",{data:i})}}else{if(n.has(i))return r("Array items are not unique",{data:i});n.add(i)}}},contains(e,t,r){if(Array.isArray(t)){if("boolean"==typeof e.contains)return e.contains?0===t.length?r("Array must contain at least one item",{data:t}):void 0:r("Array must not contain any items",{data:t});for(let r=0;r<t.length;r++){if(!e.contains.$validate(t[r]))return}return r("Array must contain at least one item",{data:t})}}},U={minimum(e,t,r,i){if("number"!=typeof t)return;let n=e.minimum;return"number"==typeof e.exclusiveMinimum?n=e.exclusiveMinimum+1e-15:!0===e.exclusiveMinimum&&(n+=1e-15),t<n?r("Value is less than the minimum",{data:t}):void 0},maximum(e,t,r,i){if("number"!=typeof t)return;let n=e.maximum;return"number"==typeof e.exclusiveMaximum?n=e.exclusiveMaximum-1e-15:!0===e.exclusiveMaximum&&(n-=1e-15),t>n?r("Value is greater than the maximum",{data:t}):void 0},multipleOf(e,t,r,i){if("number"!=typeof t)return;const n=t/e.multipleOf;return isFinite(n)?function(e,t,r=1e-15){return Math.abs(e-t)<=r*Math.max(Math.abs(e),Math.abs(t))}(n,Math.round(n))?void 0:r("Value is not a multiple of the multipleOf",{data:t}):void 0},exclusiveMinimum(e,t,r,i){if("number"==typeof t&&"number"==typeof e.exclusiveMinimum&&!("minimum"in e))return t<=e.exclusiveMinimum+1e-15?r("Value is less than or equal to the exclusiveMinimum"):void 0},exclusiveMaximum(e,t,r,i){if("number"==typeof t&&"number"==typeof e.exclusiveMaximum&&!("maximum"in e))return t>=e.exclusiveMaximum?r("Value is greater than or equal to the exclusiveMaximum",{data:t}):void 0}},W={required(e,t,r){if(h(t))for(let i=0;i<e.required.length;i++){const n=e.required[i];if(!t.hasOwnProperty(n))return r("Required property is missing",{item:n,data:t[n]})}},properties(e,t,r){if(!h(t))return;let i=e._propKeys;i||(i=Object.keys(e.properties||{}),Object.defineProperty(e,"_propKeys",{value:i,enumerable:!1,configurable:!1,writable:!1}));let n=e._requiredKeys;void 0===n&&(n=Array.isArray(e.required)?e.required:null,Object.defineProperty(e,"_requiredKeys",{value:n,enumerable:!1,configurable:!1,writable:!1}));const a=n||[];for(let n=0;n<i.length;n++){const s=i[n],o=e.properties[s];if(Object.prototype.hasOwnProperty.call(t,s)){if("boolean"!=typeof o){if(o&&"$validate"in o){const e=o.$validate(t[s]);if(e)return r("Property is invalid",{item:s,cause:e,data:t[s]})}}else if(!1===o)return r("Property is not allowed",{item:s,data:t[s]})}else if(a.length&&-1!==a.indexOf(s)&&h(o)&&"default"in o){const e=o.$validate(o.default);if(e)return r("Default property is invalid",{item:s,cause:e,data:o.default});t[s]=p(o.default)}}},values(e,t,r){if(!h(t))return;const i=e.values,n=i&&i.$validate;if("function"!=typeof n)return;const a=Object.keys(t);for(let e=0;e<a.length;e++){const i=a[e],s=n(t[i]);if(s)return r("Property is invalid",{item:i,cause:s,data:t[i]})}},maxProperties(e,t,r){if(h(t)&&!(Object.keys(t).length<=e.maxProperties))return r("Too many properties",{data:t})},minProperties(e,t,r){if(h(t)&&!(Object.keys(t).length>=e.minProperties))return r("Too few properties",{data:t})},additionalProperties(e,t,r){if(!h(t))return;const i=Object.keys(t);let n=e._apIsCompiled;void 0===n&&(n=y(e.additionalProperties),Object.defineProperty(e,"_apIsCompiled",{value:n,enumerable:!1}));let a=e._patternPropertiesList;if(e.patternProperties&&!a){a=[];for(const t in e.patternProperties)a.push({regex:new RegExp(t,"u"),key:t});Object.defineProperty(e,"_patternPropertiesList",{value:a,enumerable:!1})}for(let s=0;s<i.length;s++){const o=i[s];if(!e.properties||!e.properties.hasOwnProperty(o)){if(a&&a.length){let e=!1;for(let t=0;t<a.length;t++)if(a[t].regex.test(o)){e=!0;break}if(e)continue}if(!1===e.additionalProperties)return r("Additional properties are not allowed",{item:o,data:t[o]});if(n&&y(e.additionalProperties)){const i=e.additionalProperties.$validate(t[o]);if(i)return r("Additional properties are invalid",{item:o,cause:i,data:t[o]})}}}},patternProperties(e,t,r){if(!h(t))return;let i=e._patternPropertiesList;if(!i){i=[];const t=Object.keys(e.patternProperties||{});for(let e=0;e<t.length;e++){const r=t[e];i.push({regex:new RegExp(r,"u"),key:r})}Object.defineProperty(e,"_patternPropertiesList",{value:i,enumerable:!1})}const n=Object.keys(t);for(let a=0;a<i.length;a++){const{regex:s,key:o}=i[a],l=e.patternProperties[o];if("boolean"!=typeof l){if("$validate"in l)for(let e=0;e<n.length;e++){const i=n[e];if(s.test(i)){const e=l.$validate(t[i]);if(e)return r("Property is invalid",{item:i,cause:e,data:t[i]})}}}else if(!1===l)for(let e=0;e<n.length;e++){const i=n[e];if(s.test(i))return r("Property is not allowed",{item:i,data:t[i]})}}},propertyNames(e,t,r){if(!h(t))return;const i=e.propertyNames;if("boolean"==typeof i)return!1===i&&Object.keys(t).length>0?r("Properties are not allowed",{data:t}):void 0;const n=i&&i.$validate;if("function"==typeof n)for(const e in t){if(!Object.prototype.hasOwnProperty.call(t,e))continue;const i=n(e);if(i)return r("Property name is invalid",{item:e,cause:i,data:t[e]})}},dependencies(e,t,r){if(h(t))for(const i in e.dependencies){if(i in t==!1)continue;const n=e.dependencies[i];if(Array.isArray(n)){for(let e=0;e<n.length;e++)if(!(n[e]in t))return r("Dependency is not satisfied",{item:e,data:n[e]});continue}if("boolean"==typeof n){if(n)continue;return r("Dependency is not satisfied",{data:n})}if("string"==typeof n){if(n in t)continue;return r("Dependency is not satisfied",{data:n})}const a=n.$validate(t);if(a)return r("Dependency is not satisfied",{cause:a,data:t})}},then:!1,else:!1,default:!1,definitions:!1,$id:!1,$schema:!1,title:!1,description:!1,$comment:!1,examples:!1,contentMediaType:!1,contentEncoding:!1,discriminator:!1,nullable:!1},Z={enum(e,t,r){const i=e.enum;for(let e=0;e<i.length;e++){const r=i[e];if(r===t)return;if(null!==r&&null!==t&&"object"==typeof r&&"object"==typeof t&&!m(r,t))return}return r("Value is not one of the allowed values",{data:t})},allOf(e,t,r){for(let i=0;i<e.allOf.length;i++)if(h(e.allOf[i])){if("$validate"in e.allOf[i]){const n=e.allOf[i].$validate(t);if(n)return r("Value is not valid",{cause:n,data:t})}}else if("boolean"!=typeof e.allOf[i]){if(t!==e.allOf[i])return r("Value is not valid",{data:t})}else if(Boolean(t)!==e.allOf[i])return r("Value is not valid",{data:t})},anyOf(e,t,r){for(let r=0;r<e.anyOf.length;r++){if(h(e.anyOf[r])){if("$validate"in e.anyOf[r]){if(!e.anyOf[r].$validate(t))return;continue}return}if("boolean"==typeof e.anyOf[r]&&Boolean(t)===e.anyOf[r])return;if(t===e.anyOf[r])return}return r("Value is not valid",{data:t})},oneOf(e,t,r){const i=e.oneOf;let n=0;for(let e=0;e<i.length;e++){const a=i[e];if(h(a)){if("$validate"in a){if(!a.$validate(t)&&(n++,n>1))return r("Value is not valid",{data:t});continue}if(n++,n>1)return r("Value is not valid",{data:t})}else if("boolean"!=typeof a){if(t===a&&(n++,n>1))return r("Value is not valid",{data:t})}else if(Boolean(t)===a&&(n++,n>1))return r("Value is not valid",{data:t})}if(1!==n)return r("Value is not valid",{data:t})},const(e,t,r){if(t!==e.const&&!(h(t)&&h(e.const)&&!m(t,e.const)||Array.isArray(t)&&Array.isArray(e.const)&&!m(t,e.const)))return r("Value is not valid",{data:t})},if(e,t){if("then"in e==!1&&"else"in e==!1)return;if("boolean"==typeof e.if){if(e.if){if(y(e.then))return e.then.$validate(t)}else if(y(e.else))return e.else.$validate(t);return}if(!y(e.if))return;return e.if.$validate(t)?y(e.else)?e.else.$validate(t):void 0:y(e.then)?e.then.$validate(t):void 0},not(e,t,r){if("boolean"==typeof e.not)return e.not?r("Value is not valid",{data:t}):void 0;if(h(e.not)){if("$validate"in e.not){const i=e.not.$validate(t);return i?void 0:r("Value is not valid",{cause:i,data:t})}return r("Value is not valid",{data:t})}return r("Value is not valid",{data:t})},$ref(e,t,r,i){if(e._resolvedRef)return e._resolvedRef(t);const n=e.$ref;let a=i.getSchemaRef(n);return a||(a=i.getSchemaById(n)),a?a.$validate?(e._resolvedRef=a.$validate,e._resolvedRef(t)):void 0:r(`Missing reference: ${n}`)}},X={...W,...K,...{minLength(e,t,r){if(!("string"!=typeof t||t.length>=e.minLength))return r("Value is shorter than the minimum length",{data:t})},maxLength(e,t,r){if(!("string"!=typeof t||t.length<=e.maxLength))return r("Value is longer than the maximum length",{data:t})},pattern(e,t,r){if("string"!=typeof t)return;let i=e._patternRegexp;if(!i)try{i=new RegExp(e.pattern,"u"),Object.defineProperty(e,"_patternRegexp",{value:i,enumerable:!1,configurable:!1,writable:!1})}catch(e){return r("Invalid regular expression",{data:t,cause:e})}return i.test(t)?void 0:r("Value does not match the pattern",{data:t})},format(e,t,r,i){if("string"!=typeof t)return;let n=e._formatValidate;return void 0===n&&(n=i.getFormat(e.format),Object.defineProperty(e,"_formatValidate",{value:n,enumerable:!1,configurable:!1,writable:!1})),n&&!n(t)?r("Value does not match the format",{data:t}):void 0}},...U,...Z},H=class{types={};formats={};keywords={};immutable=!1;rootSchema=null;idRegistry=new Map;failFast=!0;constructor({immutable:e=!1,failFast:t=!0}={}){this.immutable=e,this.failFast=t;for(const[e,t]of Object.entries(B))t&&this.addType(e,t);for(const[e,t]of Object.entries(X))this.addKeyword(e,t);for(const[e,t]of Object.entries(L))t&&this.addFormat(e,t)}addType(e,t,r=!1){if(this.types[e]&&!r)throw new u(`Type "${e}" already exists`);this.types[e]=t}getType(e){return this.types[e]}addFormat(e,t,r=!1){if(this.formats[e]&&!r)throw new u(`Format "${e}" already exists`);this.formats[e]=t}getFormat(e){return this.formats[e]}addKeyword(e,t,r=!1){if(this.keywords[e]&&!r)throw new u(`Keyword "${e}" already exists`);this.keywords[e]=t}getKeyword(e){return this.keywords[e]}getSchemaRef(e){if(this.rootSchema)return function(e,t){if(!t||"#"===t)return e;if(t.startsWith("#/")){const r=t.split("/").slice(1);let i=e;for(const e of r){const t=decodeURIComponent(e).replace(/~1/g,"/").replace(/~0/g,"~");if(!i||"object"!=typeof i||!(t in i))return;i=i[t]}return i}if(!t.includes("#")){if(e.definitions&&e.definitions[t])return e.definitions[t];if(e.defs&&e.defs[t])return e.defs[t];if(e.$id&&"string"==typeof e.$id&&(e.$id===t||e.$id.endsWith("/"+t)))return e}}(this.rootSchema,e)}getSchemaById(e){return this.idRegistry.get(e)}compile(e){this.idRegistry.clear();const t=this.compileSchema(e);if(this.rootSchema=t,this.linkReferences(t),!t.$validate){if(!1===this.isSchemaLike(e))throw new u("Invalid schema");t.$validate=g("Validate_Any",()=>{})}const r=e=>{this.rootSchema=t;const r=this.immutable?p(e):e,i=t.$validate(r);return i?{data:r,error:i,valid:!1}:{data:r,error:null,valid:!0}};return r.compiledSchema=t,r}compileSchema(e){h(e)||(e=!0===e?{anyOf:[{}]}:!1===e?{oneOf:[]}:{oneOf:[e]});const t=p(e);if("string"==typeof e.$id&&this.idRegistry.set(e.$id,t),"$ref"in e){const r=this.getKeyword("$ref");if(r){const i=d("$ref",e.$ref,this.failFast);t.$validate=g("Validate_Reference",e=>r(t,e,i,this))}return t}const r=[],i=[];if("type"in e){const t=d("type",e,this.failFast),n=Array.isArray(e.type)?e.type:e.type.split(",").map(e=>e.trim()),a=[],s=[];for(const e of n){const t=this.getType(e);t&&(a.push(t),s.push(t.name))}if(0===a.length)throw d("type",e,this.failFast)("Invalid type for schema",{data:e.type});let o,l="";if(1===a.length){l=s[0];const e=a[0];o=r=>{if(!e(r))return t("Invalid type",{data:r})}}else l=s.join("_OR_"),o=e=>{for(let t=0;t<a.length;t++)if(a[t](e))return;return t("Invalid type",{data:e})};const f=(e,t)=>o(t);r.push({fn:g(l,f),defineError:t}),i.push(l)}const{type:n,$id:a,$ref:s,$validate:o,required:l,...f}=e,u=l?[...Object.keys(f),"required"]:Object.keys(f);for(const t of u){const n=this.getKeyword(t);if(n){const a=d(t,e[t],this.failFast),s=n.name||t;r.push({fn:n,defineError:a}),i.push(s)}}const c=["enum","const","default","examples"];for(const r of u)if(!c.includes(r))if(h(e[r])){if("properties"===r){for(const i of Object.keys(e[r]))t[r][i]=this.compileSchema(e[r][i]);continue}t[r]=this.compileSchema(e[r])}else if(Array.isArray(e[r]))for(let i=0;i<e[r].length;i++)this.isSchemaLike(e[r][i])&&(t[r][i]=this.compileSchema(e[r][i]));else;if(0===r.length)return t;if(1===r.length){const e=r[0];t.$validate=g(i[0],r=>e.fn(t,r,e.defineError,this))}else{const e="Validate_"+i.join("_AND_"),n=e=>{for(let i=0;i<r.length;i++){const n=r[i],a=n.fn(t,e,n.defineError,this);if(a)return a}};t.$validate=g(e,n)}return t}isSchemaLike(e){if(h(e)){if("type"in e)return!0;for(let t in e)if(t in this.keywords)return!0}return!1}linkReferences(e){const t=[e];for(;t.length>0;){const e=t.pop();if(e&&"object"==typeof e){if("string"==typeof e.$ref&&"function"==typeof e.$validate&&"Validate_Reference"===e.$validate.name){const t=e.$ref;let r=this.getSchemaRef(t);if(void 0===r&&(r=this.getSchemaById(t)),"boolean"==typeof r){if(!0===r)e.$validate=g("Validate_Ref_True",()=>{});else{const t=d("$ref",e,this.failFast);e.$validate=g("Validate_Ref_False",e=>t("Value is not valid"))}continue}r&&"function"==typeof r.$validate&&(e.$validate=r.$validate)}for(const r in e){const i=e[r];if(i)if(Array.isArray(i))for(let e=0;e<i.length;e++){const r=i[e];r&&"object"==typeof r&&t.push(r)}else"object"==typeof i&&t.push(i)}}}}},Y=Symbol("forms-control-binding"),G=Symbol("forms-form-binding");function J(e){return String(e.tagName||"").toUpperCase()}function Q(e,t){return(0,f.isFunction)(e.getAttribute)?e.getAttribute(t):null}function ee(e){const t=e.vnode?.props?.name;if((0,f.isString)(t))return t;if((0,f.isString)(e.name))return e.name;const r=Q(e,"name");return(0,f.isString)(r)?r:""}function te(e){const t=String(e.getPath().instancePath||"");if(t.startsWith("#/")){const e=t.slice(2).split("/")[0];if(e.length>0)return function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}(e)}return(0,f.isString)(e.item)?e.item:null}function re(e,t){const r=e.childNodes||[];for(const e of r)e&&1===e.nodeType&&(t(e),re(e,t))}function ie(e,t){e.value=t??""}var ne=class e{static#e=e.createSchemaShield();#t;#r;#i;#n;#a;#s;static get schemaShield(){return this.#e}static createSchemaShield(){const e=new H({failFast:!1,immutable:!1});return e.addFormat("url",e=>{if(!(0,f.isString)(e))return!1;try{return new URL(e).protocol.length>0}catch{return!1}},!0),e}constructor(t){this.#t=e.#e.compile(t.schema),this.#r=t.onSubmit||null,this.#i=t.clean||{},this.#n=t.format||{},this.#a=t.validationMode||"safe";const r=e=>{const t="safe"===this.#a?(0,f.deepCloneUnfreeze)(e):e,r=this.#t(t);return r.valid?{}:this.#o(r.error)},i=(0,f.deepCloneUnfreeze)(t.state);this.#s=(0,l.createPulseStore)({values:(0,f.deepCloneUnfreeze)(i),errors:{},isInflight:!1,isDirty:!1},{setField(e,t,i){e.values[t]=i,e.isDirty=!0,e.errors=r(e.values)},validate:e=>(e.errors=r(e.values),0===Object.keys(e.errors).length),setInflight(e,t){e.isInflight=t},reset(e){e.values=(0,f.deepCloneUnfreeze)(i),e.errors={},e.isInflight=!1,e.isDirty=!1}})}get state(){return this.#s.state.values}get errors(){return this.#s.state.errors}get isInflight(){return this.#s.state.isInflight}get isDirty(){return this.#s.state.isDirty}#l(e,t,r,i,n){const a=e[t];return a?a(r,{name:t,state:this.state,control:i,event:n}):r}formatValue(e,t,r=null){return this.#l(this.#n,e,t,r)}setField(e,t,r=null,i){const n=this.#l(this.#i,e,t,r,i);this.#s.setField(e,n)}#o(e){if(!e)return{};if(!0===e)return{_form:"Invalid form data"};const t=function(e){let t=e;for(;t;){const e=te(t);if(e)return e;t=t.cause}return null}(e),r=function(e){let t=e;for(;t.cause;)t=t.cause;return t}(e),i=r.message||"Invalid form data";return t?{[t]:i}:{_form:i}}validate(){return this.#s.validate()}async submit(e){if(e?.preventDefault(),!this.validate())return!1;if(this.isInflight)return!1;this.#s.setInflight(!0);try{return this.#r&&await this.#r(this.state),!0}finally{this.#s.setInflight(!1)}}reset(){this.#s.reset()}},ae=ne.schemaShield;function se(e,t){const r=ee(t);if(0===r.length)return;t.name=r;const i=(n=t,String(n.type||Q(n,"type")||"").toLowerCase());var n;const a=J(t),s=e.state[r];if("checkbox"===i)t.checked=Boolean(s);else if("radio"===i)t.checked=String(s)===String(t.value||"");else if("SELECT"===a||"TEXTAREA"===a||"INPUT"===a){ie(t,e.formatValue(r,s,t))}const o=t;if(!o[Y]){const n={formStore:e,name:r,type:i,onInput:t.oninput||null,onChange:t.onchange||null};o[Y]=n,t.oninput=e=>{const t=o[Y];if(t){if("checkbox"!==t.type&&"radio"!==t.type){const r=e.target;t.formStore.setField(t.name,r.value,r,e);ie(r,t.formStore.formatValue(t.name,t.formStore.state[t.name],r))}t.onInput&&t.onInput(e)}},t.onchange=e=>{const t=o[Y];if(!t)return;const r=e.target;"checkbox"===t.type?t.formStore.setField(t.name,Boolean(r.checked),r,e):"radio"===t.type&&t.formStore.setField(t.name,r.value,r,e),t.onChange&&t.onChange(e)}}o[Y].formStore=e,o[Y].name=r,o[Y].type=i}function oe(e,t){const r=function(e){const t=[];return re(e,e=>{const r=J(e),i=String(e.type||Q(e,"type")||"").toLowerCase();"BUTTON"!==r&&"INPUT"!==r||"submit"!==i||t.push(e)}),t}(e);for(const e of r)e.disabled=t.isInflight}(0,o.directive)("form",(e,t)=>{const r=t.dom;if(!r||"FORM"!==J(r))return;const i=r;if(!i[G]){const t={formStore:e,onSubmit:r.onsubmit||null};i[G]=t,r.onsubmit=async e=>{const t=i[G];if(!t)return;await t.formStore.submit(e)||e.preventDefault(),t.onSubmit&&await t.onSubmit(e)}}i[G].formStore=e;const n=function(e){const t=[];return re(e,e=>{const r=J(e);if("INPUT"!==r&&"SELECT"!==r&&"TEXTAREA"!==r)return;const i=e,n=ee(i);0!==n.length&&(i.name=n,t.push(i))}),t}(r);for(const t of n)se(e,t);oe(r,e)}),(0,o.directive)("field",(e,t)=>{se(e,t.dom)}),"undefined"!=typeof module?module.exports=s:self.ValyrianForms=s})();//# sourceMappingURL=index.min.js.map