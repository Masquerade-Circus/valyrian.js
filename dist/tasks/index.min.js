(()=>{"use strict";var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,i={};((e,s)=>{for(var r in s)t(e,r,{get:s[r],enumerable:!0})})(i,{Task:()=>u});var n,a=(n=i,((i,n,a,o)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let u of s(n))r.call(i,u)||u===a||t(i,u,{get:()=>n[u],enumerable:!(o=e(n,u))||o.enumerable});return i})(t({},"__esModule",{value:!0}),n));function o(t){return Object.freeze({...t})}var u=class{#t;#e;#s;#r={status:"idle",running:!1,result:null,error:null};#i=null;#n=0;#a=Promise.resolve(null);#o=null;#u={state:new Set,success:new Set,error:new Set,cancel:new Set};constructor(t,e={}){this.#t=t,this.#e=e,this.#s=e.strategy||"takeLatest"}get state(){return o(this.#r)}data(){return this.#r.result}error(){return this.#r.error}on(t,e){return this.#u[t].add(e),()=>this.off(t,e)}off(t,e){this.#u[t].delete(e)}#l(t,e){for(const s of this.#u[t])s(e)}#h(t){Object.assign(this.#r,t),this.#l("state",o(this.#r))}async#c(t){this.#n+=1;const e=this.#n;"takeLatest"!==this.#s&&"restartable"!==this.#s||this.#i?.abort(),this.#i=new AbortController;const{signal:s}=this.#i;this.#h({status:"running",running:!0,error:null});try{const r=await this.#t(t,{signal:s});return s.aborted?(e===this.#n&&"reset"!==this.#o&&(this.#h({status:"cancelled",running:!1}),this.#l("cancel",t)),this.#o=null,this.#r.result):"takeLatest"===this.#s&&e!==this.#n?this.#r.result:(this.#h({status:"success",running:!1,result:r}),this.#e.onSuccess?.(r,t),this.#l("success",r),this.#o=null,r)}catch(r){if(s.aborted)return e===this.#n&&"reset"!==this.#o&&(this.#h({status:"cancelled",running:!1}),this.#l("cancel",t)),this.#o=null,this.#r.result;throw this.#h({status:"error",running:!1,error:r}),this.#e.onError?.(r,t),this.#l("error",r),this.#o=null,r}}run(t){return"drop"===this.#s&&this.#r.running?Promise.resolve(this.#r.result):"enqueue"===this.#s?(this.#a=this.#a.catch(()=>null).then(()=>this.#c(t)),this.#a):this.#c(t)}cancel(){this.#i&&(this.#o||(this.#o="cancel"),this.#i.abort(),this.#h({status:"cancelled",running:!1}))}reset(){this.cancel(),this.#o="reset",this.#h({status:"idle",running:!1,error:null,result:null})}};"undefined"!=typeof module?module.exports=a:self.ValyrianTasks=a})();//# sourceMappingURL=index.min.js.map