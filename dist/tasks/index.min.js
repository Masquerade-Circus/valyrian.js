(()=>{"use strict";var t=Object.defineProperty,e=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,r=Object.prototype.hasOwnProperty,n={};((e,s)=>{for(var r in s)t(e,r,{get:s[r],enumerable:!0})})(n,{Task:()=>u});var i,a=(i=n,((n,i,a,o)=>{if(i&&"object"==typeof i||"function"==typeof i)for(let u of s(i))r.call(n,u)||u===a||t(n,u,{get:()=>i[u],enumerable:!(o=e(i,u))||o.enumerable});return n})(t({},"__esModule",{value:!0}),i));function o(t){return Object.freeze({...t})}var u=class{#t;#e;#s;#r={status:"idle",running:!1,result:null,error:null};#n=null;#i=0;#a=Promise.resolve(null);#o={state:new Set,success:new Set,error:new Set,cancel:new Set};constructor(t,e={}){this.#t=t,this.#e=e,this.#s=e.strategy||"takeLatest"}get state(){return o(this.#r)}data(){return this.#r.result}error(){return this.#r.error}on(t,e){return this.#o[t].add(e),()=>this.off(t,e)}off(t,e){this.#o[t].delete(e)}#u(t,e){for(const s of this.#o[t])s(e)}#l(t){Object.assign(this.#r,t),this.#u("state",o(this.#r))}async#c(t){this.#i+=1;const e=this.#i;"takeLatest"!==this.#s&&"restartable"!==this.#s||this.#n?.abort(),this.#n=new AbortController;const{signal:s}=this.#n;this.#l({status:"running",running:!0,error:null});try{const r=await this.#t(t,{signal:s});return s.aborted||"takeLatest"===this.#s&&e!==this.#i?this.#r.result:(this.#l({status:"success",running:!1,result:r}),this.#e.onSuccess?.(r,t),this.#u("success",r),r)}catch(r){if(s.aborted)return e===this.#i&&(this.#l({status:"cancelled",running:!1}),this.#u("cancel",t)),this.#r.result;throw this.#l({status:"error",running:!1,error:r}),this.#e.onError?.(r,t),this.#u("error",r),r}}run(t){return"drop"===this.#s&&this.#r.running?Promise.resolve(this.#r.result):"enqueue"===this.#s?(this.#a=this.#a.catch(()=>null).then(()=>this.#c(t)),this.#a):this.#c(t)}cancel(){this.#n&&(this.#n.abort(),this.#l({status:"cancelled",running:!1}))}reset(){this.cancel(),this.#l({status:"idle",running:!1,error:null,result:null})}};"undefined"!=typeof module?module.exports=a:self.ValyrianTasks=a})();//# sourceMappingURL=index.min.js.map